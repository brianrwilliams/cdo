\part*{Part II: The curved $\beta\gamma$ system and its factorization algebra}

%\section{Overview}

\section{Overview}

The curved $\beta\gamma$ system is an elegant nonlinear $\sigma$-model,
attractive for both mathematical and physical reasons.
The source is a Riemann surface $S$ and the target is any complex manifold $X$.
The fields are $\gamma: S \to X$ a smooth function and 
$\beta \in \Omega^{1,0}(S,\gamma^*T^*_X)$ a $(1,0)$-form on $S$ 
with values in the pullback along $\gamma$ of the holomorphic cotangent bundle of $X$.
The action functional is 
\[\int_S \langle \beta \wedge \dbar \gamma \rangle, \]
where the brackets indicate that one uses the fiberwise evaluation pairing between the tangent bundle $T_X$ and the cotangent bundle $T^*_X$.
The equations of motion for this action are then
\[ 
\dbar \gamma = 0 = \dbar \beta. 
\]
In other words, a solution is a holomorphic map $\gamma$ from $S$ to $X$ along with a holomorphic 1-form $\beta$ on $S$ with values in the pullback along $\gamma$ of the cotangent bundle. 
(When $S$ admits a nowhere-vanishing holomorphic 1-form, such as when $S$ is an elliptic curve,
one can view the classical $\beta\gamma$ system as picking out holomorphic maps from $S$ to $T^*X$.)
%Here we will develop the perturbative aspects of the curved $\beta\gamma$ system in the BV formalism.

The quantization of the classical $\beta\gamma$ system is a chiral conformal field theory whose chiral algebra is the CDOs of $X$,
as explained by Witten \cite{WittenCDO} and Nekrasov \cite{Nek}.
To be more precise, they explain that the ``perturbative'' sector of the 
theory --- i.e., working around the constant solutions --- admits a quantization for $S = \CC$ only if $\ch_2(T_X)$ vanishes and that each choice of trivialization produces a quantization.
(To extend to arbitrary Riemann surfaces, one needs $c_1(T_X) = 0$ as well.)
They also interpret this theory as the half-twisted form of a $(0,2)$-supersymmetric $\sigma$-model.

Our goal in this part is to describe and quantize the curved $\beta\gamma$ system 
using the renormalization and BV machinery of \cite{CosBook} in combination with Gelfand-Kazhdan descent.
Applying the main theorem of \cite{CG2}, we then obtain a factorization algebra of quantum observables 
and extract from it a vertex algebra, which is the CDOs.
In other words, we develop mathematically the physical arguments and results in \cite{WittenCDO} and \cite{Nek}.
Along the way, we will see how aspects of those physical arguments, such as the anomalies,
appear in this BV formalism.

\begin{rmk}
In \cite{WG1,WG2} Costello already used this machinery to quantize the curved $\beta\gamma$ system,
but he uses a formalism of $L_\infty$ spaces rather than Gelfand-Kazhdan descent.
This approach does not lend itself as easily to direct comparison with CDOs, so far as we can tell,
and so we pursued another approach to encoding the target space, 
which is more explicitly analogous to techniques used by Kontsevich, Cattaneo-Felder, and others.
Strictly speaking, we do not rely upon Costello's results --- notably the $L_\infty$ space formalism --- and we show that our approach recovers his results when the target spaces (e.g., complex manifolds) 
are treatable with Gelfand-Kazhdan descent.
In practice, though, we borrow and re-purpose several lemmas, and 
we clearly take our inspiration from his work.
\end{rmk}

A key idea in our approach, which we learned from Costello's work, is to encode the $\sigma$-model as a gauge theory. 
This alternative presentation of the $\beta\gamma$ system, with the formal $n$-disk $\hD^n$ as the target,
makes it amenable to Gelfand-Kazhdan descent.
Our approach thus breaks into the following steps:
\begin{enumerate}
\item write the classical BV theory of the $\beta\gamma$ system as a gauge theory with a natural action of the Harish-Chandra pair $(\Vect,\GL_n)$,
\item analyze the obstruction ({\em aka} anomaly) to quantizing this gauge theory equivariantly with respect to the $(\Vect,\GL_n)$-action,
\item construct an Harish-Chandra extension of $(\Vect,\GL_n)$ via the obstruction and show that there is an equivariant quantization for this extended pair, and
\item describe the bundle of factorization algebras obtained by
  Gelfand-Kazhdan descent, for this extended pair, applied to the
  factorization algebra of quantum observables with target the formal $n$-disk.
\end{enumerate}
The strong parallels with the CDO story, as articulated in Part I, should be apparent here: 
in both cases, the classical situation works nicely with usual Gelfand-Kazhdan descent, but the quantum situation requires an extended version.
Indeed, the primary changes are that we replace vertex algebras with factorization algebras and that we use the BV formalism to produce the quantization, rather than a vertex algebra version of canonical quantization.
Both changes require a heavy use of homological machinery, and so it should be no surprise that we must allow homotopical actions of the Harish-Chandra pair $(\Vect,\GL_n)$ on cochain complexes and thus develop a homotopical version of Gelfand-Kazhdan descent.

Throughout this part, we work in the formalism developed in \cite{CosBook,CG1, CG2}
and refer to them liberally, not aiming to be self-contained here.
Nonetheless, we recall essential ideas and notations along the way and give detailed citations.

\section{A brief overview of derived deformation theory and $\L8$ algebras}
\label{sec DDT}

Throughout this part, we will use some homological constructions 
that are not wholly standard knowledge and 
can seem rather sophisticated upon first acquaintance.
The actual manipulations are straightforward and 
amount to exploiting several ways of writing maps between completed symmetric algebras, 
these ways being equivalent but distinct in flavor.
The reader familiar with $\L8$ algebras, Maurer-Cartan elements, twisting cocycles,
and so on, can safely skip this section.
For others, it will at least identify the tricks outside the complicated context in which we use them.
Our treatment is succinct and casual, and we cite \cite{LV, Hinich, LurieSAG, CG2}
for detailed treatments.

There is one important idea, and not just manipulation, connected with these constructions:
every dg Lie algebra describes a ``formal space'' (in some sense a moduli space parametrizing deformations of something), 
and conversely every formal space is described by some dg Lie algebra.
This idea is attributed to Deligne, Drinfeld, Quillen, Schlessinger-Stasheff, and others, 
and thanks to Lurie \cite{LurieSAG} and Pridham \cite{Pridham}, 
it has a precise incarnation in derived algebraic geometry, 
which provides a suitably sophisticated notion of ``space.''

Here we only need the following dictionary between a formal moduli space $\frak{X}$ and its associated dg Lie algebra $\fg_{\frak{X}}$:
\begin{itemize}
\item the dg algebra of functions $\cO(\frak{X})$ on $\frak{X}$ corresponds to $\clies(\fg_{\frak{X}})$, the Chevalley-Eilenberg cochains,
\item the dg coalgebra of distributions on $\frak{X}$ corresponds to ${\rm C}^{\Lie}_*(\fg_{\frak{X}})$, the Chevalley-Eilenberg chains,~and
\item the dg Lie algebra of vector fields on $\frak{X}$ corresponds to $\clies(\fg_{\frak{X}},\fg_{\frak{X}}[-1])$.
\end{itemize}
For us, the Chevalley-Eilenberg chains $\cliel_*(\fg)$ has underlying graded vector space $\Sym(\fg[1])$,
equipped with the standard coproduct where $\Delta(x) = x \otimes 1 + 1 \otimes x$ for $x \in \fg[1]$, 
and the differential $\d_{\cliel_*}$ is a degree one coderivation determined by  
\[
\d_{\cliel_*}(xy) = (\d_\fg x) y \pm x(\d_\fg y) + [x,y]
\]
for any $x,y \in \fg[1]$.
The Chevalley-Eilenberg cochains $\clies(\fg)$ is the linear dual, so the underlying graded algebra is the {\em completed}
symmetric algebra $\cSym(\fg^\vee[-1])$.
(One must be careful about duals with infinite-dimensional vector spaces. 
In practice our examples will be tamed by a topology and will mean the continuous linear dual.)
The last identification, for vector fields, might seem strange until one computes that 
the cochain complex of derivations of the algebra $\clies(\fg_{\frak{X}})$ has underlying graded Lie algebra 
$\cSym(\fg^\vee[-1]) \otimes \fg[1]$ with the bracket the usual Lie bracket for vector fields with power series coefficients.

Let us introduce a toy example that plays an important role for us. 

\begin{dfn}\label{dfn fgn}
Let $\fgn$ denote the dg Lie algebra $\CC^n[-1]$,
which consists of a copy of $\CC^n$ in cohomological degree 1
and hence has zero differential and zero bracket.
\end{dfn}

Under the dictionary we find
$$\clies(\fg_n) = \cSym(\fg_n^*[-1]) \cong \CC[[t_1,\ldots,t_n]] = \hO_n,$$
so that $\fg_n$ should encode the formal $n$-disk $\hD^n$.
Under the dictionary, we also find an isomorphism of vector fields,
$$\clies(\fg_n,\fg_n[-1]) = \cSym(\fg_n^*[-1]) \otimes \CC^n \cong \bigoplus_{j=1}^n \CC[[t_1,\ldots,t_n]] \frac{\partial}{\partial t_j} = \Vect,$$
which will be useful for us.

Given the dictionary, it is not unreasonable to imagine enlarging both sides a bit, 
by allowing $n$-ary brackets (not just binary brackets) on the Lie side
and by allowing arbitrary (co)derivations on the (co)commutative (co)algebra side.
On the Lie side, such objects are called $\L8$ algebras,
but we use the following definition, which has the dictionary built into it.

\begin{dfn}
An {\em $\L8$ algebra} $\fg$ is a graded vector space $V$ along with
a degree 1 coderivation $Q$ on the coaugmented cocommutative coalgebra
$\Sym(V[1])$ that preserves the coaugmentation and squares to zero.
Its {\em Chevalley-Eilenberg chains} $\clls(\fg)$ is the dg cocommutative
coalgebra $(\Sym(V[1]),Q)$.
\end{dfn}

A coderivation $Q$ is determined by how it maps to cogenerators, 
so in this case it is determined by the ``Taylor components''
\[
Q_n: \Sym^n(V[1]) \to V[1],
\]
which encode the $n$-ary brackets
\[
\ell_n^\fg: (\Lambda^n V)[n-1] \cong \Sym^n(V[1])[-1] \xto{Q_n[-1]} V
\]
after shifting.
A dg Lie algebra gives an $\L8$ algebra in which $\ell_n = 0$ for $n > 2$.
Thus, $\clls$ is a direct generalization of $\cliels$, recovering it on dg Lie algebras.

\begin{dfn}
Let $\fg$ and $\fg'$ be $\L8$ algebras.
A {\em map of $\L8$ algebras} $f : \fg \l8to \fg'$ means a map of coaugmented dg cocommutative algebras
\[
f: \clls(\fg) \to \clls(\fg').
\]
Note that every strict map of dg Lie algebra yields an $\L8$ map by applying the functor $\cliel_*$.
\end{dfn}

We use $\l8to$ to emphasize that $f$ is {\em not} a cochain map from $\fg$ to $\fg'$.
This notion of $\L8$ map allows for a succinct way of describing a map between dg Lie algebras up to coherent homotopy.

This notion also leads to a homotopy coherent version of a representation.

\begin{dfn}
For $M$ a dg vector space, an {\em $\L8$ action of $\fg$ on $M$} means a map of $\L8$ algebras
$\rho: \fg \l8to \End(M)$, where $\End(M)$ denotes the dg vector space of graded endomorphisms of $M$
with the commutator bracket. We also say $\rho$ makes $M$ a {\em $\L8$-representation} or {\em $\L8$-module}
for~$\fg$.
\end{dfn}

We unravel this definition as follows.
A map of $\L8$ algebras $\rho: \fg \l8to \End(M)$ is determined by the composite 
\[
\pi_{\Sym^1} \circ \rho: \Sym(\fg[1]) \to \End(M)[1] = \Sym^1(\End(M)[1]),
\]
as any coalgebra map is determined by how it maps to cogenerators.
Thus, we obtain a sequence of maps
\[
\rho_n: \Sym^n(\fg[1]) \otimes M \to M
\]
of degree $2-n$, which describe more concretely how $\fg$ acts on elements of~$M$.
This version of the data makes it manifest how to define the {\em Chevalley-Eilenberg chains of $M$},
$\clls(\fg,M)$, which generalizes the Lie algebra homology of a representation of a Lie algebra
and which thus encodes the coinvariants of the representation~$M$.

An $\L8$ algebra $\fg$ also possesses a {\em Chevalley-Eilenberg cochains} $\clus(\fg)$, 
which is the dg completed commutative algebra $(\cSym(V^\vee[-1]),Q^\vee)$.
When $\fg$ is a dg Lie algebra, this definition $\clus(\fg)$ recovers the usual cochains $\clies(\fg)$.
(One must be careful about what one means by the graded linear dual $V^\vee$
if $V$ is not finite-dimensional in each cohomological degree.
In practice our infinite-dimensional vector spaces are tamed by a topology.)
For each representation $M$, we also have the {\em Chevalley-Eilenberg cochains of $M$},
$\clus(\fg,M)$, which generalizes the Lie algebra cohomology of a representation of a Lie algebra
and which thus encodes the invariants of the representation~$M$.
We will use $\Der(\fg)$ to denote the $\clus(\fg,\fg[1])$, 
as it encodes the vector fields (or derivations) of $\fg$ viewed as a formal space.

It is often convenient to describe a map of $\L8$ algebras $f: \fg \l8to \fg'$ in two other ways:
\begin{enumerate}
\item a map of augmented dg commutative algebras $f^*: \clus(\fg') \to \clus(\fg)$~or
\item a Maurer-Cartan element $\alpha_f$ in the $\L8$ algebra $\clus(\fg) \otimes \fg'$.
\end{enumerate}
Let us explain what we mean in the second case.

First, observe that the tensor product $A \otimes \fg$ of a dg commutative algebra $A$ 
and $\L8$ algebra $\fg$ obtains a natural $\L8$ structure where
\[
\ell_n^{A \otimes \fg}(a_1 \otimes x_1, \ldots, a_n \otimes x_n) = \pm (a_1 \cdots a_n) \otimes \ell_n^{\fg}(x_1,\ldots,x_n).
\]
In other words, we use the commutative product of $A$ to multiply the $A$-components 
and we use the $\L8$ structure on $\fg$ to bracket the $\fg$-components.
This definition is just the extension to $\L8$ algebras of the familiar construction 
with commutative algebras and Lie algebras 
(e.g., recall why the sections of the adjoint bundle of a principal $G$-bundle form a Lie algebra).
Second, a Maurer-Cartan element of an $\L8$ algebra $\fg$ is a degree one element $\alpha$ such that
\[
\sum_{n \geq 1} \frac{1}{n!} \ell^{\fg}_n(\alpha, \cdots,\alpha) = 0.
\]
When $\fg$ is a dg Lie algebra, this recovers the standard definition.
(In principle, this infinite sum is ill-defined, but we always work in situations where only a finite sum appears.
Alternatively, one needs to introduce some mechanism to make the infinite sum well-defined, such as with a topology.)
Finally, a map of $\L8$ algebras $f$ is determined by the composite 
\[
\pi_{\Sym^1} \circ f: \Sym(\fg[1]) \to \fg'[1] = \Sym^1(\fg'[1]),
\]
as any coalgebra map is determined by how it maps to cogenerators.
This composite provides an element $\alpha_f \in \cSym(\fg^\vee[-1]) \otimes \fg'[1]$,
and the condition that $f$ intertwines the differentials is equivalent 
to the Maurer-Cartan equation on~$\alpha_f$.

We introduce one final bit of notation, since we use it repeatedly below.
Let ${\rm C}^*_{\rm Lie, red}(\fg)$ denote the {\em reduced} cochains:
we remove the constant terms (i.e., the span of the unit element).
That is, the underlying graded vector space~is
\[
{\rm C}^\sharp_{\rm Lie,red}(\fg) = \cSym^{>0}(\fg^*[-1]),
\]
namely, the functions that vanish at the base point of the formal moduli space encoded by~$\fg$.

\section{The formal $\beta\gamma$ system}
\label{sec formal}

We now turn to the case where the target is the formal $n$-disk $\hD^n$,
which was formulate as a classical BV theory in the style of a gauge theory.
This encoding allows a concise description of how diffeomorphisms on the target act on the theory,
and thence a description as a $\Vect$-equivariant classical BV theory.

% \owen{
% This paragraph is now an orphan:
% As we will examine in detail soon, this isomorphism can be phrased as saying that $\fg_n$ is an $\L8$-module for $\Vect$, 
% since we have a Lie algebra map 
% $$\rho_W: \Vect \to \Der(\clies(\fg_n)) = \clies(\fg_n,\fg_n[-1]).$$
% In other words, this map describes how $\Vect$ acts on the formal $n$-disk.
% (As $\GL_n$ manifestly acts on $\fg_n$, the reader might ask in what sense $\fg_n$ is a module for the pair $(\Vect,\GL_n)$.
% Pinning down a useful version of this notion is the goal of Section \ref{sec ss GK descent}.)
% }

\subsection{The free $\beta\gamma$ system as a BV theory}

We briefly recall how to encode the free $\beta\gamma$ system --- where the target $X$ is the affine space $\AA^n$ --- as a BV theory, following \cite{GwThesis,CG1}.
(Note that the name is due to the traditional choice of letters to denote the fields.)

\begin{dfn} 
The rank $n$ {\em free $\beta\gamma$ system} on a Riemann surface $S$ has fields 
\ben
\Omega^{0,*}(S, \CC^n) \oplus \Omega^{1,*}(S, \CC^n),
\een
concentrated in cohomological degrees 0 and 1.  
We denote by $\gamma = (\gamma_1,\ldots,\gamma_n)$ a section of $\Omega^{0,*}(S, \CC^n)$, and 
we denote by $\beta = (\beta_1,\ldots,\beta_n)$ a section of $\Omega^{1,*}(S, \CC^n)$.
The shifted pairing is ``wedge and integrate'':
\be\label{pairing}
\langle \gamma + \beta,\gamma'+\beta'\rangle = \sum_{i=1}^n \int_S \gamma_i \wedge \beta_i' + \beta_i \wedge \gamma_i'.
\ee
The action functional is
\ben
S_{\text{free}}(\gamma, \beta) = \langle \beta, \dbar \gamma \rangle = \sum_{i=1}^n \int_S  \beta_i \wedge \dbar \gamma_i .
\een
The equations of motion are thus 
\[
\dbar \gamma_i = 0 = \dbar \beta_i
\]
for $i = 1,\ldots,n$.
\end{dfn}

There is an action of the general linear group $\GL_n$ on the space of
fields of the free $\beta\gamma$ system. Explicitly, for a field of
the form $(f \tensor v, g \tensor \lambda) \in \Omega^{0,*}(S ;
\CC^n) \tensor \Omega^{1,*}(S ; \CC^n)$ we define for $A \in \GL_n$
\ben
A \cdot (f \tensor v, g \tensor \lambda) = (f \tensor A v, g \tensor
(A^{-1})^T \lambda) .
\een
That is, we view $\GL_n$ acting on $\Omega^{0,*}(S ; \CC^n)$ through
the defining representation on $\CC^n$ and on $\Omega^{1,*}(S,
\CC^n)$ through the coadjoint representation on $\CC^n$. By
construction this action preserves $S_{free}$. 

\subsection{The formal $\beta\gamma$ system}

We now turn to the case where the target is the formal $n$-disk $\hD^n$,
which is closely related to the free case we just described.

Let $S$ denote a Riemann surface, and let $\fg_n$ be the abelian Lie algebra from Definition~\ref{dfn fgn}. 
The dg Lie algebra $$\fg_n^S := \Omega^{0,*}(S,\fg_n)$$ plays a central role for us.
It is abelian but has a nontrivial differential via $\dbar$.
The Maurer-Cartan equation of this dg Lie algebra is $\dbar(\gamma) = 0$, where $\gamma: S \to \CC^n$ is a smooth function;
in other words, a solution is simply a holomorphic map from $S$ to $\CC^n$.
Under the dictionary, this dg Lie algebra $\fg^S_n$ encodes a formal moduli space that describes how to deform the constant function with value $0$ to a holomorphic functions.
Note that this Maurer-Cartan equation is precisely the Euler-Lagrange equation for $\gamma$ in the free $\beta\gamma$ system,
and the deformations describe the formal neighborhood of the constant zero map among all holomorphic functions.

To describe the $\beta$ fields as well, we simply enlarge the dg Lie algebra to its ``double''
\[
\DD \fg_n^S = \Omega^{0,*}(S, \fg_n) \oplus \Omega^{1,*}(S, \fg_n^\vee[-2]).
\]
Note that the shifts mean that in cohomological degree one, we have $\Omega^{0,0} \otimes \CC^n \oplus \Omega^{1,0} \otimes (\CC^n)^*$, 
and in cohomological degree two, we have $\Omega^{0,1} \otimes \CC^n \oplus \Omega^{1,1} \otimes (\CC^n)^*$.
The Lie bracket is still trivial, and the differential is $\dbar$ in both complexes. 
If $\beta$ denotes an element in $\Omega^{1,0} \otimes (\CC^n)^*$,
then the Maurer-Cartan equation is $\dbar(\beta) = 0$, which is precisely the Euler-Lagrange equation in the $\beta\gamma$ system.
Hence the dg Lie algebra $\DD \fg_n^S$ encodes, in some sense, the free $\beta\gamma$ system.
To be more precise, it encodes the $\beta\gamma$ system with the formal $n$-disk $\hD^n$ as the target,
since this dg Lie algebra describes deformations of the constant map to the origin.

\begin{rmk}
This holomorphic abelian gauge theory is simply a holomorphic version of BF theory, where the Lie algebra is now in a shifted degree.
\end{rmk}

Note that under this correspondence, the BV bracket for the BV theory encoding the $\beta\gamma$ system 
corresponds to the linear pairing on $\DD \fg^S_n$ arising from the evaluation pairing on $\fgn$. 
Explicitly, for $\gamma, \gamma' \in \Omega^{0,*}_c(S, \fg_n)$ and $\beta, \beta' \in \Omega^{1,*}_c(S, \fg_n^\vee[-2])$, 
consider the pairing
\be\label{pairing2}
\langle \gamma + \beta, \gamma' + \beta' \rangle = \int_S \ev_{\fgn}(\gamma \wedge \beta') + \ev_{\fgn}(\beta \wedge \gamma'),
\ee
where $\ev$ denotes the evaluation pairing between $\fgn$ and $\fgn^\vee$ and 
where $\ev_{\fgn}(\gamma \wedge \beta')$ denotes the composite of taking the wedge product of the Dolbeault components 
and the evaluation pairing of the Lie algebra components.
This pairing is invariant under the Lie bracket and has cohomological degree $-3$.
(This shift, in conjunction with the shift in Chevalley-Eilenberg cochains, ensures that one obtains a shifted Poisson bracket of degree 1,
as needed for a classical BV theory.)

Just as in the non-formal case the group $\GL_n$ acts on $\DD
\fg_n^S$. 

\begin{lemma}\label{GLaction} The group $\GL_n$ acts on the dg Lie algebra $\DD
  \fg_n^S$ in a way that preserves the pairing $\<-,-\>$. 
\end{lemma}
\begin{proof} 
The action of $\GL_n$ is induced by the defining representation on
$\fg_n [1] = \CC^n$ and the coadjoint action on $\fg_n^\vee [-2] =
(\CC^n)^*$. 
\end{proof}

\subsection{The $\Vect$ action on $\fgn^S$ and on $\DD\fgn^S$}\label{classicalvectaction}

We have just seen that the formal $\beta\gamma$ system is equivariant
for the group $\GL_n$. There is a richer equivariance coming from
non-linear automorphisms of the formal disk that we now wish to
describe. 

First, consider the global curved $\beta \gamma$-system with source
$S$ and target $X$. Explicitly, the fields consist of pairs of a map $\gamma : S
\to X$ together with a section $\beta \in \Gamma(K_S \tensor
\gamma^*(T^*X))$. The action is, as in the flat case, $\int_S \beta
\wedge \dbar \gamma$. 

Biholomorphisms act on the $\gamma$ fields in the
obvious way: given a biholomorphism $\phi : X \to X$ we obtain a new
field via composition $\phi \circ \gamma : S \to
X$. Now, a biholomorphism induces an action of sections on any tensor
bundle. In particular, on sections of $T^*X$ the biholomorphism $\phi$
acts by the inverse Jacobian $Jac(\phi)^{-1}$. Thus, we have an action
of the biholomorphism $\phi$ on the $\beta$ fields given by
$Jac(\gamma^*\phi)^{-1}$. Thus, the action on the pair $(\gamma,
\beta)$ is given by
\ben
\phi \cdot (\gamma, \beta) = (\phi \circ \gamma, Jac(\phi)^{-1} \beta) 
\een
where $Jac(\phi)^{-1} \beta$ is a section of $(\phi \circ
\gamma)^*T^*X \tensor K_S$. Since $\phi$ is holomorphic we have $$\dbar
(\gamma \circ \phi) = Jac(\phi) \cdot \dbar \gamma .$$ It follows that biholomorphisms
are a symmetry of the classical theory. 

The dg Lie algebras we introduced above describing the formal
$\beta\gamma$ system arise via a general method for producing dg Lie algebras:
given a dg Lie algebra $\fg$ and a commutative dg algebra $A$, the tensor product $A \otimes \fg$ has a natural 
dg Lie algebra structure where the differential is
\[
\d( a \otimes X) = (\d_A a) \otimes X + (-1)^{a} a \otimes \d_\fg X
\]
and the bracket is
\[
[a \otimes X, a' \otimes X'] = (-1)^{Xa'} (aa') \otimes [X,X'].
\]
Above, we took $A$ to be the Dolbeault complex $\Omega^{0,*}(S)$.

% \owen{The next paragraph isn't quite accurate: 
% $\Vect$ does not have an $\L8$ action on $\fgn$ or $\fgn^S$, because it acts through derivations on those Lie algebras.
% In other words, they are not $\L8$ modules over $\Vect$, which is a linear notion.
% Instead the action is nonlinear since they are spaces with an action of $\Vect$.}

Now, if another Lie algebra $\fh$ acts on $\fg$, there is a natural extension to an action of $\fh$ on $A \otimes \fg$ by simply leaving the $A$-term alone.
We want to use an $\L8$ version of this procedure to equip $\fg_n^S$ and $\DD \fg_n^S$ with an $\L8$ action of $\Vect$,
extending the $\L8$ action of $\Vect$ on $\fg_n$.
This $\L8$ action is something familiar in physics, just expressed compactly via our dictionary.
For a $\sigma$-model with target $X$, a diffeomorphism of $X$ acts on the space of maps into $X$. 
If the diffeomorphism preserves structure relevant to the $\sigma$-model (e.g., a metric or complex structure), 
then the diffeomorphism acts on the space of solutions to the Euler-Lagrange equations of the theory.
This $\L8$ action encodes how formal diffeomorphisms of the target formal disk $\hD^n$ act on the formal moduli space of solutions to the equations of motion for the $\beta\gamma$ system. 

Let us provide an explicit description of this $\L8$ action in order to make the extension manifest.
Denote the generators of $\fg_n$ by $\{\xi_1,\ldots,\xi_n\}$ and the dual generators of $\fg_n^\vee$ by $\{t_1, \ldots,t_n\}$. 
Hence we have
\[
\clies(\fg_n) = \cSym(\fg^\vee_n[-1]) = \CC[[t_1,\ldots,t_n]],
\]
as already mentioned. Moreover we have a natural map
\be\label{algact}
\rho_W : \Vect \to \Der(\clies(\fg_n)), \;\; f(t_i) \partial_j \mapsto f(t_i) \xi_j .
\ee
Expressed as an $\L8$ action of $\Vect$ on $\fg_n$, it is given by a sequence of maps
\ben
\ell^{\rm W}_m : \Vect \otimes \fgn^{\otimes m} \to \fgn
\een
of cohomological degree $1-m$, where $m$ ranges over all non-negative integers.
These maps are simply the ``Taylor components'' of $\rho_W$.
For instance, the vector field $X = t_1^{m_1} \cdots t_n^{m_n} \partial_j \in \Vect$ acts by zero for any $m \neq m_1 + \cdots + m_n$, 
and for $m = m_1 + \cdots + m_n$, 
\ben
\ell^{\rm W}_m\left(X, (\xi_1^{\otimes m_1} \otimes \cdots \otimes \xi_n^{\otimes m_n}) \right) 
= \ell_m^{\rm W} \left((t_1^{m_1} \cdots t_n^{m_n} \partial_j) \otimes \xi_1^{\otimes m_1}\otimes \cdots \otimes \xi_n^{\otimes m_n} \right) 
= \xi_j 
\een 
and vanishes on any other basis element $\fg_n^{\otimes m}$.

With these formulas in hand, we can equip $A \otimes \fgn$ with an $\L8$ action of $\Vect$.
Here the sequence of maps is
\ben
\ell^{W,A}_m : \Vect \otimes (A \otimes \fgn)^{\otimes m} \to A \otimes \fgn
\een
with
\[
\ell^{W,A}_m(X, (a_1 \otimes x_1)\otimes \cdots \otimes (a_m \otimes x_m)) = \pm (a_1\cdots a_m) \otimes \ell^{\rm W}_m(X,x_1 \otimes \cdots \otimes x_m),
\]
where the sign is determined by Koszul's rule.
Equivalently, we can encode the $\L8$ action in a Lie algebra map
\[
\rho_{W,A}: \Vect \to \clies(A \otimes \fgn, A \otimes \fgn[-1]),
\]
which assembles the $\ell^A_m$ maps into a ``Taylor series.''
If we set $A$ to be $\Omega^{0,*}(S)$, then we obtain an $\L8$ action of $\Vect$ on $\fgn^S$.
A lift of this action to an $\L8$ action of $\Vect$ on $\DD\fgn^S$ is uniquely determined by the requirement that the action preserve the degree -3 pairing.

%\subsubsection{}
%The action of $\Vect$ on the $L_\infty$-algebra $\fg_n$ extends to an
%action on the $L_\infty$-algebra $A \otimes \fg_n$ for any commutative
%dg algebra $A$ as follows. 
%
%For each $m$ the $m$-fold commutative multiplication on $A$ defines a map 
%\ben
%\mu_m : \Sym^m(A \otimes \fg_n) \to A \otimes \Sym^m (\fg_n)
%\een
%that sends $(a_1 \otimes a_m) \otimes (v_1 \otimes v_n) \mapsto
%(a_1\cdots a_m) \otimes (v_1 \otimes \cdots \otimes v_n)$.
%
%
%%Consider the linear endomorphisms of the algebra $A$, $\End (A)$. There is a map $\End(A) \cong A^\vee \otimes A = \Sym^1(A^\vee) \otimes A \hookrightarrow \Sym(A^\vee) \otimes A$. Let $\Bar{\id}_A$ denote the image of $\id_A \in \End(A)$ under this compoisition. 
%
%Consider the induced composition 
%\ben
%\xymatrix{\cSym(\fg_n^\vee[-]) \otimes \fg_n[1]
%\ar[r]^-{\id_A} & \left(
%  \cSym(\fg_n^\vee[-1])\right) \otimes \left(A^\vee \otimes A \right) \otimes \fg_n[1] \ar[r]^-{\mu^\vee} & \left(\cSym(\fg_n^\vee[-1]) \otimes \cSym(A^\vee) \right)\otimes (A \otimes \fg_n[1]) \ar@{=}[d] \\
%& & \cSym\left((A \otimes \fg_n)^\vee[-1]\right) \otimes (A \otimes \fg_n)[1] .}
%\een
%where $\id_A \in \End(A) = A^\vee \otimes A$ is the identity endomorphism and $\mu^\vee$ is the dual to the commutative multiplication on $A$. Together with the map $\rho_W : \Vect \to \Sym(\fg_n^\vee[-1]) \otimes \fg_n[1]$ defining the $\Vect$ action on $\fg_n$ we obtain a map of graded vector spaces
%\ben
%A \otimes \rho_W := \mu^\vee \circ \id_A \circ \rho_W : \Vect \to  \clie^\sharp (A \otimes \fg_n ; A \otimes \fg_n[1]) .
%\een 
%
%\begin{lemma} This defines a map of dg Lie algebras $A \otimes \rho_W : \Vect \to \Der(A \otimes \fg_n)$.
%\end{lemma}
%In the case that $A = \Omega^{0,*}(S)$ we get an action of $\Vect$ on the $L_\infty$-algebra $\fg_n^S$. Just as above, this action is encoded by an $L_\infty$-structure on the direct product $\Vect \oplus \fg_n^S$. Explicitly, the structure maps of this $L_\infty$-algebra have the form 
%\ben
%\xymatrix{
%\Vect \otimes (\fgn^S)^{\otimes m} = \Vect \otimes \left(\Omega^{0,*}(S) \otimes \fgn \right)^{\otimes m} \cong \Vect \otimes \left(\Omega^{0,*}(S)\right)^{\otimes m} \otimes \fgn^{\otimes m} \ar[r]^-{\wedge \otimes \ell^\bW_m} & \Omega^{0,*}(S) \otimes \fgn = \fgn^S
%}
%\een
%where $\ell^\bW_m : \Vect \to \fgn^{\otimes m} \to \fgn$ is the $L_\infty$-bracket above and $\wedge$ is the wedge product of differential forms. We denote these brackets by $\ell_m^{\bW,S}$. 
%
%If $X = t_1^{m_1} \cdots t_n^{m_n} \partial_j \in \Vect$ as above then it acts non-trivially on $\Omega^{0,*}(S, \fgn^S)$. Indeed, if
%\ben
%\Gamma = (\gamma_{1,1} \otimes \xi_1 \cdots \gamma_{1,m_1} \otimes \xi_1) \otimes \cdots \otimes (\gamma_{n,1} \otimes \xi_n \cdots \gamma_{n,m_n} \otimes \xi_n) \in \left(\Omega^{0,*}(S, \fgn^S)\right)^{\otimes m}
%\een
%where $\gamma_{i,j} \in \Omega^{0,*}(S)$, then
%\ben
%\ell_m^{\bW,S}(X \otimes \Gamma) = \wedge(\gamma_{i,j}) \otimes \xi_j .
%\een

Diffeomorphisms of a manifold $X$ naturally determine symplectomorphisms of the cotangent bundle $T^*X$,
given simply by the associated map of vector bundles.
Thus diffeomorphisms also act naturally on the space of maps from $S$ into $T^*X$.
We can use the $\L8$ language to provide a concise description of 
this action of formal diffeomorphisms of the disk $\hD^n$ on the fields of the formal $\beta\gamma$ system.

The action of $\Vect$ on the Lie algebra $\fgn$ induces an action of $\Vect$ on the dual space $\fg_n^\vee$ via the evaluation pairing:
\ben
\<X \cdot v, w\>_{\fgn} = \<v, X \cdot w\>_{\fgn}
\een
for all $v + w \in \fgn \oplus \fgn^\vee$. 
This action is linear in the sense that brackets
\ben
\Vect \otimes (\fg_n^\vee)^{\otimes m} \to \fg_n^\vee
\een
are zero for $m > 1$. 
We can extend this action to the dg vector space $\Omega^{1,*}(S, \fg_n^\vee)$ and hence to $\DD \fg_n^S$;
we denote this $\L8$-action by
\ben
\DD \rho_W : \Vect \to \Der(\DD \fg_n^S).
\een
Since $\Vect$ preserves the dual pairing on $\fg_n$ and $\fg_n^\vee$, 
it is immediate that it preserves the invariant pairing of degree $-3$ on $\DD \fg_n^S$. 
We summarize these observations in the following.

\begin{lemma}
The classical BV theory of the formal $\beta\gamma$ system is equivariant with respect to $\Vect$:
the action of $\Vect$ on the fields preserves the shifted pairing on the fields and the action functional.
In other words, the $\L8$ action of $\Vect$ on $\DD\fgn^S$ determined by the canonical action of $\Vect$ on $\fgn$ preserves the shifted pairing and the differential.
\end{lemma}

\subsection{A Noether current and the obstruction-deformation complex}
\label{sec obsdef}

It thus should be no surprise that we can also use a local functional to express this action of infinitesimal diffeomorphisms. The explicit formula is quite simple and is just the natural formula from physics written in terms of formal power series. (See equation (\ref{eqn noether}) below.) To formulate this result, we recall now some useful notation. We will also see how we can obtain the usual Noether current for the symmetry by vector fields from this local functional.  

\subsubsection{Recollections on local functionals}

A systematic exposition of local functionals and deformation complexes can be found in \cite{CosBook}, particularly in chapter 5,
but here we provide a brief summary with our theory as a running example. 

Let $\cE$ be a dg Lie (or $L_\infty$) algebra associated to a classical BV field theory on $S$. 
The underlying graded vector space of $\cE$ consists of the smooth sections of a certain graded vector bundle $E$ on $S$;
we call such sections the {\em fields} of the field theory.
The key example here is the dg Lie algebra $\DD \fg_n^S$ for the formal $\beta\gamma$ system,
whose fields are $\gamma$ and~$\beta$.

A {\em Lagrangian density} is a functional on $\cE$ that takes values in smooth densities on $S$ and depends polynomially (or as a power series) on the fields and their derivatives.
This dependence is local: if $\cL(\gamma)$ is a Lagrangian density evaluated on the field $\gamma$, 
its value at a point $x \in S$ only depends on the $\infty$-jet ({\em aka} Taylor expansion) of $\gamma$ at $x$.
A Lagrangian density $\cL$ then determines a {\em local} functional on fields by integrating over $S$.
More precisely, one obtains a functional on compactly-supported fields, since integration is always well-defined so long as the domain is compact.
As an example, let  $\cE = \DD\fg_1^\CC$, the rank 1 formal $\beta\gamma$ system on $S = \CC$.
The Lagrangian density $\cL(\gamma,\beta) = \beta \wedge \dbar \gamma$
has local functional given by the action functional.

Note that since total derivatives with compact support have trivial integral,
two Lagrangian densities that differ by total derivatives determine the same local functional.
Thus, we  define the dg vector space of local functionals on the classical field theory $\cE$ by
\ben
\cloc^*(\cE) = \Dens_S \tensor_{D_S} {\rm C}_{\rm Lie,red}^*(J^\infty(E)) . 
\een
Here $D_S$ denotes the ring of differential operators on $S$, 
$\Dens_S$ denotes the smooth densities on $S$ equipped with its natural right action by $D_S$, 
and $J^\infty E$ denotes the sheaf of $\infty$-jets of smooth sections of the bundle $E$. 
Since $\cE$ is a sheaf of Lie algebras, $J^\infty(E)$ is a sheaf of Lie algebras in $D_S$-modules,
and we are computing the Lie algebra cochains in the category of $D_S$-modules.
Such cochains should be viewed as functions on the $\infty$-jets of fields with values in functions on $S$.
Hence, this tensor product produces {\em densities} on $S$ that are power series in the jets of fields.
Moreover, taking this tensor product over $D_S$ encodes the relation that total derivatives vanish.
Note that we've eliminated the constant functions on jets of sections.

This description of $\cloc^*(\cE)$ is quite abstract, but 
by restricting to compactly supported fields, we can provide a more concrete description of the situation. 
A local functional is a sum of functionals of the form
\[
\int_{x \in S} D_1\gamma(x) \wedge \cdots \wedge D_j\gamma(x) \wedge D_{j+1}\beta(x) \wedge\cdots \wedge D_k\beta(x)\wedge \d \mu,
\]
where the $D_i$ are differential operators and where $\d\mu$ is a smooth form.
This functional is {\em homogeneous of order $k$}.
(Such a functional can have any cohomological degree.)
As we saw, a prototypical example of a local functional is the action functional itself, which is quadratic and degree~zero.

\begin{dfn}
Let $\Def_n = \cloc^*(\DD \fg_n^S)$ denote the cochain complex of local functionals on $\DD \fg_n^S$.
Elements consist of formal sums $I = \sum_{k > 0} I_k$ where each $I_k$ is a local functional that is homogeneous of order $k$. We call $\Def_n$ the {\em obstruction-deformation complex} for the formal $\beta\gamma$ system.
\end{dfn}

The deformation complex is, in fact, a subcomplex of the Chevalley-Eilenberg continuous cochains on the dg Lie algebra $\DD \fg_n^S$. 
(Essentially, we mean the cochains as a dg Lie algebra in topological vector spaces, but 
see Section \ref{sec functional analysis} for more thorough discussion of this point.)
A cochain in the deformation complex of homogeneous degree $k$ is a distribution supported, by definition, along the small diagonal $X \hookrightarrow X^k$.

The complex $\Def_n$ has a shifted Lie algebra structure arising from the BV bracket $\{-,-\}$,
which is determined by the shifted pairing between the fields $\gamma$ and $\beta$ of Equation (\ref{pairing2}).
In essence, we view the pairing on fields as encoding a shifted symplectic structure on the space of fields,
and hence functionals should have a shifted Poisson bracket.
From this perspective $\gamma$ and $\beta$ are conjugate variables (like $q$ and $p$ in traditional, unshifted symplectic geometry).
Given two local functionals $F$ and $G$, one computes $\{F,G\}$ by pairing a $\gamma$ input from $F$ with a $\beta$ input from $G$, and {\it vice versa} (much as $\{q,p\} = 1$).
With respect to this bracket, the differential on $\Def_n$ is then $\{S_{\text{free}},-\}$.
(Note that local functionals do not form a commutative algebra, however, since the product of two such is no longer local!
The bracket does provide a shifted Lie bracket, just not a Poisson bracket.)

\subsubsection{The action of vector fields}

We now describe the action of formal vector fields on the classical theory using local functionals.
Verifying the lemma is a direct computation using the definitions.

\begin{lemma}\label{Noether}
The map $\DD \rho_W : \Vect \to \Der (\DD \fg_n^S)$ describing the $\L8$-action of $\Vect$ on the dg Lie algebra $\DD \fg_n^S$ has a lift
\ben
\xymatrix{
&\Def_n [-1] \ar[d]^-{\{-,-\}} \\
\Vect \ar[r]_-{\DD \rho_W} \ar[ur]^{I^{\rm W}} & \Der(\DD \fg_n^S)
}
\een
with $I^{\rm W}$ a local functional.
Explicitly, given a formal vector field 
\[
X = \sum_{j = 1}^n \sum_{\bm = (m_1,\ldots,m_n) \in \NN^n} a_{j, \bm} t_1^{m_1} \cdots t_n^{m_n} \partial_j,
\] 
the local functional 
\be\label{eqn noether}
I^{\rm W}_X(\gamma, \beta) = \sum_{j = 1}^n \sum_{\bm \in \NN^n} a_{j, \bm} \int_S  \gamma^{\wedge m_1}_1 \wedge \cdots \wedge \gamma^{\wedge m_n}_n \wedge \beta_j
\ee
satisfies $\{I^{\rm W}_X,-\} = \DD\rho_W(X)$.
\end{lemma}

%\begin{rmk} 
%Note something important about this definition (and possibly peculiar upon first acquaintance):
%such a functional vanishes on fields $\gamma \in \Omega^{0,0}(S)$ and $\beta \in \Omega^{1,0}(S)$ because the integrand would not be a top form. Indeed, for fixed $X$ we see that the local functional $I^{\rm W}_X$ is of cohomological degree one. This fact does not, however, make $I^{\rm W}$ trivial. In fact, it has a familiar interpretation of a {\em current} of the classical field theory that we now explain. 
%
%Fix a vector field $X \in \Vect$ and consider the one-dimensional Lie algebra spanned by it. 
%In \brian{ref} it is shown that actions of an ordinary Lie algebra $\fg$ on a field theory on $S$ are equivalent to actions by the {\em local} Lie algebra $\Omega^*_S \tensor \fg$. 
%The data of a local Lie algebra acting a field theory $\cE$ is equivalent to a Maurer-Cartan element in
%\ben
%{\rm C}^*_{\rm loc} \left(\Omega^*_S \tensor \fg\right) \tensor {\rm C}^*_{\rm loc}\left(\cE \right) [-1]
%\een
%where the Lie bracket comes from the BV pairing $\{-,-\}$ on $\cE$ as above. Thus, for fixed $X$ in $\Vect$, and the Lie algebra $\fg = \CC \cdot X$, we can think of $I_X^{\rm W}$ as a Maurer-Cartan element in ${\rm C}^*_{\rm loc} \left(\Omega^*_S \right) \tensor {\rm C}^*_{\rm loc}\left(\DD \fg_n^S \right) [-1]$. Now, for each open $U \subset S$ we have a map of dg Lie algebras
%\ben
%\Phi_U : {\rm C}^*_{\rm loc} \left( \Omega^*_S \right) \tensor {\rm C}^*_{\rm loc}\left(\DD \fg_n^S\right) [-1]\to \clie^*(\Omega^*_c(U)) \tensor \clie^*(\DD \fg_n^U) [-1]
%\een 
%which is well-defined as we can restrict a local functional to an open set provided at least one of the inputs is compactly supported. The induced Maurer-Cartan element $I^{\rm W}_X (U) := \Phi_U(I^{\rm W}_X)$ defines a map of $L_\infty$-algebras
%\ben
%I^{\rm W}_X(U) : \Omega^*_c(U) \to \clie^*(\DD \fg_n^U) [-1] .
%\een 
%Taking the linear dual (\brian{and forgetting about completions}) we view this map as an element of degree zero in $\Omega^*(U) \tensor \clie^*(\DD \fg_n^U) [1]$ (the shift by $2$ comes from taking the dual of the compactly supported de Rham complex on $U$). To recover the current, we take $U \simeq A$ to be equivalent to an annulus. In this case the unique class $\d \theta$ in $\Omega^1(A)$ defines the degree zero element $I_X^{\rm W}(A) \d \theta \in \clie^*(\DD \fg_n^A)$. This is the associated current to the symmetry generated by $X$. 
%\end{rmk}

\begin{rmk}
When restricted to linear vector fields, the action of $\Vect$ on $\beta\gamma$ system with target $\hD^n$ 
agrees with the action of $\GL_n$ described in Lemma \ref{GLaction}. In this sense, we have described an action of the Harish-Chandra pair $(\Vect, \GL_n)$ on the classical $\beta\gamma$ system. 
This theory can thus be treated by Gelfand-Kazhdan formal geometry.
We develop this reasoning more fully in Section \ref{sec comparison}. 
In particular, in the next section we will show that this theory descends to the classical curved $\beta\gamma$ system where the target is a complex manifold $X$; more precisely, we will identify this theory with the theory defined by Costello in \cite{WG2}.
\end{rmk}

%\owen{I don't quite understand the remark below.}

%\begin{rmk} 
%We have already discussed how biholomorphisms act on the
%  global $\beta \gamma$ system. The $\infty$-jet of a biholomorphism
%  determines a formal vector field. Moreover, the local functional $I_X^{\rm W}$, or
%  more precisely its BV bracket $\{I_X^{\rm W},-\}$, is the power series
 % expansion of the action of the original biholomorphism.
%\end{rmk}

As explained in Section \ref{sec DDT}, we can identify this map
$I^{\rm W}$ with a Maurer-Cartan element $\clies(\Vect,
{\rm C}^*_{\rm loc}(\DD\fgn^S))$. Explicitly, this identification means that
\be\label{MC1}
(\d_{\Vect} \tensor 1 + 1 \tensor \dbar)I^{\rm W} + \frac{1}{2} \{I^{\rm W}, I^{\rm W}\} =
0 .
\ee
In fact, given our formula for the local functional, it is natural to view $I^{\rm W}$ as a function of $X \in \Vect$ and the fields $\gamma$ and $\beta$.
We thus have the following cochain complex, which plays a crucial role in studying the formal $\beta\gamma$ system as a $\Vect$-equivariant BV theory.

\subsubsection{The relation to the formal Atiyah class} \label{sec atiyah 2}

In this section we describe how the local functional $I^{\rm W}$, which encodes the action of formal vector fields on the classical theory, is related to the Gelfand-Fuks-Atiyah class from Section~\ref{sec gk descent}. 

We have already discussed the action of $\Vect$ on the dg Lie algebra $\fg_n$ and its
dual $\fg_n^\vee$ and how this determines an action on the dg Lie
algebra $\DD \fg_n^S$ which is encoded by the Maurer-Cartan element $I^{\rm W} \in \clie^*(\Vect) \tensor \cloc^*(\DD \fg_n^S)[-1]$. 

Fix $S = \CC$ and use the natural framing of the tangent bundle by $\partial_z$ to write
$\Omega^{0,*}(S) = C^\infty(\CC) \tensor \CC[\d \zbar]$. Similarly,
$\Omega^{1,*}(\CC) = C^\infty(\CC)[\d \zbar] \d z$. Using this
notation, we find a decomposition
\be\label{decomposition}
\DD \fg_n^S = C^\infty(\CC) \tensor \left((\fg_n \oplus \fg_n \,\d \zbar) \oplus (\fg_n^\vee[-2] \oplus \fg_n^\vee[-2] \, \d \zbar)
  \, \d z\right)
\ee
as the tensor product of a commutative algebra $C^\infty(\CC)$ and a graded Lie algebra.
(The differential on the dg Lie algebra does not respect this decomposition.)

It will be convenient to analyze $I^{\rm W}$ in terms of this decomposition.
To be more precise, we consider the local functional $I^{\rm W}_X$ for each formal vector field $X$ of the form $a^i \partial_i$, where the coefficient $a^i \in \hO_n$ is a homogeneous polynomial. 
Observe then that $I^{{\rm W}}_X$ is itself a homogeneous local functional of the form
\ben
I^{{\rm W}}_X : \Sym^{k+1}(\DD \fg_n^S) \to \CC 
\een 
where $a^i$ has polynomial degree~$k$.
Using the decomposition (\ref{decomposition}), 
we can write $I^{{\rm W}}_X$ as $I^{{\rm W}, an}_X I^{{\rm W},alg}_X$, 
a product of an analytic factor times a algebraic factor with $I^{{\rm W},an}_X \in \Sym^{k+1}(C^\infty(\CC)^\vee)$ and with
\ben
I^{{\rm W}, alg}_X \in \clie^*\left((\fg_n \oplus \fg_n \,\d \zbar) \oplus (\fg_n^\vee[-2] \oplus \fg_n^\vee[-2] \, \d \zbar) \, \d z\right)
\een 
Moreover, $I^{\rm W}$ is linear in the inputs $\fg_n \, \d \zbar$ and $(\fg_n^\vee[-2] \oplus \fg_n^\vee[-2] \, \d \zbar)\,\d z$,
as there must be precisely one $\d z$ and $\d \zbar$ for the integral (\ref{eqn noether}) to be nonzero.
Thus, we see that the algebraic factor is an element in
\ben
I^{{\rm W},alg}_X \in \clie^*\left(\fg_n ; (\fg_n \, \d \zbar)^\vee[-1] \tensor \fg_n[1]\right) .
\een 
For the rest of this section, we suppress $\d \zbar$ from the notation and identify the right-hand side with $\hO_n \tensor \End(T_0)$ where $T_0 = \fg_n[1] = \CC^n$ is the space of constant vector fields.

The formal de Rham differential $\d_{dR} : \hO_n \to \hOmega^1_n$ determines a map
\ben
\d_{dR} \tensor 1 : \hO_n \tensor_\CC \End(T_0) 
\to \hOmega^1_n \tensor_\CC \End(T_0) .
\een
which is reminiscent of equipping a vector bundle with a connection after specifying a global frame.

We have, as a corollary of Proposition \ref{atiyahprop1}, the
following relationship of the functional $I^{{\rm W}, alg}$ to the
Gelfand-Fuks-Atiyah class. 

\begin{cor} \label{atiyah and IW}
For each $X \in \Vect$ of homogenous degree $k$,
\ben
(\d_{dR} \tensor 1) I^{{\rm W}, alg}_X =  \At^{\rm GF}(\hT_n)(X) \in \hOmega^1_n \tensor_{\hO} \End(\hT_n)
\een 
where  $\At^{\rm GF}(\hT_n)$ is the Gelfand-Fuks-Atiyah class of the formal
vector bundle $\hT_n$.
\end{cor}

\begin{proof}
We can think of $X \mapsto I^{{\rm W}, alg}_X$ as a linear map
\ben
I^{{\rm W},alg} : \Vect \to \hO_n \tensor_\CC \End(T_0) ,
\een
or equivalently as a linear map $I^{{\rm W}, alg} : \Vect \tensor T_0 \to \hT_n$. 
This map is, in fact, the restriction of the action $\rho_{\hT_n}$ of $\Vect$ on the formal tangent bundle $\hT_n$ to the space $T_0 = \CC^n$, the space of constant sections of $\hT_n$.
That is, $\rho_{\hT_n}|_{\Vect \tensor T_0} = I^{{\rm W}, alg}$. Proposition \ref{atiyahprop1} then implies that $(\d_{dR} \tensor 1) I^{{\rm W},alg}$ is a representative for the Gelfand-Fuks-Atiyah class.
\end{proof}

%\owen{This paragraph is false! So too is what we say afterward. The factorization is more subtle than that.}
%In terms of this decomposition, the functionals that are homogeneous of degree $k$ live in
%\[
%\Sym^k(C^\infty(\CC)^\vee) \otimes \Sym^k(\fg_n^\vee[-1]).
%\]
%Note that the left hand factor is analytical in nature and only depends on the source manifold $S$,
%whereas the right hand factor is algebraic in nature and only depends on the target formal $n$-disk.
%For many of the local functionals we work with, their components of homogeneous degree $k$ factor as a product of two terms.
%For instance, if we fix a vector fields $X$ and consider $I^{\rm W}_X$, 
%its degree $k$ component is a product $I^{\rm W, k, an}_X I^{\rm W, k,alg}_X$. In fact, $I^{\rm W, alg}$ is a cocycle, which is a consequence of the fact that $I^{\rm W}$ is a Maurer-Cartan element.

%In terms of this decomposition, 
%one can view a local functional $I$ as factoring into a product $I^{\rm an} I^{\rm alg}$ of an analytic and algebraic component,
%where $I^{\rm an}$ is a functional on $\Vect \tensor C^\infty(\CC)$ and 
%$I^{\rm alg}$ is a functional on $\Vect$ and the other algebraic piece in the decomposition. 
%More correctly, a local functional that is homogeneous of degree $k$ can be factored

\subsubsection{Equivariant deformation complex} \label{sec eq def cplx}

We can now make the following deformation complex that controls $\Vect$-equivariant deformations of the classical theory. 

\begin{dfn}
The {\em $\Vect$-equivariant obstruction-deformation complex} is 
the graded vector space $\cSym(\Vect^\vee[-1]) \otimes {\rm C}^\sharp_{\rm loc}(\DD\fgn^S)$ 
equipped with the differential $\d_{\Vect} + \dbar + \{I^{\rm W},-\}$, 
where $\d_{\Vect}$ denotes the differential from $\clies(\Vect)$
and $\dbar$ denotes the differential from ${\rm C}^*_{\rm loc}(\DD\fgn^S)$.
We use $\Def^{\rm W}_n$ to denote this complex.
\end{dfn}

In other words, this complex is the tensor product $\clies(\Vect) \otimes {\rm C}^*_{\rm loc}(\DD\fgn^S)$
twisted by $I^{\rm W}$ as the twisting cochain.
It encodes succinctly how the formal vector fields $\Vect$ act on the local functionals of the field theory.
Its role in the equivariant BV formalism is analogous to the role of the non-equivariant obstruction-deformation complex in the BV formalism:
\begin{itemize}
\item first-order deformations of the formal $\beta\gamma$ system as a $\Vect$-equivariant classical BV theory live in the zeroth cohomology~and
\item the obstruction to equivariant BV quantization modulo $\hbar^2$ lives in the first cohomology.
\end{itemize}
Hence it behooves us to compute its cohomology.
We will find a particularly nice answer after further constraining the problem.

There are two further symmetries of this theory that we will exploit.
First, there is a natural scaling action of $\CC^\times$ on the fibers of the cotangent bundle (as on any vector bundle)
that scales the $\beta$ fields of the $\beta\gamma$ system.
The action functional has ``weight one'' with respect to this scaling action.
In our setting there is thus an action of $\CC^\times$ on $\DD \fgn^S$ given by scaling the $\beta$ fields. 
Second, we restrict now to the Riemann surface is $S = \CC$ and 
note that affine linear automorphisms ${\rm Aff}(\CC) = \CC \ltimes \CC^\times$ preserve the action functional
of the $\beta\gamma$ system.
%(Later, in Section \owen{ref}, we will consider instead how holomorphic vector fields act on local functionals
%and hence determine the central charge of the quantized theory.)
We are only interested in the subcomplex of $\Def^{W}_n$ consisting of local functionals that are weight zero under the scaling action and invariant under the $\Aff(\CC)$ action.
Then we have the subcomplex
\ben
(\Def_n)^{\CC^\times \times {\rm Aff}(\CC)} \subset \Def_n
\een
and its equivariant version $(\Def^{\rm W}_n)^{\CC^\times \times {\rm
    Aff}(\CC)} \subset \Def_n^{\rm W}$.

\begin{prop}\label{eqdef} 
There is a quasi-isomorphism of $\Vect$-modules
\ben
J : \hOmega^2_{n,cl}[1]  \xto{\simeq} (\Def_n)^{\CC^\times \times {\rm Aff}(\CC)} .
\een
Applying the functor $\clie^*(\Vect ; -)$, we obtain a quasi-isomorphism
\be\label{trans}
J^{\rm W} : \clie^*(\Vect, \hOmega^2_{n,cl}[1]  ) \xto{\simeq} (\Def_n^{\rm W})^{\CC^\times \times {\rm Aff}(\CC)}.
\ee
\end{prop}

The proof of this result is in Section \ref{seceqdef}, but first we will have to describe the map $J$ in the above proposition,
which is the subject of the next section.

This quasi-isomorphism $J$ is, in fact, $(\Vect, \GL_n)$-equivariant.
Let us note an important consequence of this proposition.


\begin{cor}\label{gerbe of obsdef}
The Gelfand-Kazhdan descent along a complex manifold $X$ 
of the $(\Vect, \GL_n)$-module $(\Def_n)^{\CC^\times \times {\rm Aff}(\CC)}$ 
returns a sheaf of dg vector spaces that is quasi-isomorphic to the sheaf~$\Omega^2_{X,cl}[1]$. 
\end{cor}

In particular we have the following description over a general manifold:
\begin{itemize}
\item[(1)] the space of anomalies of the theory over $X$ is
$H^2(X, \Omega^2_{X,cl})$,
\item[(2)] the space of deformations over $X$ is $H^1(X, \Omega^2_{X,cl})$ and
\item[(3)] the space of automorphisms over $X$ is $H^0(X, \Omega^2_{n,cl})$.
\end{itemize}
This description matches precisely with the study of deformations of the curved
$\beta\gamma$ system as in~\cite{WittenCDO,Nek}. 

\subsection{Closed two-forms as local functionals} \label{sec j functional}

We have already seen how vector fields yield local functionals of the formal $\beta\gamma$-system 
and thus give it the structure of an equivariant BV theory. 
In this section we will show how closed two-forms yield
local functionals of $\gamma$, i.e., only of the subspace of fields $\Omega^{0,*}(S ;\fg_n[1])$. 
That is, we define a linear map
\ben
J : \hOmega^2_{n,cl} \to \Cloc^*(\fg_n^S)
\een 
and use $J_\omega$ to denote the image of $\omega$. 
This map will exhibit the quasi-isomorphism of Proposition \ref{eqdef}. 

% This map has the following geometric interpretation in the global
% holomorphic $\sigma$-model. Recall, the
% fundamental fields of the theory consist of a map $\gamma : S \to
% X$ together with a one-form $\beta \in \Gamma(K_S \tensor \gamma^*
% T X)$. Choose a disk $D \subset X$ inside of $X$. By the Poincar\'{e}
% lemma every closed two-form $\omega$ on $D$ is exact, hence there is a
% one-form $\theta$ such that $\d \theta = \omega$. We obtain a one-form
% on $S$ via pulling back $\gamma^* S$. 

%  Given a one-form $\theta \in \hOmega^1_n$ on the formal
% disk we can consider the pull-back along $\gamma$, which is a section
% $\gamma^* \theta \in \Gamma(\gamma^* T^* \hD^n)$. 

\begin{rmk}
This map has the following geometric interpretation. 
On the formal disk, every closed two-form $\omega$ is exact, 
so that $\omega = \d \theta$ for some $\theta \in \hOmega^1_n$. 
Use the field $\gamma : S \to \hD^n$ to pull back this one-form to the one-form $\gamma^* \theta$ on $S$.
We interpret this one-form as a {\em current}; 
we can integrate it around any closed one-cycle in $S$ to get a function of $\gamma$. 
We denote this current by $\Tilde{J}_\theta$, where $\Tilde{J}_\theta(\gamma)= \gamma^* \theta.$
By Stokes theorem, this current vanishes if $\theta$ is exact, 
so the local functional only depends, in fact, on the corresponding closed two-form $\d \theta$.
Hence we write $J_{\d\theta} = \Tilde{J}_\theta$. 
\end{rmk}

\subsubsection{Defining $J$}
\label{defining J}

Although pulling back forms is easy, 
we wish to rewrite this construction in terms of $\fg_n$
and hence we need to describe pullback under Koszul duality.
Thus, to define $J$, we need to introduce a few constructions. 

First, there is an assignment
\ben
(-)^S : \hO_n \to {\rm Hom}_{\CC} \left( \Sym(\Omega^{0,*}_S \tensor \fg_n[1]), \Omega^{0,*}_S\right) 
\een
that promotes a function on the formal $n$-disk to a function on the formal moduli space $\fg_n^S$ with values in holomorphic functions on $S$.
It goes as follows.
Given an input $f \in \hO_n$, let $f_k$ denote its homogeneous component of degree $k$. 
View $f_k$ as a linear map $f_k : \Sym^k(\fg_n[1]) \to \CC$. 
We then define 
\ben
\begin{array}{cccc}
f^S_k : & \Sym^k(\Omega^{0,*}_S \tensor \fg_n[1]) & \to & \Omega^{0,*}_S \\ 
&(\gamma_1 \tensor \xi_1) \cdots (\gamma_k \tensor \xi_k) & \mapsto &
(\gamma_1 \wedge \cdots \wedge \gamma_k) f(\xi_1, \cdots, \xi_k) 
\end{array}
\een
Extend to non-homogenous elements by linearity so that $f^S = \sum_k f^S_k$. 
%Note that $\tau$ is simply base change along $\CC \to \Omega^{0,*}_S$ sending the unit to the constant function $1$

Similarly, a one-form on the formal disk $\theta \in \hOmega^1_n = \clie^*(\fg_n ;\fg_n^\vee[-1])$ 
encodes a linear map $\theta : \Sym(\fg_n[1]) \to \fg_n^\vee[-1]$. 
Let $\theta_k : \Sym^k(\fg_n[1]) \to \fg_n^\vee[-1]$ be its homogenous component of degree $k$. 
As above, there is a natural linear map
\ben
\begin{array}{cccc}
\theta^S_k :  & \Sym^k(\Omega^{0,*}_S \tensor \fg_n[1]) & \to & \Omega^{0,*}_S \tensor
\fg_n^\vee[-1] \\ 
&(\gamma_1 \tensor \xi_1) \cdots (\gamma_k \tensor \xi_k) & \mapsto &
(\gamma_1 \wedge \cdots \wedge \gamma_k) \tensor \theta_k(\xi_1, \cdots, \xi_k) 
\end{array}
\een
Let $\theta^S = \sum_k \theta^S_k$, as above.

Each one-form $\theta$ thus determines a local function $\Tilde{J}_\theta \in \cloc^*(\fg_n^S)$ by the formula
\ben
\Tilde{J}_\theta (\gamma) = \sum_k \int_S \<\theta^S_k \left(\gamma^{\tensor k}\right), \partial \gamma \>_{\fgn}.
\een 
Explicitly, if $\theta = t_1^{m_1} \cdots t_n^{m_n} \d t_j$ is
monomial one-form, then we have
\ben
\Tilde{J}_\theta (\gamma) = \int_S \gamma_1^{m_1} \wedge \cdots \wedge
\gamma_n^{m_n} \wedge \partial \gamma_j .
\een 
For shorthand notation, we will write $\Tilde{J}_{\theta} = \int_S
\<\theta^S(\gamma), \partial \gamma\>_{\fg_n}$ where the sum over
homogenous components is implicit. 

%To treat $\theta$ as a parameter, we view $\hOmega^1_n$ as an abelian Lie algebra 
%and $\clies(\hOmega^1_n)$ as the ring of functions on the associated space of one-forms.
%Then the formula defines $J' \in \clie^1(\hOmega^1_n ;
%\cloc^*(\fg_n^S))$.

We tie up the properties of the functional $\Tilde{J}$ in the following proposition, proved below. 

\begin{prop} \label{jmap} 
The assignment $\theta \mapsto \Tilde{J}_\theta$ satisfies:
\begin{itemize}
\item[(1)] For all $\theta$, the local functional $\Tilde{J}_\theta$ is $\dbar$-closed
  inside $\Def_n$ and lies in the subcomplex $(\Def_n)^{\CC^\times \times {\rm
    Aff}(\CC)}$.
\item[(2)] The assignment $\theta \mapsto \Tilde{J}_\theta$ is
  $\Vect$-equivariant. That is, $\Tilde{J}_{L_X \theta} = X \cdot
  J_\theta$ where $X \cdot (-)$ denotes the action of vector fields on
  functionals and $L_X$ is the Lie derivative.
\item[(3)] The functional $\Tilde{J}_\theta$ is identically zero if $\theta$
  is an exact one-form. 
\end{itemize}
Thus, $\Tilde{J}$ descends to a $\Vect$-equivariant map
\ben
J : \hOmega^2_{n,cl} [1] \to (\Def_n)^{\CC^\times \times {\rm Aff}(\CC)} 
\een
that we denote $\omega \mapsto J_\omega$. 
Here $J_\omega =\Tilde{J}_{\theta}$, where $\theta$ is any one-form satisfying $\d \theta = \omega$. 
\end{prop}

\subsubsection{Understanding $J$}

The formula for the functional $\Tilde{J}_\theta$ is best understood 
as integration over $S$ after applying an operator $\mathbf{J}$ valued in densities. 
We continue to describe everything via the homogeneous components $\theta_k$ of $\theta$.

First, for each homogeneous degree $k$, consider the composition
\ben
\begin{array}{ccc}
\Sym^k(\Omega^{0,*}_S \tensor \fgn[1] ) \tensor (\Omega^{0,*}_S \tensor
\fg[1]) & \xto{1 \tensor \partial} & \Sym(\Omega^{0,*}_S \tensor \fgn[1])
\tensor (\Omega^{1,*}_S \tensor \fg) \\ & \xto{\theta_k^S \tensor 1} &
(\Omega^{0,*}_S \tensor \fg_n^\vee[-1]) \tensor (\Omega^{1,*}_S
\tensor \fg_n[1]) \\ & \xto{\<-,-\>_\fg} & \Omega^{1,*} .
\end{array}
\een 
Here, $\<-,-\>_\fg$ is the evaluation pairing between $\fg_n[1]$ and $\fg_n^\vee[-1]$. 
We then symmetrize the composite to obtain the $(k+1)$th homogenous component of $\mathbf{J}_\theta$:
\[
(\mathbf{J}_\theta)_{k+1} : \Sym^{k+1}(\Omega^{0,*}_S \tensor \fg_n) \to \Omega^{1,*}_S. 
\]
In this notation, we have $\Tilde{J}_\theta = \int_S \mathbf{J}_\theta$. 

Before proving the main result, we make the following simple observations about the functional $\mathbf{J}$. 

\begin{lemma} \label{easy} 
For $f \in \hO_n$ and $\theta \in \hOmega^1_n$,
\begin{itemize}
\item[(1)] $\mathbf{J}_{f \theta} = f^S \wedge
  \mathbf{J}_\theta$ and
\item[(2)] $\mathbf{J}_{\d_{dR} f} = \partial \circ f^S$. 
\end{itemize}
\end{lemma} 

\begin{proof}
For simplicity, suppose $f$ is of homogenous degree $k$ and $\theta$ of homogenous degree $l$.  
Then $f \theta$ defines a linear map 
\[
\begin{array}{ccccc}
\Sym^{k+l}(\fg_n[1]) & \to & \Sym^{k}(\fg_n[1]) \tensor \Sym^l(\fg_n[1]) & \to & \fg_n^\vee[-1]\\
\xi_1,\ldots,\xi_k \xi_1',\ldots,\xi_l' & \mapsto & (\xi_1,\ldots,\xi_k) \otimes (\xi_1',\ldots,\xi_l') & \mapsto & f(\xi_1,\ldots,\xi_k) \theta(\xi_1',\ldots,\xi_l')
\end{array}.
\]
Thus, $(f \theta)^S = f^S \theta^S$, from which (1) follows.

We now show (2). Consider the special case of a linear functional $\tau : \fgn[1] \to \CC$, viewed as linear element of $\hO_n$.
The one-form $\d_{dR}(\tau)$ corresponds to the very simple functional $\Sym^0(\fgn[1]) \to \fg_n^\vee[-1]$ sending $1 \mapsto \tau$. 
Thus, $\mathbf{J}_{\d_{dR} \tau} = \partial(\tau^S)$. 
To see (2) in general, we note that both the left and right hand sides are derivations with respect to the product of functions. 
Indeed, if $f,g \in \clie^*(\fgn)$, then $\partial((fg)^S)) = \partial(f^S g^S) = \partial(f^S)\wedge g^S + f^S \partial(g^S)$. 
\end{proof}

\begin{proof}[Proof of Proposition \ref{jmap}]
Observe that the functional $\mathbf{J}_\theta$ is described by
applying a constant coefficient holomorphic differential operator to
the fields $\gamma$. Thus $\mathbf{J}_\theta$ is clearly holomorphic
and invariant under affine linear transformations. It follows that
$\Tilde{J}_\theta$ is holomorphic, that is $\dbar \Tilde{J}_\theta = 0$, and hence it is
closed in $\Def_n$. This proves (1). 
8

The formula in (2) in Lemma \ref{easy} implies (3) since the integral
of a $\partial$-exact form is zero. Hence $\Tilde{J}$ defines a map
$J : \hOmega^2_{n,cl} \to \cloc^*(\fg_n^S)$. Explicitly, given a
closed two-form $\omega$ with $\d_{dR} \theta = \omega$ we have $J_\omega =
\Tilde{J}_\theta$. This proves (3). 

Finally, we show (2). We have seen in our discussion of the Noether
current that the action of a formal vector field $X$ on the
deformation complex is through the BV bracket with $I^{\rm
  W}_X$. Thus, we must show for all one-forms $\theta$ that
$\Tilde{J}_{L_X \theta} = \{I^{\rm W}_X, \Tilde{J}_\theta\}$. For
simplicity, suppose $X = \partial_i$, a constant vector field. Then, if we choose a homogenous one-form
$\theta = t_1^{m_1} \ldots t_n^{m_n} \d t_j$ then
\ben
L_X \theta =  m_i t_1^{m_1} \cdots t_k^{m_j -1} \cdots
t_n^{m_n} \d t_j . 
\een 
Now, to compute $\{I_X, \Tilde{\theta}\}$. The functional $I_X$ has a
single $\beta_i$ input that pairs with a single $\gamma_i$ input from the
functional $\Tilde{J}_\theta$. There are $m_i + \delta_{ij}$ such
$\gamma_i$ inputs, the $\delta_{ij}$ coming from the factor $\partial
\gamma_j$ in the definition of $\Tilde{J}_\theta$. So,
we obtain
\ben
\{I_X, \Tilde{J}_\theta\} (\gamma) = m_i \int_S \gamma_1^{m_1} \wedge
\cdots \wedge \gamma_j^{m_i-1} \wedge \cdots \gamma^{m_n}_n \partial \gamma_j
+ \delta_{ij}\int_S \partial (\gamma_1^{m_1} \wedge \cdots \wedge \gamma_n^{m_n}) .
\een
The first term is $\Tilde{J}_{L_X\theta}$. Being the integral of a
total derivative the second term vanishes, so we are done. The case of
a general formal vector field $X$ is similar. Indeed, suppose $X$ is
homogeneous of the form $X= t_1^{k_1} \cdots
t_n^{k_n} \partial_i$. Then for $\theta$ as above we have
\ben
L_X \theta = m_i t_1^{k_1 + m_1} \cdots t_i^{k_i + m_i - 1}
  \cdots t_n^{k_n + m_n} \d t_j + \delta_{ij} t_1^{m_1} \cdots t_n^{m_n} \d(t_1^{k_1} \cdots
t_n^{k_n}) .
\een
On the other hand, we compute directly
\bestar
\{I_X, \Tilde{J}_\theta\} & = & m_i \int_S \gamma_1^{k_1+m_1} \wedge \cdots
\wedge \gamma_i^{k_i + m_i - 1} \wedge\cdots \wedge \gamma_{n}^{k_n +
  m_n} \partial \gamma_j \\ & - & \delta_{ij} \int_S\partial(\gamma_1^{m_1}
\wedge \cdots \wedge \gamma_n^{m_n})\gamma_1^{k_1} \wedge
\cdots \wedge \gamma_n^{k_n}  .
\eestar
The first line comes from pairing the $\beta_j$ input from the
functional $I_X^{\rm W}$
with the $\gamma_i^{m_i}$ input from $\Tilde{J}_\theta$. The next term
comes from pairing the $\beta_i$ input with the $\partial \gamma_j$
input from $\Tilde{J}_\theta$ (there is a sign from integrating by
parts). Integration by parts again returns $\Tilde{J}_{L_X \theta}$ as
desired.
\end{proof}

%\subsection{Proof of Proposition \ref{eqdef}}\label{seceqdef}
\begin{proof}[Proof of Proposition \ref{eqdef}]
\label{seceqdef}

We have just seen that $J : \hOmega^2_{n,cl} \to \Def_n$ is
$\Vect$-equivariant. To complete the proof it suffices to show that we have a $\Vect$-equivariant equivalence $(\Def_n)^{\CC^\times \times {\rm
    Aff}(\CC)} \simeq \hOmega^2_{n,cl}[1]$. With $\fgn$ as the choice of the $\L8$ algebra $\fg$, 
this equivalence appears as Proposition 15.1.1 in \cite{WG2},
whose proof we will review in order to keep track of the $\Vect$-action. 

First, observe that by restricting to weight zero local functionals under the scaling action, 
we only consider functionals that are independent of $\beta$.
This constraint implies that 
\[
(\Def_n)^{\CC^\times \times {\rm Aff}(\CC)} \cong {\rm C}^*_{\rm loc}(\Omega^{0,*}(\CC, \fgn))^{{\rm Aff}(\CC)},
\] 
since we can write any such functional as a wedge product of $\beta$ with a nontrivial Lagrangian in $\gamma$.
Following Chapter 5, Section 6 of \cite{CosBook}, we exploit a
description of translation invariant local functionals via $D$-modules:
\be\label{eqn jet}
\Cloc^*\left(\Omega^{0,*}(\CC, \fg_{\hD^n})\right)^\CC 
\cong \CC \, \d z \, \d \zbar \otimes_{D_{\CC}} \Cred^*\left({\rm Jet}_0(\Omega^{0,*}(\CC ; \fgn))\right),
\ee
where $\text{Jet}_0$ denotes jets of sections at zero of
$\Omega^{0,*}(\CC ; \fg_n)$. 

Using $z$ for the holomorphic coordinate on $\CC$, we have
\ben
{\rm Jet}_0(\Omega^{0,*}(\CC, \fgn)) \cong \fgn \llbracket z, \zbar, \d \zbar \rrbracket.
\een 
and thus the identification (\ref{eqn jet}) is manifestly $\Vect$-equivariant. 
It follows that we have a $\Vect$-equivariant quasi-isomorphism
\ben
(\Def)^{\CC^\times \times \CC} \simeq \CC\, \d z \wedge \d \zbar \otimes_{\CC[\partial_z, \partial_{\zbar}]} \Cred^*(\fgn\llbracket z , \zbar, \d \zbar \rrbracket)
\een
where on the left-hand side we are taking ivariants with respect to $\CC^\times \times \CC \subset \CC^\times \times (\CC \ltimes \CC^\times) = \CC^\times \times {\rm Aff}(\CC)$. So, we only need to compute the $\CC^\times$-invariants of the right-hand side. Here $\CC^\times$ acts by scaling space-time.

The quasi-isomorphism of dg Lie algebras
\ben
(\fgn \llbracket z
\rrbracket,0) \xto{\simeq} \left(\fgn \llbracket z,
  \zbar, \d \zbar \rrbracket, \dbar\right)
\een
is obviously $\Vect$-equivariant. Finally, Costello's calculation implies that (in the case that $\fg = \fgn$) we have
\ben
\left(\CC\, \d z \wedge \d \zbar \otimes^{\mathbb{L}}_{\CC[\partial_z, \partial_{\zbar}]} \Cred^*(\fgn\llbracket z \rrbracket)\right) \simeq (\CC \to\hOmega^0_n \to \hOmega^1_n)[3].
\een
(That means the cochain complex on the right hand side starts with $\CC$ in degree $-3$.)
Moreover, the right-hand side is quasi-isomorphic via the de Rham differential to
\ben
\left(\hOmega^2_n [1] \to \hOmega^3_n [0] \to \cdots\right) \simeq \hOmega^2_{n,cl} [1].
\een
This identification is clearly $\Vect$-equivariant.
\end{proof}

\subsection{Holomorphic vector fields on the source} \label{sec hol vf}

We digress momentarily to describe another important symmetry present in the $\beta\gamma$ system:
%The two-dimensional $\sigma$-model of all maps from a Riemann surface $S$ to a complex manifold is classically conformal. 
the holomorphic $\sigma$-model possesses a natural symmetry of the Lie algebra of holomorphic vector fields $T_S = T^{1,0}_S$, 
much as the usual $\sigma$-model is conformal as a classical field theory.  
We will formulate this symmetry on the formal $\beta\gamma$ system. 

It is convenient for us to work with the Dolbeault resolution of holomorphic vector fields: 
define the dg Lie algebra 
\ben
\cT_S = \Omega^{0,*}(S ; T_S) 
\een
with differential given by $\dbar$ and Lie bracket given by the
extension of the Lie bracket of vector fields to $(0,*)$-forms. 
There is an action of $\cT_S$ on the Dolbeault complex $\Omega^{0,*}(S; \CC)^{\oplus n}$ given by Lie derivative of
$(0,*)$-forms:
\[
\xi \cdot (\gamma \tensor v) = (\cL_\xi \gamma) \tensor v.
\]
%\begin{align*}
%\cT_S \times \Omega^{0,*}(S ; \CC^n) & \to \Omega^{0,*}(S ; \CC^n) \\
%(\xi , \gamma \tensor v) & \mapsto (\cL_\xi \gamma) \tensor v .
%\end{align*}
(We use the script $\cL$ to denote the Lie derivative with respect to
vector fields on the source, to avoid confusing it with $L_X$, 
the Lie derivative of vector fields on the target.) 
This action extends to an action of $\cT_S$ on the ``double'' dg Lie algebra $\DD \fg^S_n$
so that it preserves the shifted pairing between $\gamma$ and $\beta$ fields.

This action can be encoded by a local functional, and hence we obtain a $\hT_S$-equivariant field theory.

\begin{lemma} The map of dg Lie algebras $\cL : \cT_S \to \Der(\DD
  \fg_n^S)$, sending a holomorphic vector field $\xi$ on $S$ to the
  derivation $\cL_\xi$, describes an
  action of holomorphic vector fields on the rank $n$ free
  $\beta\gamma$ system. Moreover, it has a lift to a map of dg Lie algebras
\[
\begin{array}{cccc}
I^{\cT} :& \cT_S & \to & \Def_n[-1] \\
& \xi & \mapsto & \<\beta, \cL_\xi \gamma\> \\
%&&&= \sum_{i=1}^n \int_S \beta_i \wedge \cL_\xi \gamma_i 
\end{array}
\]
along the map determined by the BV bracket $\{-,-\} : \Def_n[-1] \to
\Der(\DD \fg_n^S)$. 
\end{lemma}

\subsubsection{}

We wish to describe the equivariant obstruction-deformation complex
for the action of $\cT_S$. The functional $I^{\cT}$ endows the direct
sum $\cT_S \oplus \DD\fg_n^S$ with the structure of a local Lie
algebra. 
By definition, this equivariant obstruction-deformation complex
is given by the local cochains of this local Lie algebra
\ben
\Def_n^\cT = \cloc^*\left(\cT_S \ltimes \DD \fg_n^S\right) .
\een
where $\Def_n$ is the deformation complex for the formal $\beta\gamma$
system defined earlier. 
As $\cloc^*$ always involves taking the reduced Lie algebra cochains, 
there is a useful splitting of the deformation complex
\ben
\Def_n^{\cT} \cong \cloc^*(\cT_\CC) \oplus \cloc^*(\cT_\CC ; \Def_n),
\een
where $\Def_n$ is the deformation complex for the free $\beta\gamma$
system. 

For any complex manifold $Y$, the complex $\cloc^*(\cT_Y)$ has an
interpretation in terms of the diagonal cohomology of $Y$, studied by
\cite{Losik}. In the case of $Y = \CC$ it has a simple interpretation
in terms of Gelfand-Fuks cohomology.

\begin{prop}[Proposition 5.3 of \cite{bw_vir}] 
The cohomology of $\clie^*(\cT_\CC)$ is concentrated in degree one and is isomorphic to $H^3_{\rm Lie}({\rm W}_1)$. 
Hence, $H^*(\cloc^*(\cT_\CC)) \cong \CC [-1].$
\end{prop}

An explicit generator for the cohomology is given by the local cocycle 
\[
\begin{array}{lccc}
\omega^{\GF} : & \cT_{\CC} \times \cT_{\CC} & \to & \Omega^{1,1}(\CC) \\
& (\alpha \tensor \partial_z, \beta \tensor \partial_z) & \mapsto & \frac{1}{2\pi}\frac{1}{12} \left(
  \partial_z^3 \alpha^0 \beta^{0,1} +
  \partial_z^3\alpha^{0,1} \beta^0
\right) \d^2 z 
\end{array}
\]
where $\alpha = \alpha^0 + \alpha^{0,1} \d \zbar$ and similarly for $\beta$. 
(Note that we can integrate the density on the right whenever $\alpha$ or $\beta$ is compactly-supported,
but otherwise it is not integrable.
This situation is just like that with action functionals, where the Lagrangian density is the important information rather than the purported function.)

\begin{prop} 
There exists a map of dg Lie algebras
\ben
(\omega^{\GF}, J,K) : \CC [-2] \oplus \hOmega^1_{n}[-1] \oplus
\hOmega^2_{n,cl} \to \Def_n^\cT [-1]
\een
sending $(1, \omega, \eta)$ to $(\omega^{\GF}, J_\omega, K_\eta)$ where
\begin{itemize}
\item $\omega^{\GF} \in \cloc^*(\cT_\CC) \subset \Def_n^{\cT}$
  represents the generator of the Gelfand-Fuks cohomology $H^3_{\rm
    Lie}({\rm W}_1) \cong \CC$; 
\item for every $\mu \in \hOmega^2_{n,cl}$, the functional $J_\mu
  \in \Def_n \subset \Def_n^\cT$ is the one defined in Section~\ref{sec j functional}; and
\item for $\eta \in \hOmega^1_n$, $K_\eta$ is the cocycle in $\cloc^1(\cT_\CC ; \Def_n)$ defined by
\ben
K_\eta(\xi, \gamma) = \int_\CC \partial_z \xi^0
\<\eta^S(\gamma), \partial \gamma\>_{\fg_n} + \int_\CC \partial_z
\xi^{0,1} \d \zbar \<\eta^S(\gamma), \partial \gamma\>_{\fg_n} 
\een
where $\xi = \xi^0 \partial_z + \xi^{0,1} \d
  \zbar \,\partial_z$ is an element of $\cT_\CC$.
\end{itemize}
Moreover, this map is equivariant for the action of formal vector
fields~$\Vect$. 
\end{prop}

\begin{proof}
The assignment $\CC \to \cloc^*(\cT_\CC)$ sending $1 \mapsto \omega^{\GF}$ is tautologically
$\Vect$-equivariant. Moreover, we have already shown that the assignment
$J : \hOmega^2_{n,cl}[1] \to \Def_n$ is $\Vect$-equivariant. 

Thus, it suffices to show that $K : \hOmega^1 \to \cloc^*(\cT_\CC ;
\Def_n)$ is $\Vect$-equivariant. It suffices to check that
for all $\eta \in \hOmega^1_n$ and $X \in \Vect$, 
\ben
K_{L_X \eta} = \{I_X^{\rm W}, K_\eta\} .
\een  
This computation is parallel to the calculation in the proof of Proposition \ref{jmap}. 
\end{proof}

As a corollary we obtain a map of cochain complexes upon
applying the functor $\clie^*(\Vect ; -)$:
\ben
(\omega^{GF}, K, J) : \CC[-1] \oplus \clie^*\left( \Vect ; \Omega^1_{n} \oplus
\Omega^2_{n,cl}[1] \right) \to \clie^*(\Vect ; \Def_n^\cT) .
\een 
The complex $\clie^*(\Vect ; \Def_n^\cT)$ controls equivariant
deformations for both the Lie algebra $\Vect$ {\em and} $\cT_\CC$. The
map $(\omega^{\GF},K,J)$ will allow us to identify elements of the
deformation complex with ordinary characteristic classes. 

% \begin{rmk} There is an action of $\CC^\times$ on the deformation
%  complex $\Def^{\cT}_n$ by scaling the cotangent fiber. We do not use
%  the full calculation of the deformation complex here, though in
%   future work we will show that there is a $\Vect$-equivariant quasi-isomorphism
% \ben
% \left(\Def^\cT_n\right)^{\CC^\times} \simeq \; \CC[-1] \oplus
% \hOmega^1_{n,cl}[-1] \oplus \hOmega^1_n \oplus \hOmega^2_{n,cl}[1] .
% \een 
% \end{rmk}

\section{Equivariant BV quantization of the formal $\beta\gamma$
  system}\label{sec equiv bv}

The free $\beta\gamma$ system is a free BV theory and hence admits a natural quantization.
(See Chapter 6 of \cite{GwThesis} for an extensive development.)  
This quantization is easily modified to encompass the formal $\beta\gamma$ system,
but here we want to quantize \emph{equivariantly} with respect to the action of $\Vect$.
We will find that there is an obstruction to quantizing equivariantly, 
given by the Gelfand-Fuks Chern class $\ch_2^{GF}(\hT_n)$ defined in Section \ref{sec gk cc}. 
This obstruction is a very local avatar of the anomaly described by Witten and Nekrasov \cite{WittenCDO,Nek},
and we will see in Part III that it corresponds in a very precise way to the obstruction to constructing CDOs
found by \cite{MSV, GMS} as described in Section \ref{sec vertex alg}.

There is, however, an equivariant quantization for a natural action of $\TVect$, 
the extension of formal vector fields $\Vect$ by closed two-forms
$\hOmega^2_{cl}$ introduced in Section \ref{sec gk descent}. 
In fact, we will see that the space of closed two-forms is precisely the space of deformations for the $\beta\gamma$ system. 
We construct this quantization explicitly using Feynman diagrams and, in later sections, explain when and how it descends to complex manifolds.

Most of this section is devoted to formulating precisely what equivariant BV quantization means and then proving the following result.

\begin{thm} \label{bvq} 
There is a unique (up to contractible choice) $\TVect$-equivariant and $\CC^\times \times \Aff(\CC)$-invariant quantization 
of the $\beta\gamma$ system on $\CC$ with target $\hD^n$.
\end{thm}

By an $\Aff(\CC)$-invariant quantization, we mean one that is invariant with respect to the action of affine symmetries of the complex line (i.e., translation and dilation by complex numbers). 
The $\CC^\times$-symmetry condition says that the quantization has weight one with respect to scaling the $\beta$ fields, which can viewed as scaling the cotangent fibers of $T^*\hD^n$.
(See the discussion preceding Proposition \ref{eqdef}.)

\subsection{Recollections on equivariant BV quantization} \label{sec equiv bv 1}

In this section we discuss what it means for a Lie algebra $\fh$ to act on a quantum field theory.
To be more precise, we review the formalism developed in \cite{CG2}, notably for the factorization Noether theorems  (see chapters 11 and 12).
A key idea is to make $\clies(\fh)$ the base ring over which the field theory is defined, rather than the complex numbers $\CC$.
Under the dictionary discussed in Section \ref{sec DDT}, this approach should encode how the Lie algebra $\fh$ acts on the theory.
We have already seen this idea deployed for the classical field theory, 
by interpreting the local functional $I^{\rm W}$ of Lemma \ref{Noether} as a Maurer-Cartan element.

Recall that in the BV formalism, as developed in \cite{CosBook,CG2}, 
a quantum BV theory consists of a space of fields and an effective action functional $\{S[L]\}_{L \in (0,\infty)}$,
which is a family of non-local functionals on the fields that are parametrized by a length scale $L$ 
and satisfy
\begin{enumerate}[(a)]
\item an exact renormalization group (RG) flow equation,
\item the scale $L$ quantum master equation (QME) at every length scale $L$,~and
\item as $L \to 0$, the functional $S[L]$ has an asymptotic expansion that is local.
\end{enumerate}
The first condition ensures that the scale $L$ action functional $S[L]$ determines the functional at every other scale.
The second can be interpreted as saying that we have a proper path integral measure at scale $L$ 
(i.e., the QME can be seen as a definition of the measure).
The third condition implies that the effective action is a quantization of a classical field theory,
since a defining property of a classical theory is that its action functional is local.
(A full definition is available in Section 8.2 of~\cite{CG2}.)

\begin{rmk}
The length scale is associated with a choice of Riemannian metric on the underlying manifold,
but the formalism of \cite{CosBook} keeps track of how the space of quantum BV theories depends upon such a choice 
(and other choices that might go into issues like renormalization).
Hence, when the choices should not be essential --- such as with a topological field theory --- one can typically show rigorously that different choices give equivalent answers.
The length scale is also connected with the use of heat kernels in \cite{CosBook},
but one can work with more general parametrices (and hence more general notions of ``scale''),
as explained in Chapter 8 of \cite{CG2}.
We use a natural length scale in this section; 
when it becomes relevant, in the context of factorization algebras, we switch to general parametrices.
\end{rmk}

If we start with an $\fh$-equivariant classical BV theory $\cE$ with action functional $S$ --- so that $\fh$ has an $\L8$ action on the fields that preserves the pairing and the action functional $S$ --- then we can encode the action of $\fh$ as a Maurer-Cartan element $I^\fh$ in $\clies(\fh) \otimes {\rm C}^*_{\rm loc}(\cE)$.
(For the formal $\beta\gamma$ system, we did this in Lemma \ref{Noether}.)
We then view the sum $S + I^\fh$ as the \emph{equivariant} action functional:
the operator $\d_{\clies(\fh)} + \{S+ I^\fh,-\}$ is the twisted differential on $\clies(\fh) \otimes {\rm C}^*_{\rm loc}(\cE)$ with $I^\fh$ as the twisting cocycle,
and this operator is square-zero because $\d_{\clies(\fh)}(S + I^\fh) + \{S + I^\fh, S+ I^\fh\}$ is a ``constant'' (i.e., lives in $\clies(\fh)$ and hence is annihilated by the BV bracket).\si

This perspective suggests the following definition of an equivariant quantum BV theory.
The starting data is two-fold:
an $\fh$-equivariant classical BV theory with equivariant action functional $S+I^\fh$, 
and a BV quantization $\{S[L]\}$ of the non-equivariant action functional $S$.
Following Costello, it is convenient to write $S$ as $S_{\text{free}} + I$, 
where the first ``free'' term is a quadratic functional and the second ``interaction'' term is cubic and higher.
In this situation, the effective action $S[L] = S_{\text{free}} + I[L]$, 
i.e., only the interaction changes with the length scale.

\begin{dfn} \label{eqQFT} 
An {\em $\fh$-equivariant BV quantization} is a collection of effective interactions $\{I^\fh[L]\}_{L \in (0\infty)}$
satisfying
\begin{enumerate}[(a)]
\item the RG flow equation
\[
W(P_\epsilon^L, I[\epsilon]+I^\fh[\epsilon]) = I[L] + I^\fh[L]
\]
for all $0 < \epsilon < L$,
\item the equivariant scale $L$ quantum master equation, which is that
\[
Q(I[L]+I^\fh[L]) + \d_{\clies(\fh)} I^\fh[L] + \frac{1}{2}\{I[L]+I^\fh[L],I[L]+I^\fh[L]\}_{L} + \hbar \Delta_L(I[L]+I^\fh[L])
\]
lives in $\clies(\fh)$ for every scale $L$, and
\item the locality axiom, with the additional condition that as $L \to 0$, we recover the equivariant classical action functional $S+ I^\fh$ modulo $\hbar$.
\end{enumerate}
\end{dfn}

In other words, we simply follow the constructions of \cite{CosBook,CG2} working over the base ring $\clies(\fh)$.
A careful reading of those texts shows that the freedom to work over interesting dg commutative algebras is built into the formalism.
%\owen{We may need to be a bit careful since a version of nilpotency is used there but ..}
Note that our situation is particularly simple since the non-equivariant classical field theory is free and hence admits a very simple quantization,
with $I[L] = 0$ for all $L$.

\begin{rmk}
Equivariant quantization is essentially a version of the background field method in QFT.
One treats elements of $\fh$ as background fields and 
the interaction terms $I^\fh[L]$ encode the variation of the path integral measure with respect to these background fields.
(Solving the QME is our definition of well-posedness of the measure.)
\end{rmk}

\subsection{The pre-theory}
\label{sec prequant}

We will follow an approach directly parallel to the non-equivariant construction of a BV quantization of the curved $\beta\gamma$ system in \cite{WG2}.
Our first step is to try to construct an equivariant effective pre-theory 
(i.e., effective actions satisfying the locality and RG flow conditions but not necessarily the QME condition)
for the $\Vect$-equivariant formal $\beta\gamma$ system.
Essentially, we try to run the RG flow from the classical theory by naively guessing
\[
I^\fh[L] = \lim_{\epsilon \to 0} W(P^L_\epsilon,I^\fh)
\]
and then adding counterterms to deal with singularities that prevent this limit from existing.
(One of the main theorems of \cite{CosBook} guarantees that we can construct such a pre-theory.)
In the next subsection, we will examine the failure of this action to satisfy the equivariant QME.

To construct the pre-quantization explicitly, we need to specify certain data, such as the heat kernels and propagators with which we will work.
As we are working on the Riemann surface $S = \CC$, it is natural to work with the standard Euclidean metric
and to take advantage of the compatibility between its Laplacian and the operators $\partial$ and $\dbar$.
The {\em analytic heat kernel} we use is 
\ben
K_t(z,w) = \frac{1}{4 \pi t} e^{-|z-w|/ 4 t} \cdot (\d z - \d w) \wedge (\d \Bar{z} - \d \Bar{w}) .
\een
Thanks to the decomposition $\fgn^\CC = \Omega^{0,*}(\CC) \otimes \fgn$ (i.e., the vector bundle is trivialized),
the heat kernel for $\DD\fgn^\CC$ factors into an analytic part and an algebraic part
\ben
K_t = K^{an}_t \otimes ({\rm Id}_{\fg} + {\rm Id}_{\fg^\vee}) .
\een 
The \emph{propagator} $P_{\epsilon<L}$ likewise factors as $P^{an}_{\epsilon<L} \otimes ({\rm Id}_{\fg} + {\rm Id}_{\fg^\vee})$ 
where
\ben
P^{an}_{\epsilon<L} = \int_{t=\epsilon}^L (\dbar^* \otimes 1) K^{an}_t\, \d t .
\een
The analytic part of the propagator is only nontrivial on ``mixed inputs,'' 
i.e., where one side of the edge is labeled by a $\gamma$ and the other side is a $\beta$.
(This property is, of course, a direct consequence of the shifted pairing on fields.)
Thus, one can view the propagator as ``directed'' from $\gamma$ to $\beta$.
Figure \ref{fig:prop} shows how we draw the edge labeled by a propagator.

The vertices of Feynman diagrams are also highly constrained, 
since every term in the interaction $I^{\rm W}$ is linear in $\beta$.
Figure \ref{fig:vertex} shows the vertex where the target is $\hD^1$ 
and the formal vector field is $t^n \partial_t$. 
As with the propagator, we view $\gamma$ and $\beta$ legs as oriented, 
and there is only ever one $\beta$ leg.

There are strong consequences for Feynman diagrams
due to this directedness and the linearity in $\beta$:
the only nontrivial connected Feynman diagrams that can appear have zero or one loops.
A connected graph of genus zero will be a tree with one leaf labeled by $\beta$ and 
the other leaves labeled by $\gamma$ or a formal vector field $X \in \Vect$.
(and hence will encode a functional that has weight one for the scaling action).
Now consider the simplest kind of one-loop graph: a wheel with $k$ vertices.
Since the edges of the loop are labeled by the propagator --- and 
so the $\beta$ legs of the vertices are used up on the loop --- the leaves can only take $\gamma$ or $X$ as input.
A general one-loop graph will be a wheel with trees attached.
See Figure \ref{fig:wheel} for a simple example.

\begin{figure}
\begin{tikzpicture}[decoration={markings,mark=at position 0.6cm with {\arrow[black,line width=.4mm]{stealth}}}];
\draw[postaction=decorate, line width=.2mm] (-1.2,1) -- (0,0);
\draw[postaction=decorate, line width=.2mm] (-0.7, 1) -- (0,0);
\draw[postaction=decorate, line width=.2mm] (0.7,1) -- (0,0);
\draw[postaction=decorate, line width=.2mm] (1.2,1) -- (0,0);
\draw[postaction=decorate, line width=.2mm] (0,0) -- (0,-1);
\filldraw[color=black]  (0,0) circle (.1);
\draw (1.2,-0.1) node {$I_k = t^n \partial_t$};
\draw (-1.3,1.2) node {$\gamma$};
\draw (-0.75,1.2) node {$\gamma$};
\draw (0.75,1.2) node {$\gamma$};
\draw (1.3,1.2) node {$\gamma$};
\draw (0,0.9) node {$\cdots$};
\draw (0,-1.3) node {$\beta$};
\end{tikzpicture}
\caption{The vertex with $n$ incoming $\gamma$ legs and one outgoing $\beta$ leg}
\label{fig:vertex}
\end{figure}

\begin{figure}
\begin{tikzpicture}[decoration={markings,
   mark=at position 1.2cm with {\arrow[black,line width=.4mm]{stealth}}}];
\draw[postaction=decorate, line width=.2mm] (-1,0) -- (1,0);
\draw (-1.2,0) node {$\gamma$};
\draw (1.2,0) node {$\beta$};
\draw (0, 0.4) node {$P$};
\end{tikzpicture}
\caption{The propagator as directed from $\gamma$ to $\beta$}
\label{fig:prop}
\end{figure}

\begin{figure}
\begin{center}
\begin{tikzpicture}[scale=0.8,decoration={markings,mark=at position 0.9cm with {\arrow[black,line width=.4mm]{stealth}}}];
\draw[postaction=decorate, line width=.2mm] (2,0) -- (0,0);
\draw (1, -0.4) node {$P$};
\draw[postaction=decorate, line width=.2mm] (0,0) -- (0,2);
\draw (-0.4, 1) node {$P$};
\draw[postaction=decorate, line width=.2mm] (0,2) -- (2,2);
\draw (1, 2.4) node {$P$};
\draw[postaction=decorate, line width=.2mm] (2,2) -- (2,0);
\draw (2.4, 1) node {$P$};
\draw[postaction=decorate, line width=.2mm] (-1.4,0) -- (0,0);
\draw (-1.6,0) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (0,-1.4) -- (0,0);
\draw (0,-1.6) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (-1.12,-1.12) -- (0,0);
\draw (-1.3,-1.3) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (-1.12,3.12) -- (0,2);
\draw (-1.3,3.3) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (3.4,2.5) -- (2,2);
\draw (3.6,2.6) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (2.5,3.4) -- (2,2);
\draw (2.6,3.6) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (3.4,-0.5) -- (2,0);
\draw (3.6,-.6) node {$\gamma$};
\draw[postaction=decorate, line width=.2mm] (2.5,-1.4) -- (2,0);
\draw (2.6,-1.6) node {$\gamma$};
\filldraw[color=black]  (0,0) circle (.1);
\filldraw[color=black]  (0,2) circle (.1);
\filldraw[color=black]  (2,0) circle (.1);
\filldraw[color=black]  (2,2) circle (.1);
\end{tikzpicture}
\caption{A wheel with four vertices}
\label{fig:wheel}
\end{center}
\end{figure}

\begin{prop} 
For a connected genus one graph $\Gamma$, the limit $\lim_{\epsilon \to 0} W_{\Gamma}(P_{\epsilon<L}, I^{\rm W})$ exists. 
\end{prop}

In this proposition we remove the factors of $2$ and $\pi$ in the
definition of the heat kernel for shortness of exposition. These
factors will clearly not affect the existence of the limit. 

\begin{proof}
The graph weight $W_\Gamma$ will be a function of $\Vect$ and $\Omega^{0,*}(\CC) \otimes \fg_n$. 
The graph weight, like the propagator, factors as
\ben
W^{an}_\Gamma(P_{\epsilon<L}, I^{\rm W}) W^{\fg}_\Gamma
\een
where the analytic factor $W^{an}_\Gamma$ is a functional on the space $\Omega^{0,*}_c \oplus \Vect [1]$ and 
the algebraic factor $W^{\fg}_\Gamma$ is a functional on the space $\fg [1] \oplus \Vect [1]$. The algebraic factor does not depend on the regularization; it is independent of $\epsilon$ and $L$. 
Thus, to show that the limit exists it suffices to consider the analytic weight.
It also suffices to assume that $\Gamma$ is a wheel,
since the singularities arise from the wheel and not from any trees attached to the wheel. 

Suppose $\Gamma$ has $k$ vertices and choose a labeling of the vertices $v = (v_1,\ldots, v_k)$.
Let vertex $v_i$ correspond to the functional
\[
(\gamma,\beta,X) \mapsto a_{j, \bm} \int_S  \gamma^{\wedge m_1}_1 \wedge \cdots \wedge \gamma^{\wedge m_n}_n \wedge \beta_j
\]
where 
\[
X = \sum_{j = 1}^n \sum_{\bm = (m_1,\ldots,m_n) \in \NN^n} a_{j, \bm} t_1^{m_1} \cdots t_n^{m_n} \partial_j.
\] 
In other words, this functional only cares about the coefficient of $t_1^{m_1}\cdots t_n^{m_n} \partial_j$ in the vector field $X$
and uses it to produce a functional on $\beta$ and $\gamma$ of polynomial degree $m_1 + \cdots + m_n +1$.
The vertex $v_i$ thus has valence $1 + \nu_i = m_1 + \cdots + m_n +2$, 
where $\beta$ and $X$ each contribute one leg and the remaining legs are $\gamma$.
From hereon we will ignore the coefficient from $X$, as it does not affect convergence (only changing an overall constant)
and cease to discuss the leg associated to $X$.
Hence we will view $v_i$ as having valence $\nu_i$.

When we form the wheel, the $\beta$ leg of $v_i$ is paired with a $\gamma$ leg of $v_{i+1}$ by a propagator.
Thus there are $N = \sum_i (\nu_i - 1)$ external legs.
We now view the functional as a function of $N$ distinct inputs $\gamma_1,\ldots,\gamma_N$ of $\Omega^{0,*}(\CC)$,
which makes it easier to examine convergence.

Fix functions $\{f_{i,j_i}\} \in \Omega^{0,0}_c(\CC) = C^\infty_c(\CC)$ 
where $i = 1, \ldots k$ and $j_i = 1,\ldots,\nu_i - 1$. 
The analytic weight is 
\ben
W_\Gamma^{an}(P^{an}_{\epsilon<L}, I^{\rm W}(\{f_{i,i_j}\})) = 
\int_{{\bf z} \in \CC^k} \left(\prod_{i=1}^k \d^2 z_i \right)  \prod_{i = 1}^k \left(\left( \prod_{j_i =1}^{\nu_i - 1} f_{i,j_i} (z,\zbar) \right) P^{an}_{\epsilon<L}(z_j,z_{j+1}) \right). 
\een
In the product $z_{N+1}$ is identified with $z_1$, and $\d^2 z$ denotes $\d z \,\d \zbar$.
When $k =1$ this integral vanishes because the propagator vanishes
along the diagonal. Hence consider $k \geq 2$.
We want to show that the $\epsilon \to 0$ limit of the above integral exists
for any choices of $f_{i,j_i}$.

Before delving into analysis, we make some remarks that simplify notation.
First, we replace the product function $\prod_{i = 1}^k \prod_{j_i =1}^{\nu_i - 1} f_{i,j_i} (z,\zbar)$ 
by an arbitrary smooth function $\phi$ on $\CC^k$ with compact support,
as the functional above defines a distribution on $\CC^k$.
We thus need to show the integral vanishes for all such $\phi$.
Second, we repress from our notation obvious factors such as $\d^2 z_i$,
which can be reinserted by looking at the domain of integration (which is always a vector space).
Finally, we make a linear change of coordinates: $w_i := z_{i+1} - z_i$ for $1 \leq i < k$ and $w_k = z_k$. 
Note then that
\[
z_k - z_1 = \sum_{j = 1}^{k-1} w_j.
\]
Up to a constant factor independent of $\epsilon$ (i.e., the Jacobian of this change of coordinates),
the weight is
\bestar
\int_{w \in \CC^{k}} 
\phi(w,\Bar{w})
\left(
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k} 
\frac{1}{t_1 \cdots t_k}
\left( \prod_{i=1}^{k-1} \frac{\Bar{w}_i}{t_i}   e^{-|w_i|^2/t_i} \right) 
\left(\sum_{j =1}^{k-1} \frac{\Bar{w}_j}{t_k} \right) e^{- |\sum_j w_j|^2/t_k }
\right) 
\eestar
The factor in parentheses is an explicit expression for the analytic propagators. 
We rewrite this expression as 
\begin{equation}\label{integral before}
\int_{w \in \CC^{k}} 
\phi(w,\Bar{w})
\left(
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k} 
\frac{1}{t_1 \cdots t_k}
\left(\prod_{i=1}^{k-1} \frac{\Bar{w}_i}{t_i} \right)
\left(\sum_{j =1}^{k-1}\frac{\Bar{w}_j}{t_k} \right) 
e^{- \sum_i |w_i|^2 / t_i - |\sum_j w_j|^2/t_k }
\right). 
\end{equation}
Because
\[
\frac{\partial}{\partial w_i} e^{-|w_i|^2/t_i} = -\frac{\Bar{w}_i}{t_i }e^{-|w_i|^2/t_i},
\]
one can use integration by parts  to trade powers of $t_i^{-1} \Bar{w}_i$ for derivatives of $\phi$.
This is our next step in proving convergence.

Define the differential operator 
\[
\sigma(t) = \frac{1}{t_1 + \cdots + t_k}\sum_{j=1}^{k-1} t_j \partial_{w_j},
\]
which is a differential operator on functions on 
$\CC^{k-1} = \CC_{w_1} \times \cdots \times \CC_{w_{k-1}}$ (i.e., functions of the variables $w_1,\ldots,w_{k-1}$) 
whose coefficients are functions of the variables $(t_1,\ldots,t_k) \in [\epsilon,L]^k$.
Define the first-order differential operator  
\ben
D_m(t) :=\partial_{w_m} - \frac{1}{t_1 + \cdots + t_k}\sum_{j=1}^{k-1} t_j \partial_{w_j} = \partial_{w_m} - \sigma(t),
\een
with $1 \leq m < k$.
We now explain the utility of these operators.

Set
\[
E = e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\]
Then
\begin{align*}
\sigma(t)E 
&= -\left( 
\frac{1}{t_1 + \cdots + t_k} \sum_{j =1}^{k-1}\left( \Bar{w_j} + \frac{t_j}{t_k}\sum_{i =1}^{k-1} \Bar{w_i} \right) 
\right) 
E \\
&= -\left(\frac{1}{t_1 + \cdots + t_k} \left(1 + \frac{\sum_{j=1}^{k-1} t_j}{t_k}\right)\left(\sum_{j =1}^{k-1} \Bar{w_j}\right) 
\right) 
E \\
&= -\frac{1}{t_k}\left(\sum_{j =1}^{k-1} \Bar{w_j}\right) E,
\end{align*}
and so we find
\[
D_m(t) E = - \frac{\Bar{w_m}}{t_m} E
\]
for any $m$.
In consequence, for example,
\begin{align*}
D_1 (t) &
\left(
\phi(w,\Bar{w}) 
\prod_{i=2}^{k-1} \frac{\Bar{w}_i}{t_i}
\left(\sum_{j =1}^{k-1} \frac{\Bar{w}_j}{t_k} \right) 
e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }
\right) \\
 & = 
 \left( 
 - \phi(w,\Bar{w}) \frac{\Bar{w}_1}{t_1} + (D_1(t) \phi)(w, \Bar{w}) 
 \right) 
\prod_{i=2}^{k-1} \frac{\Bar{w}_i}{t_i}
\left(\sum_{j =1}^{k-1} \frac{\Bar{w}_j}{t_k} \right) e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\end{align*}
Note that the left hand side is a total derivative and hence integrates over $w \in \CC^k$ to zero.
The first summand on the right hand side is our integrand from the integral (\ref{integral before}), 
up to a sign and the factor $(t_1\cdots t_{k-1})^{-1}$.
Hence, we find that the integral (\ref{integral before}) equals
\[
\int_{w \in \CC^{k}} 
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k}
\frac{1}{t_1 \cdots t_k}
(D_1(t) \phi)(w, \Bar{w}) 
\prod_{i=2}^{k-1} \frac{\Bar{w}_i}{t_i}
\left(\sum_{j =1}^{k-1} \frac{\Bar{w}_j}{t_k} \right) e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\]
Analogous arguments apply, of course, for any $D_m$, due to the symmetry of the integrand.

Hence, applying the $D_m(t)$ in order and using a variant of the preceding argument, 
we find that the integral (\ref{integral before}) equals
\[
\int_{w \in \CC^{k}} 
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k}
\frac{1}{t_1 \cdots t_k}
(D_{k-1}(t) \cdots D_1(t) \phi)(w, \Bar{w}) 
\left(\sum_{j =1}^{k-1} \frac{\Bar{w}_j}{t_k} \right) e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\]
We apply the same argument with $\sigma(t)$ to show that the integral (\ref{integral before}) equals
\[
\int_{w \in \CC^{k}} 
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k}
\frac{1}{t_1 \cdots t_k}
(\sigma(t)D_{k-1}(t) \cdots D_1(t) \phi)(w, \Bar{w}) 
e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\]
This integral depends on $\epsilon$ through both the domain of integration
and the dependence of the operators $D_m(t)$ and $\sigma(t)$ on $t$.
We first eliminate the second kind of dependence.

Observe that for any choice of allowed $t$, we have 
\[
|\sigma(t) f| \leq \sum_{j =1}^{k-1} |\partial_{w_j} f|,
\]
since $t_j/\sum_i t_i < 1$ for every $j$.
Hence, we may replace $\sigma(t)D_{k-1}(t) \cdots D_1(t) \phi$ in the integrand
by a compactly supported function $\psi(w,\Bar{w})$.
That is, to show convergence of integral (\ref{integral before}) as $\epsilon \to 0$,
it suffices to show convergence of
\[
\int_{w \in \CC^{k}} 
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k}
\frac{1}{t_1 \cdots t_k}
\psi(w, \Bar{w})e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }
\]
for any compactly supported~$\psi(w,\Bar{w})$.
We may suppose that $\psi$ factors as $f(w_1,\ldots,w_{k-1})g(w_k)$ 
and focus only on integrating over the variables $w_1,\ldots,w_{k-1}$.

In this integral, there is no problem with integrating over the $w$ variables,
since the integrand is compactly supported in $w$. 
The possible problems arise from the factor $(t_1 \cdots t_k)^{-1}$,
which is not integrable over the domain $[0,L]^k$.
We need to show that the integral over $w$ contributes positive powers of the $t_i$
so that the integral over $t$ has an $\epsilon \to 0$ limit.

Note that, due to our arguments above, 
integration by parts allows us to trade a power of $\Bar{w}_j$ for a $1/t_j$.
Hence if we give a partial Taylor expansion of $\psi$ around the origin,
the integrals against nonconstant terms (which possess powers of $\Bar{w}_j$) 
are more convergent than the constant term of $\psi$.
In other words, it suffices to show that there exists the $\epsilon \to 0$ limit of
\begin{equation}
\label{core comp}
\int_{(w_1,\ldots,w_{k-1}) \in \CC^{k-1}} 
\int_{(t_1,\ldots,t_k) \in [\epsilon, L]^k}
\frac{1}{t_1 \cdots t_k}
e^{- \sum_i |w_i|^2 / t_i - |\sum_i w_i|^2/t_k }.
\end{equation}
Performing a Gaussian integral on the variables $w_1,\ldots,w_{k-1}$, 
we see that expression (\ref{core comp}) is proportional to 
\ben
\int_{(t_1,\ldots,t_k) \in [\epsilon,L]^k}
\left(\sum_{i=1}^k t_i\right)^{-1} \leq C \cdot \prod_{i=1}^k \int_{t_i=\epsilon}^L \frac{1}{t_i^{1/k}}  
= C' \prod_{i=1}^k (L^{(k-1)/k} - \epsilon^{(k-1)/k}),
\een
with $C$ and $C'$ constants.
For $k \geq 2$ the right hand side is finite as $\epsilon \to 0$. 
\end{proof}

Thanks to this proposition we have a well-defined equivariant prequantization.

\begin{dfn}
For $L > 0$, let
\ben
I^{\rm W}[L] := \lim_{\epsilon \to 0} W(P_{\epsilon < L}, I^{\rm W}) 
= \lim_{\epsilon \to 0} \sum_{\Gamma } \frac{\hbar^{g(\Gamma)}}{|{\rm Aut}(\Gamma)|} W_\Gamma(P_\epsilon^L, I^{\rm W}) . 
\een 
Here the sum is over all isomorphism classes of stabled connected graphs, but only graphs of genus $\leq 1$ contribute nontrivially. 
By construction, the collection satisfies the RG flow equation and its tree-level $L \to 0$ limit is manifestly $I^{\rm W}$.
Hence $\{I^{\rm W}[L]\}_{L \in (0,\infty)}$ is a \emph{$\Vect$-equivariant prequantization} of the $\Vect$-equivariant classical formal $\beta\gamma$ system.
\end{dfn}

Organizing the sums by genus of the graphs, we write the interaction as a sum $I^{\rm W}[L] = I^{{\rm W},0}[L] + \hbar I^{{\rm W},1}[L]$ where 
\bestar
I^{{\rm W},0}[L] & = & \sum_{\Gamma \in \; {\rm Trees}} \frac{1}{|{\rm Aut}(\Gamma)|} W_{\Gamma}(P_{\epsilon < L}, I^{\rm W}),\\
I^{{\rm W},1}[L] & = & \sum_{\Gamma \in \; {\rm 1-loop}} \frac{1}{|{\rm Aut}(\Gamma)|} W_{\Gamma}(P_{\epsilon < L}, I^{\rm W}).
\eestar
We now turn to studying the obstruction to satisfying the equivariant quantum master equation. 

\subsection{The obstruction}

With the pre-theory in hand, we ask whether it satisfies the QME.
The main result of this subsection provides a direct link between the topology of manifolds and the analysis of Feynman diagrams, where a characteristic class yields a local functional via the map~$J^{\rm W}$.

\begin{prop}\label{obsprop} 
There is an obstruction to a $\Vect$-equivariant quantization of the formal $\beta\gamma$ system 
that preserves the $\CC^\times \times \Aff(\CC)$ action by scaling and affine transformations. 
It is represented by a non-trivial cocycle of degree one
\ben
\Theta \in (\Def^{\rm W}_n)^{\CC^\times \times {\rm Aff}(\CC)} 
\een
such that 
\[
\Theta  = a J^{\rm W}(\ch^{\GF}_2(\hT_n))
\]
for some non-zero number $a$, where $J^{\rm W}$ is the quasi-isomorphism of Proposition \ref{eqdef}
and $\ch^{\GF}_2(\hT_n)$ is the component of the Gelfand-Fuks Chern character living in~$\clie^2(\Vect; \hOmega_{n,cl}^2).$ 
\end{prop}

This claim will follow from the series of definitions and lemmas that follows below.

By definition the scale $L$ {\em obstruction cocycle} $\Theta[L]$ is 
the failure for the interaction $I^{\rm W}[L]$ to satisfy the scale $L$ equivariant quantum master equation. 
Explicitly, one has
\ben
\hbar \Theta[L] = (\d_{\Vect} + Q)I^{\rm W}[L] + \hbar \Delta_L I^{\rm W}[L] + \{I^{\rm W}[L], I^{\rm W}[L]\}_L,
\een
where the right hand side is divisible by $\hbar$ since $I^{{\rm W},0}$ satisfies the classical master equation
so that the $\hbar^0$ component vanishes.
Moreover, the right hand side has no components weighted by $\hbar^2$ or higher powers,
because the BV Laplacian $\Delta_L$ vanishes on $I^{{\rm W},1}[L]$ as it is only a function of $\gamma$ and a vector field $X$.
Thus, we have
\ben
\hbar \Theta[L] = (\d_{\Vect} + Q)I^{{\rm W},1}[L] + \hbar \Delta_L I^{{\rm W},0}[L] + 2\{I^{{\rm W},0}[L], I^{{\rm W},1}[L]\}_L,
\een
and so $\Theta[L]$ only depends on $\gamma$ and hence is a degree one
element of $\clie^*(\Vect ; \clies(\fg_n^\CC))$. 

\begin{lemma}[Corollary 16.0.5 of \cite{WG2}]\label{obslemma}
The limit $\Theta := \lim_{L \to 0} \Theta[L]$ exists and 
is an element of degree one in $\clie^*(\Vect,\Cloc^*(\fg_n^\CC))$. 
Moreover, it is given by
\ben
\lim_{\epsilon \to 0} \sum_{\substack{\Gamma \in \text{\rm 2-vertex wheels}\\ e \in {\rm Edge}(\Gamma)}} W_{\Gamma,e}(P_{\epsilon<1}, K_\epsilon,
I^{\rm W}[\epsilon]),
\een
where the sum is over wheels $\Gamma$ with two vertices and a distinguished inner edge $e$.
\end{lemma}

In the lemma above, the notation $W_{\Gamma, e}(P_{\epsilon < 1},K_\epsilon, I^{\rm W}[\epsilon])$ 
denotes a variation on the usual weight associated to a graph. 
As usual, we attach the interaction term $I^{\rm W}[\epsilon]$ to each vertex. 
To the distinguished internal edge labeled $e$, we attach the heat kernel $K_\epsilon$, 
but we attach the propagator $P_{\epsilon < 1}$ to every other internal edge. 

We now turn to the proof of Proposition \ref{obsprop}. Let us be clear on what we need to accomplish, as the computations are lengthy and explicit. We must construct the obstruction cocycle $\Theta$ by the techniques of perturbative field theory. In the end, we want to recognize it as the local functional $J^{\rm W}(\ch^{\GF}_2(\hT_n))$. We can describe that local functional already, thanks to our description of $J^{\rm W}$.

\begin{lemma}
\label{lem: form of J(ch2)}
Let $X = a^i \partial_i$ and $Y = b^j \partial_j$ be formal vector fields in $\Vect$ where the coefficients $a^i, b^j$ live in $\hO_n$.
For simplicity, suppose all the $a^i$ are homogeneous of degree $k$ and the $b^j$ are homogeneous of degree $l$.
Then 
\[
J^{\rm W}(\ch^{\GF}_2(\hT_n))(X,Y,\gamma) = \int_S \<(\partial_j a^i)^S(\gamma), \partial\left( (\partial_i
b^j)^S(\gamma)\right)\>_{\fgn},
\]
with surface $S = \CC$ and using the notation $f^S$ from Section~\ref{defining J}.
\end{lemma}

In particular, to focus on the analytic component, suppose $n =1$ so $\gamma \in \Omega^{0,*}(\CC)$ as the target is one-dimensional.
Moreover, we can restrict to $a(t) = t^k$ and $b(t) = t^l$.
Then
\begin{align}
J^{\rm W}(\ch^{\GF}_2(\hT_n))(t^k \partial_t,t^l \partial_t,\gamma) &= \int_\CC k \gamma^{\wedge k-1} \wedge \partial_z( l \gamma^{\wedge l-1}) \d z \\
&= k l (l-1) \int_\CC \gamma^{\wedge k+l-2} \wedge \partial_z( \gamma) \d z. \label{J when n=1}
\end{align}
This expression will appear as the analytic component of our Feynman diagrams.

\begin{proof}
We first observe that
\[
J^{\rm W}_{\omega}(X,Y,\gamma) = J_{\omega(X,Y)}(\gamma)
\]
since the map $J$ is $\Vect$-equivariant.
Moreover, since $J_{\d_{dR} \theta} = \Tilde{J}_\theta$, we deduce that
\[
J^{\rm W}_{\d_{dR} \theta}(X,Y,\gamma) = J_{\theta([X,Y])} (\gamma).
\]
Hence it is convenient to recognize that 
\[
\ch^{\GF}_2(\hT_n) = \d_{dR}(\alpha)
\]
where $\alpha \in \clies(\Vect,\hOmega^1_n)$ satisfies
\[
\alpha(X,Y) = \alpha(a^i \partial_i, b^j \partial_j) = - (\partial_j a^i) \d_{dR}(\partial_i b^j).
\]
Note that if the $a^i$ are homogeneous of degree $k$ and the $b^j$ are homogeneous of degree $l$,
then $\alpha(X,Y)$ is a one-form whose coefficients are homogeneous of degree~$k+l-3$.

Lemma \ref{easy} then implies
\ben
\Tilde{J}_{\alpha(X,Y)} (\gamma_1,\ldots,\gamma_{k-1}, \gamma'_1,\ldots,\gamma_{l-1}') 
= \int_S \<(\partial_j a^i)^S(\gamma_1,\ldots, \gamma_{k-1}), \partial\left( (\partial_i
b^j)^S(\gamma_1',\ldots,\gamma_{l-1}')\right)\>_{\fgn},
\een
where $S = \CC$ for us. 
(Here we are describing the local functional as a tensor with $k+l-2$ inputs to be maximally explicit.)
\end{proof}

Now we turn to producing a simple, explicit expression for the obstruction.
The limit in Lemma \ref{obslemma} can be moved inside the summation, 
i.e., the weight for each 2-vertex wheel $\Gamma$ with edge $e$ has an $\epsilon \to 0$ limit.
We denote this summand by
\ben
\Theta_{\Gamma,e} = \lim_{\epsilon \to 0} W_{\Gamma,e}(P_\epsilon^1,K_\epsilon,I^{\rm W}[\epsilon]) .
\een
By the nature of the graph, this functional is of the form
\ben
\Theta_{\Gamma,e} : {\rm W}_n^{\tensor 2} \tensor \Sym(\Omega^{0,*}_c
\tensor \fg_n [1] ) \to \CC .
\een
Given two formal vector fields $X,Y$, let $\Theta_{\Gamma,e}(X,Y)$ denote the associated local functional in~$\cloc^*(\fg_n^S)$. 

Due to linear dependence on the vector fields, it suffices to assume that $X,Y$ are of the form $X = a^i \partial_i$ and $Y = b^j \partial_j$ where the coefficients $a^i,b^i \in \hO_n$ are homogeneous of degrees $k$ and $l$, respectively. In this case, there is only one graph $\Gamma$ whose functional $\Theta_{\Gamma,e}(X,Y)$ is nonzero: this graph has a vertex of valency $k+1$ and a vertex of valency $l+1$, namely 
\begin{center}
\begin{tikzpicture}[decoration={markings,mark=at position 1.7cm with {\arrow[black,line width=.4mm]{stealth}}}];

\filldraw (-1.5,0) circle (.1);
\draw (-1.5, .5) node {$I_X^{\rm W}$};
\draw[postaction=decorate, line width=.2mm] (-3,0.5) -- (-1.5,0);
\draw (-3.3,0.6) node {$\gamma$};
\draw (-2.8,0.1) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (-3,-0.5) -- (-1.5,0);
\draw (-3.3,-0.65) node {$\gamma$};

\filldraw (1.5,0) circle (.1);
\draw (1.5, .5) node {$I_Y^{\rm W}$};
\draw[postaction=decorate, line width=.2mm] (3,0.5) -- (1.5,0);
\draw (3.3,0.6) node {$\gamma$};
\draw (2.8,0.1) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (3,-0.5) -- (1.5,0);
\draw (3.3,-0.65) node {$\gamma$};

\draw[postaction=decorate, line width=.2mm] (-1.5,0) .. controls (0,.75) .. (1.5,0);
\draw (0, 1) node {$P_{\epsilon<1}$};
\draw[postaction=decorate, line width=.2mm] (1.5,0) .. controls (0,-.75) .. (-1.5,0);
\draw (0, -1) node {$K_\epsilon$};
\end{tikzpicture}
\end{center}
For this graph, the functional $\Theta_{\Gamma,e}(X,Y)$ is homogeneous of degree $k+l-2$:
\ben
\Theta_{\Gamma,e}(X,Y) : \Sym^{k+l -2} (\Omega^{0,*}_c(\CC) \tensor \fg_n [1]) \to \CC .
\een
By describing this functional explicitly, 
we will complete the proof of Proposition \ref{obsprop},
as it will agree on the nose with~$J^{\rm W}(\ch_2^{\GF}(\hT_n))$.

%
%We can factor this functional into an an algebraic piece (dependent on $\fg_n$) and an analytic piece (independent of $\fg_n$). 
%Write 
%\[
%\Theta_{\Gamma,e}(X,Y) = \Theta_{\Gamma,e}^{an}(X,Y) \Theta_{\Gamma,e}^{alg}(X,Y).
%\]
%The analytic piece is a functional
%\ben
%\Theta^{an}_{\Gamma,e} (X,Y) :\Sym^{k+l-2} (\Omega_c^{0,*}(\CC)) \to \CC,
%\een
%which we describe explicitly in the next lemma. 
%
%It will be convenient to fix an anti-holomorphic 1-form $\d \zbar \in \Omega^{0,1}(\CC)$ 
%and write $\Omega_c^{0,*}(\CC) = \Omega_c^{0,0}(\CC) [\d\zbar]$. 

\begin{prop}
Let $X = a^i \partial_i$ be homogeneous of degree $k$
and $Y = b^j \partial_j$ homogeneous of degree $l$. Let $\Gamma$ be the two-vertex wheel with vertices of valencies $k+1$ and $l+1$ and mark one internal edge as distinguished. Then, we have an identification $\Theta_{\Gamma,e}(X,Y) = a J^{\rm W}(\ch_2^\GF (\hT_n))(X,Y)$ for some nonzero number $a$. 
\end{prop}

\[
\Theta_{\Gamma,e}(X,Y)(\gamma) = \int_\CC \<(\partial_j a^i)^S(\gamma), \partial\left( (\partial_i
b^j)^S(\gamma)\right)\>_{\fgn}.
\]
 
%If $_1,\ldots,f_{k-1} \in \Omega_c^{0,0}(\CC)$ denote the inputs to the first vertex and 
%$g_1,\ldots,g_{l-1} \in \Omega_c^{0,0}(\CC)$ denote the inputs to the second vertex, 
%then
%\ben
%\Theta_{\Gamma,e}^{an}(X,Y)  (f_1 \d \zbar, f_2,\ldots,f_{k-1},g_1,\ldots,g_{l-1}) 
%= \frac{1}{2 (4 \pi)^2}\int_{z \in \CC} \left( \prod_{i=1}^{k-1}f_i\right) \partial \left( \prod_{j=1}^{l-1} g_j \right) \d \zbar  .
%\een
%In particular, the analytic weight only depends on $k,l$. 
%\end{prop}

\begin{proof}
We simplify further by setting
\[
X = t_1^{k_1} \cdots t_n^{k_n} \partial_i \quad\text{and}\quad Y = t_1^{l_1} \cdots t_n^{l_n} \partial_j
\]
with $k =\sum k_m$ and $l = \sum l_m$.
Ignoring the analytic factors momentarily, 
we observe that in computing the weight of the graph $\Gamma$,
we contract $\beta$ legs with $\gamma$ legs.
In our case, the $X$-vertex contributes a $\beta_i$ leg,
which then contracts with the $k_i$ different $\gamma$ legs from the $Y$-vertex.
Likewise, the $Y$-vertex contributes a $\beta_j$ leg,
which then contracts with the $k_j$ different $\gamma$ legs from the $X$-vertex.
These contractions explain the terms $(\partial_j a^i)^S(\gamma)$ and $(\partial_i b^j)^S(\gamma)$ in the integrand.

We now turn to comparing the analytic factors. It suffices here to consider the situation $n =1$,
since we have already taken care of the dependence on the target coordinates.
To clarify the notation, we use $f_1, \ldots, f_{k-1}$ to label the inputs to the remaining legs of the $X$-vertex.
We use $g_1,\ldots, g_{l-1}$ to label the inputs to the remaining legs of the $Y$-vertex.

The following diagram encodes the weight that we must compute:
\begin{center}
\begin{tikzpicture}[decoration={markings,mark=at position 1.7cm with {\arrow[black,line width=.4mm]{stealth}}}];

\filldraw (-1.5,0) circle (.1);
\draw[postaction=decorate, line width=.2mm] (-3,0.75) -- (-1.5,0);
\draw (-3.45,0.9) node {$f_1\,\d \zbar$};
\draw[postaction=decorate, line width=.2mm] (-3,0.35) -- (-1.5,0);
\draw (-3.3,0.4) node {$f_2$};
\draw (-2.8,0) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (-3,-0.7) -- (-1.5,0);
\draw (-3.3,-0.9) node {$f_{k-1}$};

\filldraw (1.5,0) circle (.1);
\draw[postaction=decorate, line width=.2mm] (3,0.65) -- (1.5,0);
\draw (3.3,0.7) node {$g_1$};
\draw (2.8,0.1) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (3,-0.6) -- (1.5,0);
\draw (3.4,-0.7) node {$g_{l-1}$};

\draw[postaction=decorate, line width=.2mm] (-1.5,0) .. controls (0,.75) .. (1.5,0);
\draw (0, 1) node {$P_{\epsilon<1}$};
\draw[postaction=decorate, line width=.2mm] (1.5,0) .. controls (0,-.75) .. (-1.5,0);
\draw (0, -1) node {$K_\epsilon$};
\end{tikzpicture}
\end{center}
We wish to take the $\epsilon \to 0$ limit of the associated integral.
Thus, we have
\begin{align*}
\Theta_{\Gamma,e}(X,Y) (f_1 \d \zbar, f_2,\cdots,g_{l-1}) 
& = \lim_{\epsilon \to 0} \int_{\CC^2} 
\left(\prod_{i=1}^{k-1} f_i(z_1) \right) 
\left(\prod_{j=1}^{l-1} g_i(z_2)\right) \d \zbar_1 
\wedge K^{an}_\epsilon(z_1,z_2) \wedge P^{an}_{\epsilon < 1} (z_1,z_2) \\
& =\lim_{\epsilon \to 0} \int_{\CC^2}
  \left(\prod_{i=1}^{k-1} f_i (z_1) \right) 
  \left(\prod_{j=1}^{l-1} g_i(z_2) \right) 
  \int_{t = \epsilon}^L \frac{1}{(4 \pi)^2 \epsilon t}
  e^{-|z_1-z_2|^2/4 \epsilon}  \frac{\partial}{\partial z_1}
  e^{-|z_1-z_2|^2/ 4 t} \, \d t.
\end{align*}
Now, $\partial_{z_1} e^{-|z_1-z_2|^2/4 t} = - \frac{1}{4t} (\zbar_1 - \zbar_2)
e^{-|z_1-z_2|^2/t}$. We make the change of coordinates $w_1 = z_2 -
z_1$ and $w_2 = z_2$. The integral over $w_1,w_2$ can be written as
\be\label{integral1}
- \int_{w_1,w_2\in \CC} \left(\prod_{i=1}^{k-1} f_i \right) \d^2 w_1 \d^2 w_2 \left(\prod_{j=1}^{l-1}
  g_i \right) \Bar{w}_1 \frac{1}{4 (4 \pi)^2 \epsilon t^2} \exp\left(-\frac{1}{4}(t^{-1} +
\epsilon^{-1} ) |w_1|^2\right) .
\ee
Using the same trick as in the proof that the theory involves no
counterterms, we introduce the differential operator
\ben
D(t) = \left(1 - \frac{t}{t+ \epsilon} \right) 
\frac{\partial}{\partial
  w_1} = \frac{\epsilon}{t+\epsilon} \frac{\partial}{\partial w_1} . 
\een 
Then
\begin{align*}
D_1(t) & \left(\prod_{i=1}^{k-1} f_i \prod_{j=1}^k
  g_i \frac{1}{\epsilon t} \exp\left(-\frac{1}{4}(t^{-1} +
\epsilon^{-1} ) |w_1|^2\right) \right) \\ & = \left(-
                                            \frac{\Bar{w}_1}{t} \prod_{i=1}^{k-1} f_i \prod_{j=1}^{l-1}
  g_i \Bar{w}_1 + D_1(t) \left( \prod_{i=1}^{k-1} f_i \prod_{j=1}^{l-1}
  g_i \right) \right) \frac{1}{4\epsilon t} \exp\left(-(t^{-1} +
\epsilon^{-1} ) |w_1|^2\right) 
\end{align*}
The left hand side is a total derivative, hence the integal in (\ref{integral1}) can
be written as 
\ben
- \int_{w_1,w_2} \frac{\partial}{\partial w_1} \left(\prod f_i \prod 
  g_i\right) \frac{1}{4 (4 \pi)^2 t(\epsilon + t)} \exp\left(-\frac{1}{4}(t^{-1} +
\epsilon^{-1} ) |w_1|^2\right) .
\een
In the $\epsilon \to 0$ limit only the the first term in the Wick
expansion for integrating $w_1$ will be nonzero. This term is
\ben
\frac{1}{(4 \pi)^2}\int_{w_2} \d^2 w_2 \frac{\partial}{\partial w_1}
\left(\prod f_i \prod 
  g_i\right)(w_1 = 0) \frac{\epsilon}{(t + \epsilon)^2} .
\een
Note that the condition $w_1 = 0$ implies that $z_1 = z_2$ in our
original parametrization. Thus 
\ben
\frac{\partial}{\partial w_1} \left(\prod f_i \prod
  g_i\right)(w_1 = 0) = \left(\frac{\partial}{\partial z}  \prod
  f_i(z) \right) \prod g_j (z)
\een
where $z = z_1 = z_2$. Finally, we compute the $\epsilon \to 0$
limit of the $t$-integral
\ben
\frac{1}{(4 \pi)^2}\lim_{\epsilon \to 0} \int_{\epsilon}^1 \frac{\epsilon}{(t + \epsilon)^2} \d t = \frac{1}{2}  .
\een 
Integrating by parts (to get rid of the $(-)$ sign) we see that the total weight is
\ben
\frac{1}{2 (4 \pi)^2}\int_{z \in \CC} \left( \prod 
  f_i\right) \frac{\partial}{\partial z} \left( \prod g_j \right) \d^2 z
\een
as desired. Setting $f_i = g_j$ we see that this coincides with the analytic part of $J^{\rm W}(\ch_2(\hT_n))(X,Y,f_i = g_j)$ written above in (\ref{J when n=1}). 
\end{proof}
%
%We proceed to compute the algebraic factor $\Theta^{alg}_{\Gamma,e}(X,Y)$. Indeed, this is computed by
%\ben
%\Theta^{alg}_{\Gamma,e}(X,Y) = W_\Gamma^{alg}({\rm id}_{\fg_n} + {\rm id}_{\fg_n^\vee}, I^{{\rm W},k, alg}, I^{{\rm W}, l, alg})
%\een
%where...

\begin{rmk} 
Note that when restricted to {\em linear} vector fields $\gl_n \hookrightarrow \Vect$, 
the entire obstruction $\Theta$ vanishes. 
This vanishing means that there is no obstruction to quantizing equivariantly for the Lie algebra $\gl_n$. 
This result is just the Lie algebra-level version of an earlier observation: 
the action of the group $\GL_n$ lifts $\hbar$-linearly to an action on the quantization.
\end{rmk}

\subsection{The extended theory} 
\label{extendedtheory}

We have just seen that there is an obstruction to the existence of a $\Vect$-equivariant quantization of the formal $\beta\gamma$-system. 
As is common in physics, we use that obstruction to extend the Lie algebra and obtain an equivariant quantization for the extended Lie algebra.
Indeed, we have already seen that the second Gelfand-Fuks-Chern character defines the extension
\ben
\xymatrix{
0 \ar[r] & \hOmega^2_{n,cl} \ar[r] & \TVect \ar[r]^-{p} & \Vect \ar[r] & 0 
}
\een 
in Section \ref{sec gk descent}. 
We will now construct a classical theory that is equivariant for $\TVect$ and 
show that it admits a natural equivariant BV quantization.

\subsubsection{}

The action of $\Vect$ on the classical formal $\beta\gamma$ system
is given by a map of $L_\infty$ algebras $I^{\rm W} : \Vect \l8to \Cloc^*(\DD \fg_n^\CC)[-1]$. 
By composing with the projection $p : \TVect \to \Vect$,
we get an $L_\infty$ map
\ben
\Tilde{I}^{W} := p^* I^{\rm W} : \TVect \l8to \Cloc^*(\DD \fg_n^\CC)[-1] .
\een
Equivalently, $p^*I^{\rm W}$ determines a Maurer-Cartan element in the dg Lie algebra $\clie^*(\TVect ; \Cloc^*(\DD \fg_n^\CC))$
and hence a $\TVect$-equivariant classical field theory. 

As in the non-extended case, there is a $\TVect$-equivariant obstruction-deformation complex $\TDef_n^{\rm W}$, 
which is the graded vector space $\hsym(\TVect^\vee[-1]) \tensor \Cloc^\sharp(\DD \fg_n^S)$
equipped with the differential $\d_{\TVect} + \dbar + \{\Tilde{I}^{W}, -\}$,
where $\d_{\TVect}$ denotes the differential on $\clie^*(\TVect)$. Note that we can write
\ben
\TDef_n^{\rm W} \cong \clie^*(\TVect) \otimes_{\clie^*(\Vect)}
\Def_n^{\rm W} .
\een
Proposition \ref{eqdef}, which concerns the unextended deformation complex, 
then implies that the $\CC^\times \times \Aff(\CC)$-invariant piece of the extended deformation complex satisfies
\ben
\left(\TDef_n^{\rm W}\right)^{\CC^\times \times \Aff(\CC)} \simeq \clie^*(\TVect;p^* \hOmega^2_{n,cl}[1]).
\een
Here, $p^* \hOmega_{n,cl}^2$ is the $\TVect$-module given by pulling back the natural $\Vect$-module structure on closed two-forms along~$p$. 

\subsubsection{The extended pre-theory}

Our goal is to describe quantizations for this extended $\TVect$-equivariant field theory. 
Let $\{I^{\rm W}[L]\}$ be the prequantization for the $\Vect$-equivariant classical field theory, as above. 
For each $L > 0$, we define the functional
\ben
\Tilde{I}^{W} [L] := p^* I^{\rm W} [L] \in \clie^\sharp(\TVect) \otimes \clie^\sharp(\DD\fgn^\CC) \llbracket \hbar \rrbracket .
\een

\begin{lemma} 
The collection $\{\Tilde{I}^{W}[L]\}$ defines a pre-quantization for
the $\TVect$-equivariant classical field theory. Moreover, the obstruction to satisfying the $\TVect$-equivariant QME at scale $L$ is $\Tilde{\Theta}[L] = p^* \Theta [L]$.
In particular $\Tilde{\Theta} := \lim_{L \to 0} \Tilde{\Theta}[L]$ exists and is equal to $p^* \Theta$. 
\end{lemma}
\begin{proof} This follows from the fact that for any graph $\Gamma$
  we have $W_\Gamma(P_{\epsilon < L}, p^*I^{\rm W}) =
  p^*W_{\Gamma}(P_{\epsilon < L}, I^{\rm W})$. 
\end{proof}

Just as in the non-extended case there is the possibility that the
pre-quantization does not define an equivariant quantization. The
above lemma identifies this obstruction cocycle which we will go on to
show is cohomologically trivial. 

The quasi-isomorphism $J^{\rm W} : \clie^*(\Vect ; \hOmega^2_{n,cl} [1]) \to
(\Def_n^{\rm W})^{\CC^{\times} \times {\rm Aff}(\CC)}$ from
Proposition \ref{eqdef} extends to a quasi-isomorphism
\begin{equation}\label{tildeJ}
J^{\Tilde{\rm W}} : \clie^*(\TVect ; \hOmega^2_{n,cl} [1]) \xto{\simeq} (\Tilde{\Def}_n^{\rm
  W})^{\CC^{\times} \times {\rm Aff}(\CC)}
\end{equation}
by tensoring $\clie^*(\TVect)$ over the ring $\clie^*(\Vect)$. The
lemma implies that the obstruction $\Tilde{\Theta}$ is identified with
the cocycle $p^*({\rm ch}^\GF_2(\hT_n))$ under the map $J^{\Tilde{\rm W}}$. 

\subsubsection{Quantum correction}

Let $\fh$ be a Lie algebra and $V$ a module for $\fh$. Moreover,
suppose $\alpha \in \clie^2(\fh ; V)$ is a 2-cocycle. Then, we can
form the extension
\ben
0 \to V \to \Tilde{\fh} \xto{p} \fh \to 0 .
\een
The bracket between $x,y \in \fh$ is defined by $[x,y]_{\Tilde{\fh}}
:= [x,y]_{\fh} + \alpha(x,y)$ where $[-,-]_{\fh}$ is the bracket in
the original Lie algebra. The bracket between $x \in \fh$ and $v \in
V$ is $[x,v]_{\Tilde{\fh}} = x \cdot v$. We can
pull back the cocycle $p^* \alpha \in \clie^*(\Tilde{\fh} ; V)$. In
this situation, this pullback cocycle is automatically trivial. An
explicit trivializing element is $\id_V : V \to V$ viewed as an
element of the Chevalley-Eilenberg complex $\clie^*(\Tilde{\fh} ;
V)$. 

In our situation this says that the cocycle $p^*(\ch_2^{\rm
  GF}(\hT_n))$ is trivializable and hence so is the obstruction
$\{\Tilde{\Theta}[L]\}$. To define a quantum theory we need this
trivialization at the level of functionals on fields. Indeed,
according to the above Lemma, which uses standard facts about Feynman
diagrams, it suffices to trivialize the local functional $\Tilde{\Theta}$
encoding the obstruction. 

\begin{lemma}[Lemma 3.33 of \cite{LiLi}]
\label{genlem}
If $I^{qc}$ and $O_1 \in \Def_n$ satisfy
\ben
Q I^{qc} + \{I, I^{qc}\} = O_1,
\een 
then, for each $L$, the functional
\ben
I^{qc} [L] = \lim_{\epsilon \to 0} \sum_{\substack{\Gamma \in
    \text{\rm Trees}\\ v \in V(\Gamma)}} W_{\Gamma, v}(P_{\epsilon <
  L}, I, I^{qc})
\een
satisfies 
\be\label{treetriv}
Q I^{qc} [L] + \{I^{(0)}[L], I^{qc}[L]\}_L = O_1[L] .
\ee
\end{lemma}
\begin{proof} 
For the non-equivariant case, see the referenced Lemma in \cite{LiLi}. The equivariant case is an immediate consequence.
\end{proof}

As a corollary of this general fact we see that if $I^{qc} \in
\Tilde{\Def}_n^{\rm W}$ trivializes the obstruction cocycle $\Tilde{\Theta}$,
then the effective family $I[L] + \hbar I^{qc}[L]$ satisfies the
$\TVect$-equivariant quantum master equation. In fact, we have an
obvious choice for the local functional
$I^{qc}$. The map $J : \hOmega^2_{n,cl} \to \Def_n$ determines an
element in $\clie^1(\hOmega^2_{n,cl} ; \Def_n) \subset \clie^1(\TVect
; \Def_n)$ and hence an element the equivariant deformation complex $\Tilde{\Def}_n^{\rm
  W}$. We will use $I^{qc} = J$. 

\begin{prop}\label{obstriv} 
The local functional $J$ trivializes $\Tilde{\Theta}$ in the equivariant deformation complex. That is, 
\be\label{classtriv}
(\dbar + \d_{\TVect}) J + \{\Tilde{I}^{\rm W}, J\} =
\Tilde{\Theta} .
\ee
\end{prop}
\begin{proof} 
The functional $J$ is the image of $\id_{\Omega^2}$ under
the map $J^{\Tilde{\rm W}}$ from Equation (\ref{tildeJ}). By construction $J^{\Tilde{W}}$ determines a map of complexes $\clie^*(\TVect ;
\hOmega^2_{n,cl}) \to \Tilde{\Def}_n^{\rm W}$ and hence commutes with
the differentials on both sides. That is,
\ben
J^{\Tilde{\rm W}}(\d_{\TVect} \varphi) = \dbar J^{\Tilde{\rm W}}
(\varphi) + \{\Tilde{I}^{\rm W},J^{\Tilde{\rm W}}(\varphi)\} 
\een
for all $\varphi \in \clie^*(\TVect ; \hOmega^2_{n,cl})$. In
particular, for $\varphi = \id_{\Omega^2}$ we have
\ben
J^{\Tilde{\rm W}}(p^*\ch_2^{\rm GF}(\hT_n)) = \dbar J +
\{\Tilde{I}^{\rm W}, J\} .
\een
We have already seen that the image of $p^*\ch_2^{\rm GF}(\hT_n)$
under $J^{\Tilde{\rm W}}$ is the obstruction cocycle $\Tilde{\Theta}$,
and this is what we wanted to show. 
\end{proof}

% Consider the following commuting diagram of obstruction-deformation complexes:
% \ben
% \xymatrix{
% \left(\Def_n^{\rm W}\right)^{\CC^\times \times \Aff(C)} \ar[r]^-{p^*} & \left(\TDef_n^{\rm W}\right)^{\CC^\times \times \Aff(C)} \\
% \clie^*(\Vect, \hOmega^2_{n,cl}) \ar[u]^-{\simeq} \ar[r]^-{p^*} & \clie^*(\TVect, \hOmega^2_{n,cl}) \ar[u]_-{\simeq}  .
% }
% \een
% We can transfer the trivialization $\id_{\Omega^2}$ of
% $\ch_2(\hT_n)$ to a trivialization
% \ben
% J \in \left(\TDef_n^{\rm W}\right)^{\CC^\times \times \Aff(C)} \subset \clie^*(\TVect, \Cloc^*(\fg_n^\CC))
% \een
% of $\Tilde{\Theta}$, and shortly will give an explicit description of $J$ at the level of local functionals (see Section \ref{explicit J} below).

% First, though, observe that given the functional $J$, 
% we can describe the quantum corrections to the equivariant pre-quantization $\{\Tilde{I}^{W}[L]\}$.
% Define
% \ben
% J[L] := \sum_{\substack{\Gamma \in \; {\rm Trees}\\ v \in {\rm Vert}(\gamma)}} \frac{1}{|{\rm Aut}(\gamma)|} W_{\gamma,v}(P_\epsilon^L, \Tilde{I}^\bW,J),
% \een
% where the notation $W_{\gamma,v}(P_\epsilon^L, \Tilde{I}^{\bW}, J)$ is 
% the weight computed by placing the interaction $J$ at the vertex labeled $v$ and $\Tilde{I}^{\bW}$ at the remaining vertices, as depicted \brian{below}. 
% The sum here is over all isomorphism classes of connected trees with
% a distinguished vertex.

Finally, we arrive at the main result concerning the extended
equivariant BV theory. 

\begin{thm} \label{QME1}
The effective family $\{\Tilde{I}^{\rm W}[L] + \hbar J[L] \}_{L > 0}$ satisfies both RG flow {\em and} the $\TVect$- equivariant quantum master equation
\ben
(\d_{\Tilde{{\rm W}}} + Q) (\Tilde{I}^{\rm W} [L] + \hbar J[L]) + \frac{1}{2}
\{\Tilde{I}^{\rm W}[L] + \hbar J[L] , \Tilde{I}^{\rm W}[L] + \hbar
J[L] \}_L + \hbar \Delta_L (\Tilde{I}^{\rm W}[L] + \hbar J[L] ) = 0 .
\een 
Hence it provides a $\TVect$-equivariant quantization of the classical
theory $\Tilde{I}^{\rm W}$ based on a length scale regularization. Moreover,
this quantization is unique up to homotopy.
\end{thm}
\begin{proof} The first part follows from Proposition \ref{obstriv} and Lemma
  \ref{genlem} above. Uniqueness follows from the fact
  that $H^1(\TVect ; \hOmega^2_{n,cl}) = 0$.
\end{proof}

\begin{rmk}
Here, as in Lemma \ref{genlem}, the term $I^{qc}[L]$ arises naturally by naively applying RG flow to $\Tilde{I}^{\rm W} + \hbar I^{qc}$ and 
asking only for the sum of the terms in which at least one vertex is labeled by $I^{qc}$.
(The terms involving just $\Tilde{I}^{\rm W}$ have singularities, but we've already resolved them.)
Note that a stable connected graph containing $I^{qc}$ as a vertex has nonzero weight only if it is a tree, 
because $I^{qc}$ only has inputs from $\gamma$.
Moreover, only one copy of $I^{qc}$ can appear.
\end{rmk}

\subsection{The conformal anomaly} \label{sec conformal anomaly}

In Section \ref{sec hol vf} we discussed how the classical theory of the formal $\beta\gamma$ system is equivariant for the action of holomorphic vector fields on the source $\cT^S$.
Indeed, we have described the local functional $I^\cT \in \Def_n^{\cT}$ that encodes this action. 
In this section we address the problem of the quantizing this symmetry compatibly with the action of formal vector fields $\Vect$ on the target $n$-disk. 

\begin{prop} There is an obstruction to a $\cT^\CC \times \Vect$-equivariant
  quantization of the formal $\beta\gamma$ system. It is represented
  by a non-trivial cocycle 
\ben
2n \omega^\GF + \Theta^{\rm W} + \Theta^\cT \in \clie^*\left(\Vect ; \Def_n^{\cT}\right).
\een
Here, $\omega^\GF \in \Def_n^\cT$ is the local Gelfand-Fuks cocycle representing the generator of $H^3_{\rm Lie}({\rm W}_1)$. Moreover, 
\ben
J^{\rm W} (\ch_2^\GF(\hT_n)) = a \Theta^{\rm W} \;\; , \;\; K^{\rm W}(c_1^{\GF}(\hT_n)) = b \Theta^{\cT} .
\een
for some constants $a,b$.
\end{prop}

\begin{rmk} 
This proposition says that there are {\em three} independent obstructions to finding a $\cT^\CC \times \Vect$-equivariant quantization of the formal $\beta\gamma$ system. The obstruction $\Theta^{\rm W}$ coincides with the $\Vect$-equivariant obstruction computed in the previous sections and is independent of $\cT^\CC$. The obstruction $\Theta^\cT$ is new, and we will show that it reflects the fact that chiral differential operators on a complex manifold $X$ admit a global conformal structure if and only if $c_1(T_X) = 0$. The obstruction $\omega^{\GF}$ only depends on the background fields $\cT^\CC$ and hence is independent of the fields of the $\beta\gamma$ system. It reflects that fact that even when $c_1(T_X) = 0$, one needs to centrally extend holomorphic vector fields to get a global action. We will see that this obstruction constitutes the central charge of resulting Virasoro symmetry.
\end{rmk}

\begin{proof}
The obstruction is computed in a manner similar to the obstruction just for $\Vect$. Indeed, a version of Lemma \ref{obslemma} still holds, with the interaction $I^{\rm W}$ replaced by $I^{\rm W} + I^\cT$. That is, the obstruction to a $\cT^\CC \times \Vect$ equivariant quantization can be written as a graph expansion
\ben
\lim_{\epsilon \to 0} \sum_{\substack{\Gamma \in \text{\rm 2-vertex wheels}\\ e \in {\rm Edge}(\Gamma)}} W_{\Gamma,e}(P_{\epsilon<1}, K_\epsilon,
I^{\rm W}[\epsilon] + I^\cT[\epsilon]).
\een
This obstruction is an element of $\clie^*(\Vect ; \Def_n^\cT)$ and splits up into a sum of three linear pieces: 
\begin{enumerate}
\item a factor that does not depend on $\Vect$, i.e., lives in $\Def_n^\cT \subset \clie^*(\Vect ; \Def_n^\cT)$ ; 
\item a factor $\Theta^{\rm W}$ that does not depend on $\cT^\CC$ and is an cocycle in $\clie^*(\Vect ; \Def_n)$; and 
\item a factor $\Theta^{\cT}$ that is linear in both $\cT_S$ and $\Vect$ and is a cocycle in $\clie^1(\Vect ; \Def_n^\cT)$.
\end{enumerate}
We now describe these terms explicitly.\\

\noindent{\em The first term.} 
The term in $\Def_n^\cT$ has the form
\ben
\lim_{\epsilon \to 0} \sum_{\substack{\Gamma \in \text{\rm 2-vertex wheels}\\ e \in {\rm Edge}(\Gamma)}} W_{\Gamma,e}(P_{\epsilon<1}, K_\epsilon, I^\cT[\epsilon]) .
\een
The calculation of this obstruction was performed in Section 7 of \cite{bw_vir} and was shown to be equal to the local functional $2n \omega^\GF \in \Def_n^\cT$ where we have defined $\omega^{\GF}$ in Section \ref{sec hol vf}.\\ 

\noindent{\em The second term.} 
The term independent of $\cT^\CC$ has a graph expansion of the form
\ben
\Theta^{\rm W} = \lim_{\epsilon \to 0} \sum_{\substack{\Gamma \in \text{\rm 2-vertex wheels}\\ e \in {\rm Edge}(\Gamma)}} W_{\Gamma,e}(P_{\epsilon<1}, K_\epsilon,
I^{\rm W}[\epsilon]).
\een
This term is precisely the local functional $\Theta \in \clie^*(\Vect ; \Def_n)$ representing the obstruction to a $\Vect$-equivariant quantization. Thus $J^{\rm W} (\ch^\GF_2(\hT_n)) = \Theta^{\rm W}$, as desired.\\ 

\noindent {\em The third term.} 
We aim to show that there is an identification $K^{\rm W} (c_1^\GF(\hT_n)) = b \Theta^\cT$. Since we only consider the graph expansion over two-vertex wheels, the cocycle representing the third piece of the obstruction $\Theta^\cT$ is given by the weight of the $\epsilon \to 0$ limit of the following diagram
\begin{center}
\begin{tikzpicture}[decoration={markings,mark=at position 1.7cm with {\arrow[black,line width=.4mm]{stealth}}}];

\filldraw (-1.5,0) circle (.1);
\draw (-1.5,.5) node {$I^{\cT}$};
\draw[postaction=decorate, line width=.2mm] (-3,0) -- (-1.5,0);
\draw (-3.15,0) node {$\xi$};

\filldraw (1.5,0) circle (.1);
\draw (1.5,.5) node {$I^{\rm W}$};
\draw[postaction=decorate, line width=.2mm] (3,0.5) -- (1.5,0);
\draw (3.3,0.5) node {$\gamma$};
\draw (2.8,0.1) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (3,-0.5) -- (1.5,0);
\draw (3.3,-0.5) node {$\gamma$};

\draw[postaction=decorate, line width=.2mm] (-1.5,0) .. controls (0,.75) .. (1.5,0);
\draw (0, 1) node {$P_{\epsilon<1}$};
\draw[postaction=decorate, line width=.2mm] (1.5,0) .. controls (0,-.75) .. (-1.5,0);
\draw (0, -1) node {$K_\epsilon$};
\end{tikzpicture}
\end{center}
where $\xi$ labels a holomorphic vector field in $\cT^\CC$ and $\gamma \in \Omega^{0,*}(\CC ; \fg_n)$.\\

For fixed $\xi \in \cT^\CC$ we have the functional $K_\xi := K^{\rm W}(c_1^{\GF}(\hT_n))(\xi, -)$, which is an element of the $\Vect$-equivariant deformation complex $\Def_n^{\rm W}$. For simplicity, we consider the case that $\xi = \xi^0 \partial_z \in \Omega^{0}(\CC ; T \CC)$. The Gelfand-Fuks-Chern character evaluated on a vector field $X = a^i \partial_i$ is $c_1^{\GF}(\hT_n)(a^i \partial_i) = \frac{1}{2\pi i} \partial_i a^i$. Thus, we have the explicit formula for $K_\xi$
\ben
K_\xi(X, \gamma) = \int_S \partial_z \xi^0 \<(\partial_i a^i)^S(\gamma), \partial \gamma\>_{\fg_n} .
\een
It suffices to show that for each $X \in \Vect$ the obstruction satisfies $\Theta^{\cT}(\xi, X, -) = b K_\xi(X)$, for some nonzero constant $b$, as elements of $\Def_n$. 

As we did in the calculation of the obstruction in the previous sections, it suffices to assume that the formal vector field is homogeneous of the form $X = t_1^{k_1} \cdots t_n^{k_n} \partial_i$ where $k_1 + \cdots + k_n = k$. Then, both $\Theta^{\cT}(\xi, X, -)$ and $K_\xi(X)$ are of homogeneous degree $k-1$:
\ben
\Sym^{k-1}(\Omega^{0,*}(\CC) \tensor \fg_n) \to \CC .
\een 
Ignoring the analytic factors momentarily, we observe that in computing the weight of the graph $\Gamma$,
we contract $\beta$ legs with $\gamma$ legs. In our case, the $X$-vertex contributes a $\beta_i$ leg,
which then contracts with the $k_i$ different $\gamma$ legs from the vertex labeled by the holomorphic vector field $\xi$. These contractions explain the term $(\partial_i a^i)^S(\gamma)$.

We now compare the analytic factors. Since the dimension of the target formal disk was only relavent for the algebraic piece, it suffices to set $n = 1$. The analytic weight we must compute is represented by the $\epsilon \to 0$ limit of the diagram
\begin{center}
\begin{tikzpicture}[decoration={markings,mark=at position 1.7cm with {\arrow[black,line width=.4mm]{stealth}}}];

\filldraw (-1.5,0) circle (.1);
\draw[postaction=decorate, line width=.2mm] (-3,0) -- (-1.5,0);
\draw (-3.3,0) node {$\xi^0 \partial_z$};

\filldraw (1.5,0) circle (.1);
\draw[line width=.2mm] (3,1) -- (1.5,0);
\draw[postaction=decorate, line width=.2mm] (3,0.5) -- (1.5,0);
\draw (3.3, 1) node {$f_1 \d \zbar$};
\draw (3.3,0.5) node {$f_2 $};
\draw (2.8,0.1) node {$\vdots$};
\draw[postaction=decorate, line width=.2mm] (3,-0.5) -- (1.5,0);
\draw (3.3,-0.5) node {$f_{k-1}$};

\draw[postaction=decorate, line width=.2mm] (-1.5,0) .. controls (0,.75) .. (1.5,0);
\draw (0, 1) node {$P_{\epsilon<1}$};
\draw[postaction=decorate, line width=.2mm] (1.5,0) .. controls (0,-.75) .. (-1.5,0);
\draw (0, -1) node {$K_\epsilon$};
\end{tikzpicture}
\end{center}
The weight of this diagram is given by
\ben
\int_{\CC^2} \left(\xi^0 \partial_{z_1} P_{\epsilon < 1}(z_1,z_2) \right) \wedge \left(\prod_{i=1}^{k-1} f_i(z_2) \right) \d \zbar_2 \wedge K_\epsilon(z_1,z_2) .
\een 
We compute the $z_1$-derivative of the propagator as
\ben
\frac{\partial}{\partial z_1} P_{\epsilon < 1} (z_1,z_2) = \int_{t = \epsilon}^L \frac{1}{16 (4 \pi) t^3} (\zbar_1 - \zbar_2)^2 e^{-|z_1-z_2|^2/4t} \d t \left(\d z_1 - \d z_2\right).
\een
Making the standard change of coordinates $w_1 = z_2 - z_1$ and $w_2 = z_2$ we find that the weight can be expressed as 
\ben
\int_{w_1,w_2} \xi^0 \Bar{w}_1^2 \left(\prod_{i=1}^{k-1} f_i \right) \d^2 w_1 \d^2 w_2 \int_{t=\epsilon}^1 \frac{1}{16 (4 \pi)^2 \epsilon t^3} \exp\left(-\frac{1}{4} (t^{-1} + \epsilon^{-1}) |w_1|^2\right) .
\een 
The only term in the Wick expansion of the integral above that contributes is a nonzero multiple of
\ben
\int_{z} \left(\partial_z^2 \xi^0\right)(z) \left(\prod_{i=1}^{k-1} f_i (z) \right) \d^2 z \int_{t=\epsilon}^1 \frac{\epsilon^3}{(\epsilon + t)^3} \d t .
\een
A simple evaluation of the $t$-integral yields a finite limit as $\epsilon \to 0$. Furthermore, we can integrate the above $z$-integral by parts to put the analytic part of the obstruction $\Theta^{\cT}(\xi, X, f_1 \d \zbar, f_2,\ldots,f_{k-1})$ in the form that is proportional to
\ben
\int_z \left(\partial_z \xi^0\right) \partial_z \left(\prod_{i=1}^{k-1} f_i \right) \d^2 z .
\een
This is precisely the analytic form of the functional $K_\xi(X)$, as desired.
\end{proof}


\section{The partition function of the equivariant theory}

In this section we analyze the scale $\infty$ effective interaction on an elliptic curve coming from the quantization constructed above. 
It defines a natural element of the Gelfand-Fuks cohomology $\clie^*(\Vect ; \Omega^{-*}_n)$ 
that deserves to be called the $n$-dimensional {\it formal Witten class}. 
We show that under Gelfand-Kazhdan descent, this formal cocycle maps to the Witten class of the complex manifold. 

\begin{rmk}
The arguments here are borrowed from \cite{WG2}, notably Section 17,
where Costello identifies the Witten class of the target $X$ 
as part of the quantized action functional of the curved $\beta\gamma$ system.
We simply observe that his approach applies equally well with the formal disk as target,
so long as one uses Gelfand-Fuks cohomology.
In \cite{WG2} Costello also provides an interpretation of the Witten class as a kind of ``projective volume form''
on the derived mapping space from the universal elliptic curve to $X$.
We do not discuss that here, but his interpretation applies to our approach as well.
\end{rmk}

\subsection{The formal Witten class}

Let $\cV$ be a formal vector bundle, i.e., an object of the category $\VB_{(\Vect, \GL_n)}$. 
We have constructed the Gelfand-Fuks-Chern characters
\ben
\ch^{\rm GF}_k(\cV) \in \clie^k(\Vect, \GL_n ; \hOmega^k_{n,cl}) .
\een
%(We are primarily interested in the case $\cV = \hT_n$.) 
Let $\hOmega^{-*}_n = \bigoplus_{k} \hOmega^k_n [k]$ denote the formal de Rham forms 
arranged in opposite degrees from usual (i.e., with $k$-forms beginning in degree $-k$ rather than $k$).
Note that we do {\em not} include the exterior derivative as part of the total differential
(for degree reasons this is not possible, but it is not relevant to our setting either).
Each cocycle $\ch^{\rm GF}_k(\cV)$ then provides a cocycle of degree \emph{zero} in $\hOmega^{-*}_n$.
Thus, any interesting formal combination of such characters --- like the Witten class defined below --- naturally sits in degree zero.

\begin{dfn} 
Let $E$ be an elliptic curve equipped with a holomorphic volume form $\omega \in \Omega^{1,0}(E)$. 
The $n$-dimensional {\em logarithmic formal Witten class} evaluated at $(E,\omega)$ is the formal sum
\ben
\log \Wit_n (E, \omega) := \sum_{k \geq 2} \frac{(2k-1)!}{(2\pi i)^{2k}}\, E_{2k}(E,\omega)\, \ch_{2k}^{\rm GF} (\hT_n) .
\een 
\end{dfn}

The Eisenstein series $E_{2k}$ is given by the formula
\ben
E_{2k}(\CC/\Lambda,\d z) = \sum_{\lambda \in \Lambda - \{0\}} \lambda^{-2k}
\een
where we witness the elliptic curve given as a quotient of the complex plane by the lattice $\Lambda$.
For an arbitrary $E$, we find a lattice $\Lambda$ such that 
$\d z$ identifies with $\omega$ under the isomorphism $\CC / \Lambda \cong E$. 
If the lattice is spanned by two elements
\ben
a + i b, c + i d \in \CC .
\een
Then the sum can be written as
\ben
\sum_{\lambda \neq \{0\}} \lambda^{-2k} = \sum_{(m,n) \in \ZZ^2 - \{(0,0)\}} (m a + i m b + n c + i n d)^{-2k} .
\een

\si 

Our main result in this section is that the scale $\infty$ effective interaction of the formal $\beta\gamma$ system, in the presence of the background $\TVect$ fields, is equivalent to the formal Witten class $\Wit_n(E,\omega)$ plus a term proportional to $\ch_2^{\rm GF}(\hT_n)$. 
To state the result, recall the extension $p : \TVect \to \Vect$ of Lie algebras determined by the formal second Chern character.

\begin{prop} \label{prop: formalwitten}
As a function on the harmonic forms $\cH(E)$,
the one-loop part of the scale $\infty$ effective quantization
$\Tilde{I}^{{\rm W}, (1)}[\infty]$ is
\ben
\frac{1}{32 \pi^4} \Bar{E}_2(E,\omega)\, p^*\ch_2^{\rm GF}(\hT_n) + 
\sum_{k \geq 2} \frac{(2k-1)!}{(4 \pi^2)^{2k}} E_{2k}(E, \omega)\, p^*\ch_{2k}^{\rm GF} (\hT_n),
\een
as a cocycle in $\clie^*(\TVect ; \hOmega^{-*}_{n}) $.
In particular, the one-loop effective quantization is cohomologous to $p^*\log \Wit_n(E, \omega)$.
\end{prop}

\begin{rmk}
The series $\Bar{E}_2(E)$ is the ``modular completion" of the second Eisenstein series.
In terms of the modular parameter $\tau$, it is defined by
\[
\Bar{E}_2 (\tau,\Bar{\tau}) = 1 - 24 \sum_{n=1}^\infty \frac{n q^n}{1-q^n} - \frac{3}{\pi {\rm Im}(\tau)}
\]
where $q = e^{2\pi i \tau}$. 
It has the property that it is modular, but not holomorphic. 
\end{rmk}

The term proportional to $\ch_2^{\rm GF}(\hT_n)$ arises from the term in the effective interaction on $E$ given by the weight of a wheel with two vertices. 
There is some delicate analysis involved in computing the precise contribution of this weight, but we see that when restricted to the extended Lie algebra $\TVect$ it is cohomologous to zero, by construction so we may disregard it. 

\subsection{The theory on an elliptic curve}

The quantization we have constructed above is invariant 
for the group $\Aff(\CC)$ of affine symmetries of the complex plane. 
Thus, for any elliptic curve $E = \CC/\Lambda$,
we can descend the quantization on $\CC$ along the quotient map $\CC \to E = \CC / \Lambda$.
The dg Lie algebra describing the theory on the elliptic curve $E$ is
\ben
\DD \fg_n^E = \Omega^{0,*}(E ; \fg_n) \oplus \Omega^{1,*}(E ; \fg_n^\vee[-2]) .
\een 
There is a simplification we can make in this setting. 
The choice of a holomorphic volume form $\omega$ determines an isomorphism of dg Lie algebras
\[
\begin{array}{ccc}
\Omega^{0,*}(E; \fg_n \oplus \fg_n^\vee[-2]) &\cong & \DD \fg_n^E\\
\gamma \tensor (\xi, \tau) & \leftrightarrow & (\gamma \tensor \xi,(\gamma \wedge \omega) \tensor \tau)
\end{array}.
\]
This isomorphism is naturally $(\Vect, \GL_n)$-equivariant. 

Note that there is an element $\omega^\vee \in \Omega^{0,1}(E)$  such that $\int \omega \wedge \omega^\vee = 1$.
At the level of cohomology, $[\omega^\vee]$ spans $H^1(E,\cO)$, by Serre duality.
We are free to choose $\omega^\vee$ to be {\em harmonic}, 
meaning it is annihilated by both $\partial$ and $\dbar$.
If $E = \CC/\Lambda$, then there is a constant
\[
v(E) = \int_{E} \d z \, \d\zbar
\]
and $\omega^\vee = v(E)^{-1} \d\zbar$.
In general, let $\delta$ denote~$(i \pi)^{-1}\omega^\vee$.

Let $\cH(E) \subset \DD \fg_n^E$ denote the sub dg Lie algebra of harmonic forms 
(that is, those forms that are in the kernel of $\partial$ and $\dbar$).
We have an isomorphism 
\ben
\cH(E) \cong \CC [\delta] \tensor (\fg_n \oplus \fg_n^\vee[-2])
\een
of dg Lie algebras, thanks to our choices above.

In anticipation of this section's main result, note that 
\[
\CC[\delta] \tensor \fg_n[-1] \cong \fgn \ltimes \fgn, 
\]
the natural extension of $\fgn$ by the shifted adjoint representation $\fgn[-1]$.
Hence,
\ben
\clie^*\left(\Vect ; {\rm C}_{\rm Lie,red}^*(\CC[\delta] \tensor \fg_n)\right)
\cong \clie^*(\Vect ; \hOmega^{-*}_n),
\een
where $\hOmega^{-*}_n$ is the regraded formal de Rham complex. 
We now explain why the scale $\infty$ effective action for the equivariant BV theory
produces a cocycle in this cochain complex.

The harmonic subspace $\cH(E)$ describes the solutions on $E$ to the equations of motion for the formal $\beta\gamma$ system.
If we restrict the scale $\infty$ effective interaction to this subspace, 
it provides an $\hbar$-dependent cocycle in the Lie algebra cochains:
\ben
\left(\Tilde{I}^{\rm W}[\infty] + \hbar J[\infty]\right) \Big|_{\cH(E)} \in
\clie^*\left(\TVect ; {\rm C}_{\rm Lie,red}^*(\CC[\delta] \tensor (\fg_n \oplus \fg_n^\vee[-2])) \right)  [\hbar].
\een
Note that the one-loop term of the effective interaction $\Tilde{I}^{\rm W,(1)}[\infty] + \hbar J [\infty]$ 
is only a functional of $\CC [\delta] \tensor \fg_n$ and
does not depend on $\CC [\delta] \tensor \fg_n^\vee[-2]$. 

In fact, at scale $\infty$, things become even simpler. 

\begin{lemma} 
The functional $J[\infty]$ vanishes on the subspace of harmonic forms:
\ben
J[\infty] \big|_{\cH(E)} = 0 .
\een
Thus, the scale $\infty$ effective interaction lies in the image of
$I^{\rm W}[\infty] |_{\cH}$ under the pullback map
\ben
p^* : \clie^*\left(\Vect ; {\rm C}_{\rm Lie,red}^*(\CC[\delta] \tensor \fg_n)\right) 
\to \clie^*(\TVect ; {\rm C}_{\rm Lie,red}^*\left(\CC[\delta] \tensor \fg_n)\right),
\een
where $p : \TVect \to \Vect$ is the extension of $\Vect$ by closed two-forms 
determined by~$\ch_2^{\rm GF}(\cT_n)$.
\end{lemma}

\begin{proof}
Recall, for fixed closed two-form $\omega$ the local functional $J_\omega$ is defined to be a functional on the
space $\Omega^{0,*}(E ; \fg_n)$. The definition of $J_\omega$ invovles a
single holomorphic
derivative acting on one of the input fields. When we restrict
to harmonic forms $\CC[\delta] \tensor \fg_n \hookrightarrow
\Omega^{0,*}(E ; \fg_n)$ the holomorphic derivative acts by zero and
hence $J_\omega|_\cH$ vanishes for all $\omega$. Thus $J|_{\cH}$ is
identically zero. Since the scale $\infty$
action $J[\infty]$ involves at least one vertex labeled by $J$ we see
that its restriction also vanishes. 
\end{proof}

In particular, the one-loop scale $\infty$ interaction comes as an element in  
\[
\clie^*(\Vect ; {\rm C}_{\rm Lie, red}^*(\CC [\delta] \tensor \fg_n)) = \clie^*(\Vect ; \hOmega^{-*}_n). 
\]
We wish to explicitly compute this element.

First, we make a remark about where the functional $I^{\rm W}$ lives
when our spacetime is an elliptic curve and we restrict to harmonic
forms. This restriction can be viewed as a functional
\ben
I^{\rm W} \big|_{\cH(E)} : \Vect \oplus \CC [\delta] \tensor (\fg_n[1]
\oplus \fg_n^\vee[-1]) \to \CC .
\een
Since $I^{\rm W}$ is linear in the $\fg_n^\vee$ and $\delta \fg_n$
component, we can view this restriction as an element in space
\ben
 \clie^*\left(\Vect ; {\rm C}_{\rm Lie,red}^*(\fg_n) \tensor \delta
 \fg^\vee \tensor \fg_n \right) .
\een 
Let
\ben
\d_{dR} : {\rm C}_{\rm Lie,red}^*(\fg_n)) \to \clie^*(\fg_n,\fg^\vee) \cong \hOmega^1_n
\een
be the de Rham differential. Then the element 
\ben
(\d_{dR} \tensor 1)I^{\rm W} \in  \clie^*(\Vect ; {\rm C}_{\rm
  Lie,red}^*(\fg_n) ) \tensor \delta \fg^\vee \tensor \End(\fg_n)
\cong \clie^*(\Vect ; \hOmega^1_n \tensor \End(\fg_n))
\een
is precisely the Atiyah class $\At^{\rm GF}(\hT_n)$ as shown in
Section \ref{sec atiyah 2}. 

Now we can move on to the main result of this section.

\subsection{Proof of Proposition \ref{prop: formalwitten}}

\si

We recall the general approach for computing the renormalized effective action on the elliptic curve $E$. 
The procedure splits into the following steps:
\begin{itemize}
\item[(1)] truncate the propagator $P_{\epsilon < L}$ at both the lower and upper bounds;
\item[(2)] compute the Feynman graph weight $W(P_{\epsilon<L}, I) = \sum_{\Gamma} W_{\Gamma} (P_{\epsilon<L}, I)$ as integrals over the elliptic curve $W_{\Gamma}(P_{\epsilon<L} , I) = \int_{E} w_{\Gamma}(P_{\epsilon < L}, I)$;
\item[(3)] take the limit $\lim_{\substack{\epsilon \to 0 \\ L \to 0}} W_{\Gamma}(P_{\epsilon<L} , I)$.
\end{itemize}
Our analysis so far has shown that the limit in step (3) exists.
However, in the proof of the proposition we will compute the limit in a direct way by exchanging the limit with the integration over $E$:
\[
\lim_{\substack{\epsilon \to 0 \\ L \to 0}}\int_{E} w_{\Gamma}(P_{\epsilon < L}, I) \stackrel{?}{=} \int_E \lim_{\substack{\epsilon \to 0 \\ L \to 0}}w_{\Gamma}(P_{\epsilon < L}, I) .
\]
The issue is that even though the limit in (3) exists, the expression above is not valid in general. 
Feynman integrals of this type were studied extensively in the work \cite{LiFeynman}.
A similar analysis as done there, and one we can check by direct calculation, implies that the limits above can be interchanged when the graph $\Gamma$ has no wheels with fewer than $3$ vertices.
The term proportional to $\ch_2^{\rm GF}(\hT_n)$ in the proposition corresponds to the wheel with two vertices, and so the proper regularization scheme outlined above must be performed. 

The weight expression for $\Tilde{I}^{{\rm W},(1)}$ is given by
\[
\sum_{\Gamma \in \text{\rm Wheels}} \frac{1}{|\Aut(\Gamma)|} \lim_{\substack{\epsilon \to 0 \\ L \to 0}} W_\Gamma(P_{\epsilon < L}, \Tilde{I}^{\rm W}) .
\]
Just as in the effective action on $\CC$, the tadpole diagram is identically zero.
When the number of vertices of the wheel is two, a similar calculation as in Lemma 2.2 of \cite{LiFeynman} shows that the weight of the graph is $\frac{1}{32 \pi^4} \Bar{E}_2(E,\omega)\, p^*\ch_2^{\rm GF}(\hT_n)$.
This is the first term in the expression of the effective action. 

It remains to compute the weights of wheels with number of vertices strictly bigger than two. 
By the remarks above, we can interchange the limits to obtain
\ben
\sum_{\Gamma \in \text{\rm Wheels}_{>2}} \frac{1}{|\Aut(\Gamma)|} \lim_{\substack{\epsilon \to 0 \\ L \to 0}} W_\Gamma(P_{\epsilon < L}, \Tilde{I}^{\rm W})  = \sum_{\Gamma \in \text{\rm Wheels}_{>2}} \frac{1}{|\Aut(\Gamma)|} W_\Gamma(P_{0 < \infty}, \Tilde{I}^{\rm W}) 
\een
where the sum is over $\Gamma \in \text{\rm Wheels}_{>2}$ all wheels with number of vertices bigger than two. 

We are computing the restriction of this to the subspace
\ben
\cSym(\Vect[1]^\vee) \tensor \cSym\left((\left(\CC[\delta] \tensor
  \fg_n[1]\right)^\vee)\right) .
\een

Each vertex of the wheel is labeled by the interaction $I^{\rm W}$. 
We now write down the propagators for which we are contracting.

We identify
\ben
\begin{array}{ccc}
\Omega^{0,*}(E) & \cong & C^\infty(E) \tensor \CC[\delta] \\
\mu^{-1} \d \zbar & \leftrightarrow & \delta
\end{array}
\een
where $\mu = i \pi \int_E \d z \,\d \zbar$. 

The scale $\infty$ propagator is
\ben
P_{0 < \infty}(z,w) = \int_{0}^\infty (\dbar^* \tensor 1) K_t (z,w) \d t .
\een 
When we descend to the elliptic curve, the heat kernel is 
\ben
K_t (z,w) = \left(\frac{1}{4 \pi t} e^{-|z-w|^2/4t}\right) (\delta \tensor 1 - 1
  \tensor \delta) \tensor (\id_{\fg_n} + \id_{\fg_n^\vee})
\een 
where $(4 \pi t)^{-1} e^{-|z-w|^2/4t} \in C^\infty(E \times E)$ is the
scalar heat kernel for the Laplacian on functions. The adjoint $\dbar^*$ satisfies
\ben
\dbar^*(f(z,\zbar) \d \zbar) = \frac{\partial f}{\partial z} 
\een
and hence we identify
\ben
P_{0<\infty}(z,w) = \int_{0}^\infty \mu^{-1} \frac{\partial}{\partial z}
\left(\frac{1}{4 \pi t} e^{-|z-w|^2/4t} \right) \tensor (\id_{\fg_n} + \id_{\fg_n^\vee})\, \d t .
\een 
In turn, we can think of this formula as the integral kernel for the operator
\ben
\mu^{-1} \frac{\partial}{\partial z} (2 \dbar \dbar^*)^{-1} \tensor \id : C^\infty(E) \tensor \fg_n \to C^\infty(E) \tensor \fg_n
\een
where $2 \dbar \dbar^*$ is the scalar Laplacian acting on functions. 

Using the identity $\d_{dR} I^{\rm W} = \At(\hT_n)$, 
we see that the sum of weights for diagrams of exactly $k$ vertices is
\ben
\frac{1}{k} \Tr \left( \left(p^*\At^{\rm GF} (\hT_n) \tensor
    \mu^{-1} \frac{\partial}{\partial z} (2\dbar \dbar^*)^{-1}
  \right)^{k} \right) \in \clie^*\left(\TVect ; \clie^*(\CC[\delta]
\tensor \fg_n ) \right) \cong \clie^*(\TVect ; \hOmega^{-*}_n) .
\een 
(This calculation recapitulates that of the obstruction.)
We know that the algebraic piece simplifies to $\Tr(\At^{\rm GF}(\hT_n)) = k! (2\pi i)^k \ch_{2k}^{\rm GF}(\hT_n)$. 
For odd $k$, the analytic factor vanishes. 
Finally, a direct computation shows that
\ben
\Tr\left(\left(\mu^{-1} \frac{\partial}{\partial z} (2\dbar \dbar^*)^{-1} \right)^{2k} \right) = \frac{1}{(4 \pi^2)^{2k}} E_{2k} 
\een
for $k > 2$.
One simply picks a natural Fourier basis for smooth functions on an elliptic curve $E = \CC/\Lambda$,
on which basis the operator  $\frac{\partial}{\partial z} (2\dbar \dbar^*)^{-1}$ is easy to describe.
(See, for instance, section 17.8 in \cite{WG2}.) This fact completes the proof. 

\section{The factorization algebras of equivariant
  observables}\label{sec equiv obs}

So far we have constructed classical and quantum BV theories for the formal $\beta\gamma$ system.
We now turn to analyzing the observables of these theories,
using the machinery of \cite{CG2}, which intertwines the BV formalism with factorization algebras.
As we show in Part 3, the factorization algebras that we construct here 
provide a refinement of the vertex algebras $\Gr\,\hCDO_n$ and $\hCDO_n$ from Part 1.

In brief a factorization algebra is a local-to-global object on a manifold --- in that sense, it is like a sheaf --- that encodes how to combine sections living on disjoint opens --- and hence, like an algebra.
In \cite{CG2} it is shown that every field theory in the BV formalism has an associated factorization algebra of observables.
For a classical field theory, the observables $\Obs^\cl$ assign to an open $U$, 
the commutative dg algebra of functions on the space of fields on $U$.
Thus classical observables form a commutative factorization algebra.
A BV quantization amounts, in essence, to deform the differential from $\{S^\cl,-\}$ to $\{S^\q,-\} + \hbar \Delta$, 
where $S^\cl$ is the classical action functional and $S^\q$ is its quantization.
The quantum observables are thus a deformation of the commutative factorization algebra $\obs^\cl$ to a factorization algebra (which has no commutative structure).

Our work in Section \ref{sec equiv bv} thus provides factorization algebras 
for the equivariant and non-equivariant formal $\beta\gamma$ system.
Before we spell out those objects in detail, though, 
we must give the definition of a factorization algebra and discuss the relevant functional analysis.

\begin{rmk}
Although we attempt to describe all the relevant ideas and definitions here,
we rely extensively on results and arguments in \cite{CG2},
which contains a lengthy treatment of the formalism we deploy.
For further details, motivation, and context, we refer the reader there.
\end{rmk}

\subsection{An overview of factorization algebras}

Let $X$ be a topological space and $\cC^\otimes$ a symmetric monoidal category.
For us $X$ will be a Riemann surface, typically $\CC$, and 
$\cC^\otimes$ will be a category of cochain complexes of vector spaces with $\otimes$ the tensor product.
(In Section \ref{sec functional analysis} we discuss the type of vector spaces and tensor product that we use,
since issues of functional analysis appear.)
Here we give the general definition and refer to \cite{CG1,CG2} for more detail and motivation.

\begin{dfn}
A \emph{prefactorization algebra} $\cF$ on $X$ with values in $\cC^\otimes$ 
assigns to each open $U$ in $X$, an object $\cF(U)$ in $\cC$, and 
assigns to each finite collection $\{U_1,\ldots,U_n\}$ of pairwise disjoint opens in $X$
where each $U_i \subset V$, a morphism
\[
\cF_V^{U_1,\ldots,U_n}: \cF(U_1) \otimes \cdots \otimes \cF(U_n) \to \cF(V).
\]
These assignments satisfy
\begin{enumerate}
\item the morphisms compose, so that
\[
\cF_V^{U_1,\ldots,U_n} \circ \bigotimes_{i = 1}^n \cF_{U_i}^{T_{i,1},\ldots,T_{i,{m_i}}} = \cF_V^{T_{1,1},\ldots,T_{n,m_n}}
\]
for any choice of pairwise disjoints open $\{T_{i_1},\ldots,T_{i_{m_i}}\}$ inside $U_i$ for each $i$, and
\item the morphisms are equivariant under rearrangement of labels, 
so that for any permutation $\sigma \in S_n$, the composite
\[
\cF(U_{\sigma(1)}) \otimes \cdots \otimes \cF(U_{\sigma(n)}) \xto{\cong} \cF(U_1) \otimes \cdots \otimes \cF(U_n) \xto{\cF_V^{U_1,\ldots,U_n}} \cF(V)\to \cF(V)
\] 
equals $\cF_V^{U_{\sigma(1)}) \otimes \cdots \otimes \cF(U_{\sigma(n)}}$.
\end{enumerate}
\end{dfn}

This structure encodes a kind of algebra parametrized by the geometry of $X$.
The data of $\cF$ explains how to ``multiply'' elements living on opens $U_i$ into an element on $V$.

An associative algebra $A$ provides an example living on $X = \RR$.
To each open interval $I$, one assigns $A$, and 
to a union of disjoint intervals $\sqcup_{j \in J} I_j$, one assigns the tensor product $\bigotimes_{j \in J} A$.
Each structure map is determined by the multiplication in $A$.

Another example, central to our work here, is the following. 
Let $E \to X$ be a vector bundle on a smooth manifold.
Let $\sE_c$ denote the precosheaf of compactly supported sections of $E$:
to each open $U$, we assign $\sE_c(U) = \Gamma_c(U,E)$, and 
there is a natural extension-by-zero $\sE_c(U) \to \sE_c(V)$ whenever $U \subset V$.
This precosheaf satisfies that
\[
\sE_c( U_1 \sqcup U_2) \cong \sE_c(U_1) \oplus \sE_c(U_2)
\]
for any disjoint union of opens. 
Using the appropriate notion of tensor product, discussed below, 
one then sees that
\[
\Sym(\sE_c( U_1 \sqcup U_2)) \cong \Sym(\sE_c(U_1) \oplus \sE_c(U_2)) \cong \Sym(\sE_c(U_1)) \otimes \Sym(\sE_c(U_2)),
\]
which provides a natural map 
\[
\Sym(\sE_c(U_1)) \otimes \Sym(\sE_c(U_2)) \to\Sym(\sE_c(V))
\]
for any $V \supset U_1 \sqcup U_2$.
In this way, one shows that $\Sym(\sE_c)$ forms a prefactorization algebra.

A factorization algebra is a prefactorization algebra satisfying a local-to-global condition,
just as a sheaf is a presheaf satisfying one.
The primary difference in the conditions is that the notion of cover changes.

\begin{dfn}
A \emph{Weiss cover} $\{U_i\}_{i \in I}$ of an open $V$ is a collection 
of opens $U_i \subset V$ such that for any finite set of points $\{x_1,\ldots,x_n\} \subset V$,
there is some $U_i \supset \{x_1,\ldots,x_n\}$.
\end{dfn}

We will restrict our attention now to $\cC$ that are categories of cochain complexes of vector spaces.
(More generally, the definition below is well-behaved for cochain complexes on a Grothendieck abelian category.
See Appendix C of \cite{CG1}.)
Since we view quasi-isomorphic cochain complexes as equivalent 
(i.e., we are interested in the higher category arising from quasi-isomorphism as the notion of weak equivalence),
the local-to-global condition is a cochain refinement of the usual notion.

\begin{dfn}
A \emph{factorization algebra} is a prefactorization algebra $\cF$ such that
for any open $V$ and any Weiss cover $\{U_i\}_{i \in I}$ of $V$,
the natural map
\[
\check{C}(\{U_i\}_{i \in I},\cF) \to \cF(V)
\]
is a quasi-isomorphism.
(Here the left hand side denotes the \v{C}ech complex of $\cF$ on the cover.)
\end{dfn}

\subsection{A comment on functional analysis}
\label{sec functional analysis}

We are working throughout with infinite-dimensional vector spaces 
such as the space of smooth functions $C^\infty(X)$ on a smooth manifold.
Thus we need to be careful about issues such as tensor products and duals,
since the setting of plain vector spaces is not appropriate or adequate for our constructions.
Appendix B of \cite{CG1} describes a category of {\em differentiable vector spaces} well-suited to our setting, 
and it explains its relationship with other natural choices, 
such as locally convex topological vector spaces, bornological vector spaces, or convenient vector spaces.
The reader wishing for a discussion about the subtleties of constructing factorization algebras in such settings should look in~\cite{CG1}.

Here we simply state explicitly what we mean by duals and tensor product for the vector spaces with which we work.
These definitions are natural for both differential geometry and functional analysis.

Let $E \to X$ be a finite-rank vector bundle on a smooth manifold.
We use the following notations:
\begin{enumerate}
\item[(1)] the smooth sections are $\sE = \Gamma(X,E)$,
\item[(2)] the compactly supported smooth sections are $\sE_c = \Gamma_c(X,E)$,
\item[(3)] the distributional sections are $\Bar{\sE}$, and
\item[(4)] the compactly supported distributional sections are $\Bar{\sE}_c$.
\end{enumerate}
Let $E^! = E^\vee \otimes {\rm Dens}_X$ denote the vector bundle given by 
the tensor product of the fiberwise linear dual $E^\vee$ with the density line ${\rm Dens}_X$.
Then we write
\begin{enumerate}
\item[(1)] the smooth sections as $\sE^! = \Gamma(X,E^!)$,
\item[(2)] the compactly supported smooth sections as $\sE_c^! = \Gamma_c(X,E^!)$,
\item[(3)] the distributional sections are $\Bar{\sE}^!$, and
\item[(4)] the compactly supported distributional sections are $\Bar{\sE}_c^!$.
\end{enumerate}
Note that the vector bundle map $\ev: E^\vee \otimes E \to \underline{\CC}$ given by the fiberwise evaluation pairing 
induces a vector bundle map $\langle-,-\rangle_{fib}: E^! \otimes E \to {\rm Dens}_X$.
This pairing then extends a natural bilinear pairing 
\[
\begin{array}{cccc}
\langle-,-\rangle: &\Bar{\sE}^!_c \times \sE & \to & \CC \\
& (\lambda,f) & \mapsto & \int_X \langle \lambda, f\rangle_{fib}
\end{array}.
\]
There are clearly also versions for $\Bar{\sE}^! \times \sE_c$ or with distributional sections of $\sE$ and so on.

\begin{dfn}
We write $\sE^\vee$ for $\Bar{\sE}^!_c$ and call it the {\em dual} of $\sE$. 
We use $\langle-,-\rangle$ for the {\em evaluation pairing} $\ev: \sE^\vee \times \sE \to \CC$.
Similarly, we write $\sE_c^\vee$ for $\Bar{\sE}^!$, $(\Bar{\sE})^\vee$  for $\sE^!_c$, and $(\Bar{\sE}_c)^\vee$  for $\sE^!$.
\end{dfn}

Given $E \to X$ and $F \to Y$ finite-rank vector bundles on smooth manifolds,
let $E \boxtimes F \to X \times Y$ denote $\pi_X^*E \otimes \pi_Y^* F$,
i.e., the tensor product of the vector bundles pulled back along the projection maps 
$\pi_X: X \times Y \to X$ and $\pi_Y: X \times Y \to Y$.

\begin{dfn}
We write $\sE \otimes \sF$ for the smooth sections of $E \boxtimes F$ and call it the \emph{tensor product}.
Similarly, we write 
$\sE_c \otimes \sF_c$ for the compactly supported smooth sections of $E \boxtimes F$,
$\Bar{\sE} \otimes \Bar{\sF}$ for the distributional sections of $E \boxtimes F$, and
$\Bar{\sE}_c \otimes \Bar{\sF}_c$ for the compactly supported distributional sections of $E \boxtimes F$.
\end{dfn}

It makes sense to ask for sections of $E \boxtimes F$ that are distributional in the $X$-direction but smooth in the $Y$-direction,
and we write $\Bar{\sE} \otimes \sF$ for this space.

\begin{dfn}
For a $\ZZ$-graded vector bundle $E \to X$, the {\em algebra of functions} on $\sE$ is
\[
\Sym(\sE^\vee) := \bigoplus_{n \geq 0} ((\Bar{\sE}_c^!)^{\otimes n})_{S_n}.
\]
The {\em completed} algebra of functions on $\sE$ is
\[
\cSym(\sE^\vee) := \prod_{n \geq 0} ((\Bar{\sE}_c^!)^{\otimes n})_{S_n}.
\]
\end{dfn}

In particular, an element $f$ of the $n$th symmetric power $\Sym^n(\sE)$ 
can be identified with a compactly supported distributional section of $\Gamma(X^n, (E^!)^{\boxtimes n})$
that is invariant under the natural permutation action of~$S_n$.

Note that these definitions make it straightforward to express the Chevalley-Eilenberg cochains
of dg Lie algebras like $\DD\fgn^S$, whose underlying graded vector spaces are of the type described here.

\subsection{The non-equivariant classical observables}

We begin by defining the classical observables on a fixed source.

\begin{dfn}
The \emph{classical observables} $\Obs^{\cl}_n(S)$ 
for the rank $n$ formal $\beta\gamma$ system on the Riemann surface $S$ 
is the completed algebra of functions on the space of fields
\[
\Omega^{0,*}(S)^{\oplus n} \oplus \Omega^{1,*}(S)^{\oplus n} = (\DD \fgn^S)[1]
\]
equipped with the differential given by extending $\dbar$ as a derivation.
Hence
\[
\Obs^{\cl}_n(S) = \clies(\DD \fgn^S),
\]
where the Chevalley-Eilenberg cochains are constructed using the appropriate versions of dual and tensor product.
\end{dfn}

Explicitly, the underlying graded algebra is
\[
\cSym(\Bar{\Omega}^{1,*}_c(S)^{\oplus n}[1] \oplus \Bar{\Omega}^{0,*}_c(S)^{\oplus n}[1]).
\]
The differential can be understood explicitly as follows.
For some $n$-fold tensor product of linear functionals on the fields
\[
a = \alpha_1 \otimes \cdots \otimes \alpha_n,
\]
we have
\[
\dbar(a) = (\dbar \alpha_1) \otimes \cdots \otimes \alpha_n \pm \alpha_1 \otimes (\dbar \alpha_1) \otimes \cdots \otimes \alpha_n + \cdots \pm\alpha_1 \otimes \cdots \otimes (\dbar \alpha_n).
\]
This differential is equivariant with respect to the permutation action of the symmetric group $S_n$ and 
hence induces a differential on the $n$th symmetric power.

It is manifest that these observables are natural with respect to holomorphic embeddings.
That is, given a holomorphic embedding $i: S \hookrightarrow S'$,
there is a natural extension map
\[
i_*: \Obs^\cl_n(S) \to \Obs^\cl_n(S')
\]
that is naturally induced by the restriction map of fields
\[
i^*: \DD\fgn^{S'} \to \DD\fgn^{S}.
\]
Indeed, we have a factorization algebra on any Riemann surface by Theorem 5.2.1 of \cite{CG1}.
For the purpose of extracting the vertex algebra, it will suffice to focus on $S = \CC$ and not consider all Riemann surfaces at the same time.

\begin{dfn}
Let $\Obs^\cl_n$ denote the factorization algebra on $\CC$ of classical observables for the rank $n$ formal $\beta\gamma$ system.
\end{dfn}

We remark that as $\GL_n(\CC)$ acts naturally on $\CC^n \cong \fgn[1]$,
it also acts naturally on $\Obs^\cl_n(S)$ for any Riemann surface $S$.
This action manifestly respects the differential $\dbar$, 
which only depends on the source $S$ and not on the target $\hD^n$.

\subsection{The non-equivariant quantum observables}

The BV formalism suggests that the quantum observables on $S$ should arise by 
\begin{enumerate}
\item[(a)] tensoring the underlying graded vector space of $\Obs^\cl_n$ with $\CC[[\hbar]]$ and
\item[(b)] modifying the differential to $\dbar +\hbar \Delta$, where $\Delta$ is the BV Laplacian.
\end{enumerate}
This suggestion does not work because $\Delta$ is not defined on all of the observables;
the naive formula involves an ill-defined pairing of distributions.
There are two ways to circumvent this difficulty. 
First, one can work with a smaller class of observables --- such as those arising from smooth functionals, not distributional ones --- and this approach is developed in detail for the free $\beta\gamma$ system in Chapter 5, Section 3 of \cite{CG1}.
(We discuss this approach in Section \ref{noneqsec}, where we also show the two approaches agree.) 
Second, one can mollify $\Delta$ instead.
This approach is developed in a very broad context in Chapter 9 of \cite{CG2},
and we have encountered it already in the scale $L$ BV Laplacians $\Delta_L$.
These two approaches provide quasi-isomorphic factorization algebras, 
as we show in Proposition~\ref{equiv of noneq}. The second approach is what we will explain here, as it is the one that extends to the equivariant setting.


Before delving into the machinery necessary to define a factorization algebra of quantum observables,
let us note that we have a working description of the global observables on~$\CC$.

\begin{dfn}
The \emph{global scale $L$ quantum observables for the rank $n$ formal $\beta\gamma$ system} has
underlying graded vector space
\[
\cSym(\Bar{\Omega}^{1,*}_c(\CC)^{\oplus n}[1] \oplus \Bar{\Omega}^{0,*}_c(\CC)^{\oplus n}[1])[[\hbar]]
\]
with differential $\dbar + \hbar \Delta_L$. 
We denote it $\Obs^q_n[L](\CC)$.
\end{dfn}

The quantum observables are isomorphic for any choice of length scale.
In fact, the RG flow provides an explicit isomorphism $W_\epsilon^L: \Obs^q_n[\epsilon](\CC) \to \Obs^q_n[L](\CC)$ as follows: 
given an observable $f$ at scale $\epsilon$, let $W_\epsilon^L(f)$ denote the observable such that
\[
W(P_\epsilon^L, \delta f) = \delta W_\epsilon^L(f)
\]
where $W(P_\epsilon^L, -)$ is the RG flow operation defined earlier on action functionals, 
$\delta^2=0$,  and $|\delta| = - |f|$. 
(In other words, this map arises by taking the ``derivative of RG flow'' $W(P_\epsilon^L, -)$.)

The basic approach used here works in general, 
except that we will need to work with a more flexible notion of ``length scale'':
we need to allow arbitrary parametrices for $\dbar$.
(Indeed, when interactions are included, the RG flow map $W_\epsilon^L$ does not preserve support conditions on observables,
because the heat kernel has support everywhere.)
After reviewing this machinery, we use it to define the factorization algebra of quantum observables.

\subsubsection{Recap of parametrices and BV Laplacians}
\label{parametrices}

We give here the specialization to our situation of the general definition from Chapter 8, Section 2.4 of \cite{CG2}.
Recall that we are working on $\CC$ with its standard, Euclidean metric.
Let $\dbar^*$ denote the Hodge dual operator to $\dbar$ with respect
to this metric. It is our choice of ``gauge-fix,'' in the terminology of \cite{CosBook}.
Let $\triangle = [\dbar,\dbar^*]$ denote the Hodge Laplacian on Dolbeault forms.

We remark on our convention for integral kernels.
Given a continuous linear endomorphism $P$ of $\Omega^{0,*}(\CC)$, 
we use $K_P$ to denote the \emph{integral kernel} for $P$:
it is the section of $\Omega^{0,*}(\CC) \widehat{\otimes}_\pi \Bar{\Omega}^{1,*}_c(\CC)$ such that
\[
(P\alpha)(z) = \int_{w \in \CC} \langle K_P(z,w), \alpha(w)\rangle_w,
\]
where the BV pairing is along the $w$-direction.
(We remark that Schwarz's kernel theorem tells us where the integral kernel lives depending upon the domain and range of the continuous linear operator.
Here $\Bar{\Omega}^{1,*}_c(\CC)$ appears because the domain is the continuous linear dual space~$\Omega^{0,*}(\CC)$.)

\begin{dfn}
A {\em parametrix} for $\dbar$ on $\Omega^{0,*}(\CC)$ is a distributional section $\Phi$ of
$\Omega^{1,*}(\CC \times \CC)$ such that
\begin{enumerate}
\item $\Phi$ has cohomological degree one,
\item $\Phi$ is symmetric with respect to the $S_2$ action,
\item $\Phi$ has proper support with respect to the two projection maps from $\CC^2$ to $\CC$,~and
\item $(\triangle \otimes \id) \Phi - K_{\id}$ is a smooth section of $\Omega^{1,*}(\CC \times \CC)$,
where $K_{\id}$ is the integral kernel for the identity operator with respect to the BV pairing.
\end{enumerate}
Let ${\rm Param}$ denote the set of parametrices.
\end{dfn}

There is a natural partial ordering on ${\rm Param}$ by support:
$\Psi \leq \Phi$ if $\supp(\Psi) \subset \supp(\Phi)$.

We remark that the integral kernel $\Psi = \int_0^L K_t^{an}$, using the analytic heat kernel from Section \ref{sec prequant},
satisfies all these conditions except proper support. 
It is, in fact, supported everywhere on $\CC^2$.
(It is thus an ``almost-parametrix.'')
One can easily obtain a parametrix from $\Psi$ as follows: 
pick a smooth function $f$ on $\CC^2$ that is 1 in a neighborhood of the diagonal and vanishes sufficiently far from the diagonal,
and consider $f \Psi$.
This construction will allow us to translate between results written in terms of heat kernels (i.e., length scale)
and those written in terms of parametrices.

\begin{rmk}
Above we only define parametrices for $\dbar$. 
Each $\Phi \in {\rm Param}$ automatically determine a parametrix for the rank $n$ formal $\beta\gamma$ system
by taking $\Phi \otimes (\id_{\fgn} + \id_{\fgn^\vee})$.
Given this relationship, we will not overload the notation and use $\Phi$, 
with the implicit understanding that the algebraic factor is included in the rank $n$ case.
\end{rmk}

We now define versions of the propagator and BV Laplacian for each parametrix $\Phi$,
analogous to $P_\epsilon^L$ and $\Delta_L$ from earlier.
Note that for the rank $n$ formal $\beta\gamma$ system, 

\begin{dfn}
Given a parametrix $\Phi$, the \emph{$\Phi$-propagator} is the integral kernel
\[
P_{\Phi}=\frac{1}{2} (\dbar^* \otimes \id + \id \otimes \dbar^*)\Phi.
\]
Let $\kappa_\Phi$ denote the integral kernel $K_\id - (\dbar \otimes \id + \id \otimes \dbar)P_\Phi$.
\end{dfn}

The crucial point here is that the kernel $\kappa_\Phi$ is smooth. Moreover, it is the analog of the analytic heat kernel $K_t$ from earlier.

We are now in a position to define a mollified BV Laplacian.

\begin{dfn}
The \emph{$\Phi$-BV Laplacian} $\Delta_\Phi$ is the operator $\partial_{\kappa_\Phi}$.
That is, it is the endomorphism of $(\Obs^\cl_n(\CC))^\sharp$ --- the underlying graded algebra of observables --- given by contracting with $\kappa_\Phi$. 
\end{dfn}

For clarity's sake, let us describe this operator explicitly.
Given $a$ in the $n$th symmetric power of the observables, pick a lift $\tilde{a}$ to the $n$th tensor power.
Then 
\[
(\partial_{\kappa_\Phi}a)(x) = \tilde{a}(\kappa_\phi \otimes x \otimes \cdots \otimes x),
\]
where we insert $n-2$ copies of $x$ on the right hand side.

These definitions allow one to define effective field theories, but with length scale replaced by a choice of parametrix.
For a full treatment, see Section 8.2.9 of \cite{CG2}.
The essential changes are that 
\begin{itemize}
\item RG flow from $\Phi$ to $\Psi$ is given by $W(P_\Phi - P_\Psi,-)$, using the same Feynman diagram expansion, and
\item the same local functional should be recovered in the limit as the support of the parametrices goes to the small diagonal.
\end{itemize} 
We can obtain such an effective field theory from the length scale version 
by RG flow to any parametrix from a fixed almost-parametrix for some length scale.

\subsubsection{Observables}

We can now mimic the scale $L$ definition of global observables.

\begin{dfn}
For a parametrix $\Phi$, the  \emph{global $\Phi$-quantum observables for the rank $n$ formal $\beta\gamma$ system} has
underlying graded vector space
\[
\cSym(\Bar{\Omega}_c^{1,*}(\CC)^{\oplus n}[1] \oplus \Bar{\Omega}^{0,*}_c(\CC)^{\oplus n}[1])[[\hbar]]
\]
with differential $\dbar + \hbar \Delta_\Phi$. 
We denote it $\Obs^q_n[\Phi](\CC)$.
\end{dfn}

Again, Lemma 9.3.1.2 of \cite{CG2} shows that the quantum observables are isomorphic for any choice of parametrix.
The isomorphism is explicitly given by the ``derivative of the RG flow'':
\[
W_\Phi^\Psi: f \in \Obs^q_n[\Phi](\CC) \mapsto \frac{\partial}{\partial \delta}(W(P_\Psi - P_\Phi, \delta f)) \in \Obs^q_n[\Psi](\CC).
\]
Because our parametrices have proper support, though, they only expand the support of an observable $f$ by a controlled amount 
(essentially determined by how the size of the parametrix's support).

\begin{dfn}
Let $\Obs^q_n(\CC)$ denote the cochain complex of quantum observables up to isomorphism.
That is, an \emph{observable} $f \in \Obs^q_n(\CC)$ is a family of elements $\{f[\Phi]\}_{\Phi \in {\rm Param}}$ for every parametrix $\Phi$ 
such that the $f[\Psi] = W_\Phi^\Psi(f[\Phi])$ for any pair of parametrices $\Psi$ and $\Phi$.
\end{dfn}

\begin{dfn}
Let $f$ be an observable in $\Obs^q_n(\CC)$ and denote its Taylor expansion by
\[
f = \sum_{j,k \geq 0} \hbar^j f_{j,k},
\]
with $f_{j,k}$ in the $k$th symmetric power. 
We say that $f$ has \emph{support in $U \subset \CC$} if 
for every $(j,k)$, there is some compact subset $C \subset U^k$ and some parametrix $\Phi$
such that $\supp(f_{j,k}[\Psi]) \subset C$ for all $\Psi \leq \Phi$.
\end{dfn}

By Lemma 9.4.0.2 of \cite{CG2}, the graded vector space $\Obs^q_n(U)$ of observables with support in $U$
is preserved by the differential $\dbar + \hbar \Delta$ and hence provides a sub-complex of $\Obs^q_n(\CC)$.
The remainder of Chapter 9 of \cite{CG2} shows that these naturally form a factorization algebra.

\begin{dfn}\label{noneq quantum obs}
Let $\Obs^q_n$ denote the factorization algebra on $\CC$ of quantum observables for the rank $n$ formal $\beta\gamma$ system.
\end{dfn}

We remark again that $\GL_n(\CC)$ acts naturally on $\CC^n \cong \fgn[1]$
and on its linear dual so as to preserve the evaluation pairing.
Hence $\GL_n(\CC)$ also acts naturally on $\Obs^\q_n(U)$ for any open $U \subset \CC$.
This action respects the differential $\dbar + \hbar \Delta_\Phi$, 
since $\dbar$ only depends on the source $U$ and not on the target $\hD^n$
and $\Delta_\Phi$ depends on the target only through the evaluation pairing.

\subsection{The $\Vect$-equivariant classical observables}

We discussed in Section 3 \ref{classicalvectaction} that 
diffeomorphisms on the target of the curved $\beta\gamma$ system 
naturally act on the fields by post-composition.
In Section 3.3 we gave an efficient description of this action for the formal $\beta\gamma$ system
via an $\L8$-action of $\Vect$ on $\DD\fgn^U$ for any open $U \subset \CC$.
This action then determines an $\L8$-action of $\Vect$ on $\Obs^\cl_n(U) = \clies(\DD\fgn^U)$
and hence a cochain complex $\clies(\Vect,\Obs^\cl_n)$.
In other words, by the yoga of Koszul duality, 
this action can be encoded as a modification of the differential on the tensor product $\clies(\Vect) \otimes \Obs^\cl_n$.
By Lemma \ref{Noether} we know that $\{I^{\rm W},-\}$ provides this twisting of the differential.
Since $I^{\rm W}$ is a local functional, this modified differential is still local in the source manifold $\CC$
and thus respects the structure maps of the factorization algebra.
The following definition gathers together these observations.

\begin{dfn}
The \emph{factorization algebra of $\Vect$-equivariant classical observables} on $\CC$ is
\[
\eqObs^\cl_n = \clies(\Vect, \Obs^\cl_n).
\]
The underlying graded vector space is
\[
\cSym(\Vect^\vee[-1]) \otimes \cSym((\Bar{\Omega}^{1,*}_c)^{\oplus n}[1] \oplus (\Bar{\Omega}^{0,*}_c)^{\oplus n}[1])
\]
with differential $\d_{\clies(\Vect)} + \dbar + \{I^{\rm W},-\}$.
\end{dfn}

Note that in $I^{\rm W}$, the dependence on the vector field $X \in \Vect$ is linear. 
Hence $\Obs^\cl_n$ has a strict Lie algebra action of $\Vect$, not a complicated $\L8$-action.
In light of the remarks following Definition \ref{noneq quantum obs}, we see the following,
which we record as a lemma for use when applying Gelfand-Kazhdan descent in Section \label{sec ss GK descent}.

\begin{lemma}
The classical observables $\Obs^\cl_n$ are a representation of the Harish-Chandra pair~$(\Vect,\GL_n)$.
In particular $\GL_n$ acts by (strict) automorphisms of the factorization algebra, and
$\Vect$ acts by (strict) derivations of the factorization algebra. Via
restriction along $p : (\TVect, \GL_n) \to (\Vect, \GL_n)$ the
classical observables $\Obs^{cl}_n$ are also a representation for the pair
$(\TVect, \GL_n)$. 
\end{lemma}

\subsection{The $\TVect$-equivariant quantum observables}

The construction of the $\TVect$-equivariant quantum observables is straightforward,
given the work we did in Section \ref{sec equiv bv}.
The logic is analogous to the case of classical observables:
we encode the $\L8$-action of $\TVect$ on observables in the differential.

\begin{dfn}
The \emph{factorization algebra of $\TVect$-equivariant quantum observables} on $\CC$ is
\[
\eqObs^\q_n = \clies(\TVect, \Obs^\cl_n)[[\hbar]].
\]
The underlying graded vector space is
\[
\cSym(\TVect^\vee[-1]) \otimes \cSym((\Bar{\Omega}^{1,*}_c)^{\oplus n}[1] \oplus (\Bar{\Omega}^{0,*}_c)^{\oplus n}[1])[[\hbar]]
\]
with differential 
\[
\d_{\clies(\TVect)} + \dbar + \{I^{\rm W,0},-\} + \hbar \Delta + \hbar \{I^{\rm W,1}+J,-\},
\]
to give an explicit description.
\end{dfn}

For clarity's sake let us point out that this means that for each parametrix $\Phi$, we have global observables
\[
\cSym(\TVect^\vee[-1]) \otimes \cSym(\Bar{\Omega}^{1,*}_c(\CC)^{\oplus n}[1] \oplus \Bar{\Omega}^{0,*}_c(\CC)^{\oplus n}[1])
\]
with differential 
\[
\d_{\clies(\TVect)} + \dbar + \{I^{{\rm W},0}[\Phi],-\}_\Phi + \hbar \Delta_\Phi + \hbar \{I^{{\rm W},1}[\Phi]+J[\Phi],-\}_\Phi.
\]
These observables are isomorphic for all choices of parametrix,
so that our notation in the definition should be unambiguous.
Moreover, we find that the notion of support for an observable is well-behaved 
and so we can talk about the observables with support in a fixed open $U$,
thus obtaining a factorization algebra.

\begin{rmk}
Working over the base ring $\clies(\TVect)$ amounts to a version of the background field method,
where we view the quantum action functional (encoded in the differential) as depending on a choice of vector field and closed 2-form,
i.e., an element of $\TVect$.
In a sense we see that after quantizing, we obtain extended symmetries
of the theory which we have already seen coincide with those of the
physical curved $\beta\gamma$ system.
\end{rmk}

By contrast to the classical case, the quantum observables $\Obs^\q_n$ do not have a strict Lie action of $\TVect$.
The $\hbar$-term $I^{{\rm W},1}$ is not linear in $\Vect$ and has
contributions of every even power.
Thus we cannot apply strict Gelfand-Kazhdan descent for
$(\TVect,\GL_n)$. We have already observed that when restricted to
linear vector fields $\gl_n \hookrightarrow \TVect$ that the anomaly
vanishes. Thus, the quantum observables $\Obs^q_n$ admit a {\it strict} action by~$\gl_n$.

\subsection{An aside on the two versions of non-equivariant observables}
\label{noneqsec}

As mentioned earlier, there is another approach to constructing the non-equivariant factorization algebra of observables
for the formal $\beta\gamma$ system, which is developed in \cite{CG1}.
We sketch it briefly here and prove that it is quasi-isomorphic to the observables described above.

Thus, the key idea is to work with observables built out of smooth or smeared distributions.
By contrast, the observables already introduced live in a completed symmetric algebra of distributions 
(more precisely, the distributions dual to Dolbeault forms),
and the need for parametrices is due to inability to apply the BV Laplacian to such distributions,
since distributions do not always pair.

Here is a concrete example of replacing distributions with smeared versions.
Consider the delta-function 
\[
\delta_0: \gamma \mapsto \gamma(0).
\]
Now pick a compactly-supported smooth function $f: (0,1) \to \RR$ such that $\int_\RR f(t) \, \d t = 1$.
Then a smeared version is
\[
\tilde{\delta}_0: \gamma \mapsto \frac{1}{2\pi i}\int_{r = 0}^1 \int_{|z|=r} \frac{\gamma(z)}{z} \d z\, f(r) \,\d r,
\]
which agrees with $\delta_0$ if $\gamma$ is holomorphic, by Cauchy's theorem.
In particular, in the cochain complex $\Bar{\Omega}^{1,*}_c(\CC)[1]$, 
these distributions $\delta_0$ and $\tilde{\delta}_0$ are cohomologous $0$-cocycles.

\def\fr{{\rm fr}}

\begin{dfn}
The \emph{smeared quantum observables for the rank $n$ formal $\beta\gamma$ system} 
with support in the open $U \subset \CC$ has underlying graded vector space
\[
\cSym({\Omega}^{1,*}_c(U)^{\oplus n}[1] \oplus {\Omega}^{0,*}_c(U)^{\oplus n}[1])[[\hbar]]
\]
with differential $\dbar + \hbar \Delta$. 
We denote it $\Obs^{\q,\fr}_n(U)$.
\end{dfn}

As the observables are built out of smooth sections, the ``naive'' BV Laplacian $\Delta = \partial_{K_{id}}$ is well-defined.
We view this operator as the BV Laplacian ``at scale zero," since $K_{id}$ is the distributional limit of the $K_L$.
Moreover, since $\Delta$ is fully local, these smeared observables automatically form a factorization algebra,
with no need to discuss support issues.

This construction raises the question of how the smeared observables compare to the observables from Definition \ref{noneq quantum obs}.
They are, in fact, quasi-isomorphic factorization algebras, but the quasi-isomorphism is built in two steps.
First, on smeared observables, the RG flow operator makes sense from ``scale zero" to an arbitrary parametrix $\Phi$:
\[
W_0^\Phi: \Obs^{\q,\fr}_n(\CC) \to \Obs^{\q,\fr}_n[\Phi](\CC)
\]
where the target $\Phi$-observables consists of the same graded vector space of smeared observables 
but with differential $\dbar +\hbar \Delta_\Phi$.
This map is an isomorphism of cochain complexes with inverse $W_\Phi^0$.
(It does affect support of observables, but we say an observable $f \in \Obs^{\q,\fr}_n[\Phi](\CC)$ is supported in an open set $U$
if $W_\Phi^0(f)$ is supported in $U$.)
Second, consider the inclusion
\[
i[\Phi]: \Obs^{\q,\fr}_n[\Phi](\CC) \hookrightarrow \Obs^{\q}_n[\Phi](\CC),
\]
arising from the inclusion of smooth sections into distribution sectionals. 
This map is a quasi-isomorphism: the spectral sequence arising from the $\hbar$-filtration is an isomorphism on the first page.
The composite $i \circ W_0^\Phi$ thus defines a quasi-isomorphism of cochain complexes,
and it intertwines support conditions, thus extending to a map $i: \Obs^{\q,\fr}_n \to \Obs^{\q}_n$.
Hence we have proved the following.

\begin{prop}
\label{equiv of noneq}
The map $i: \Obs^{\q,\fr}_n \to \Obs^{\q}_n$ is a quasi-isomorphism of factorization algebras.
\end{prop}

\section{Semi-strict Gelfand-Kazhdan descent}
\label{sec ss GK descent}

In Section \ref{sec formal}, we have seen that there is a dg Lie algebra $\DD \fgn^S$ 
encoding the $\beta\gamma$ system with target the formal disk $\hD^n$, 
and we have seen that this dg Lie algebra has a natural action of $\GL_n$ and has a natural $\L8$-action of $\Vect$. 
We might hope that the curved $\beta\gamma$ system with target a complex $n$-manifold $X$ could be obtained 
by applying Gelfand-Kazhdan descent to this dg Lie algebra.
This hope is not misplaced, as we'll see, 
but it requires generalizing the formalism of Harish-Chandra descent to allow for $\L8$-actions of the Lie algebra.

In this section we develop this formalism along the lines of our treatment of descent in Part I,
but we develop the minimum necessary to realize our primary goal and hence leave untreated many interesting questions
(such as allowing Harish-Chandra pairs in which the Lie algebra is replaced by an $\L8$ algebra).
Nonetheless, our techniques should apply to a broad collection of situations, 
notably to constructing the perturbative part of a nonlinear $\sigma$-model using BV quantization.
Indeed, much of what we do is a re-articulation of the methods of Kontsevich, Cattaneo-Felder, and many others, 
that is compatible with the machinery of \cite{CG1, CG2}.
We finish by explaining how our methods recover Costello's approach to the curved $\beta\gamma$ system in \cite{WG2}.
(His use of $\L8$-spaces, however, allows for more exotic targets than just complex manifolds, though.)

\begin{rmk}
As our particular examples are explicit, we are able to get away with 
a modest and quite limited generalization of Gelfand-Kazhdan descent for derived objects.
There should be a full-fledged derived version. 
(Parts of \cite{CPTVV} can be seen as a giant step in that direction.)
\end{rmk}

\subsection{Semi-strict modules}

We continue to work with Harish-Chandra pairs $(\fg,K)$, as in Part 1,
so $\fg$ is a Lie algebra and $K$ is a Lie group 
along with an action $\rho$ of $K$ on $\fg$ and an inclusion of Lie algebras $i: \Lie(K) \hookrightarrow \fg$
so that the Lie algebra action determined by $i$ agrees with the differential of the group action $\rho$.

\begin{dfn} 
\label{dfn ss HC mod}
A {\em semi-strict Harish-Chandra module} for the pair $(\fg,K)$ is a dg vector space $(V,\d_V)$ equipped with
\begin{itemize}
\item[(i)] a strict group action $\rho^K_V$ of $K$, meaning a group map 
\ben
\rho^K_{V^d} : K \to \GL(V^d)
\een 
for each degree $d$ such that the product map $\prod_d \rho^K_{V^d}: K \to \prod_d \GL(V^d)$ commutes with the differential~$\d_V$;
\item[(ii)] an $L_\infty$-action of $\fg$ on $V$, i.e., a map of $L_\infty$-algebras $\rho^\fg_V : \fg \l8to \End(V)$,
such that the composite 
$$\cliels(\rho^\fg_V) \circ \cliel_*(i): \cliels(\Lie(K)) \to \cliels(\End(V))$$
equals the map 
$$\cliel_*(D\rho^K_V): \cliels(\Lie(K)) \to \cliels(\End(V)).$$ 
\end{itemize}
Here $D \rho^K_V : \Lie(K) \to \End(V)$ is the differential of the strict $K$-action and $i: \Lie(K) \to \fg$ is part of the data of the Harish-Chandra pair $(\fg,K)$.
\end{dfn}

We call this \emph{semi-strict} because we allow an $\L8$-action of $\fg$,
but our other conditions are quite strict.
This definition, while {\it ad hoc}, is nonetheless well-suited to our situation.

\begin{dfn}
A {\em map of semi-strict Harish-Chandra modules} 
\[
f: (V,\rho^K_V,\rho^\fg_V) \to (W,\rho^K_W,\rho^\fg_W)
\]
consists of
\begin{itemize}
\item[(i)] a cochain map $f^K: V \to W$ that (strictly) intertwines the $K$-actions and
\item[(ii)] a map of $\cliel_*(\fg)$-comodules
\[
f^\fg: \cliel_*(\fg,V) \to \cliel_*(\fg,W),
\]
such that the composites
\[
\cliels(D\rho^K_W) \circ \cliels(f^K): \cliels(\Lie(K),V) \to \cliel_*(\fg,W)
\]
and
\[
f^\fg \circ \cliels(D\rho^K_V): \cliels(\Lie(K),V) \to \cliel_*(\fg,W)
\]
are identical.
\end{itemize}
\end{dfn}

\subsection{Semi-strict descent}

Fix a $(\fg,K)$-bundle $P$ with flat connection, 
so that there is a Maurer-Cartan element $\omega$ in the dg Lie algebra $\Omega^*(P) \otimes \fg$. 
Equivalently, there is a map of commutative dg algebras
\[
\omega^*: \clies(\fg) \to \Omega^*(P)
\]
determined by extending to an algebra map, 
the map $\omega^*: \fg^\vee[-1] \to \Omega^*(P)$ on generators encoded by~$\omega$.

Let $V$ be a semi-strict module for the pair $(\fg,K)$. 
Hence there is a map of commutative dg algebras
\[
\rho^{\fg*}_V: \clies(\End(V)) \to \clies(\fg),
\]
which is the linear dual of the coalgebra map $\rho^\fg_V: \fg \l8to \End(V)$. 
By composing, we obtain a map of commutative dg algebras
\[
\rho^{\fg*}_V \circ \omega^*: \clies(\End (V)) \to \Omega^*(P),
\]
which then corresponds to a Maurer-Cartan element 
\[
\omega_V \in \Omega^*(P) \otimes \End (V).
\]
The operator
\ben
\nabla^{P,V} := \d_{dR} + \omega_V
\een
then defines a flat ``super-connection'' on the trivial bundle $P \times V \to P$ over $P$.
(Here ``super'' simply means that some terms of $\omega_V$ may contain higher forms, and not just one-forms.)

The following results straightforwardly from the definitions.

\begin{lemma} 
The operator $\nabla^{P,V}$ has the following properties:
\begin{itemize}
\item[(1)] It preserves the sub-algebra of basic forms. 
\item[(2)] If $f \in \cO(X) \cong \cO(P)^K$ and $\alpha \in  (\Omega^k(P) \otimes V)_{bas} \cong \Omega^k(X; V_X)$,
then
\ben
\nabla^{P,V}(f \cdot \alpha) = (\d_{dR} f) \otimes \alpha + f \otimes \nabla^V \alpha .
\een
\item[(3)] It is square-zero. 
\end{itemize}
\end{lemma}

Using this lemma, we define the cochain complex
\be\label{ddesc}
\ddesc((P\to X, \omega), V) := \left( (\Omega^*(P) \otimes V)_{bas}, \nabla^{P,V}\right) .
\ee
It is a dg module over the commutative dg algebra $\Omega^*(X)$. 

\begin{dfn}
The \emph{semi-strict descent functor}
\ben
\ddesc : \Loc_{(\fg,K)}^{\rm op} \times \Mod^{fin}_{(\fg,K)} \to
\Mod_{\Omega^*(X)} 
\een 
is given by the construction just described.
\end{dfn}

Note that if $V$ is strict HC-module, then (\ref{ddesc}) is just the de Rham complex of the flat vector bundle 
$\desc((P \to X,\omega), V) = (V_X, \nabla^{P,V})$ from Definition~\ref{def desc}.

\emph{Semi-strict Gelfand-Kazhdan descent} is simply semi-strict Harish-Chandra descent
applied to the pairs $(\Vect,\GL_n)$ or $(\TVect, \GL_n)$  along $X^{coor}$ or $\Tilde{X}^{coor}_\alpha$, respectively. 
Everything is parallel to what we did in Part~1. In particular, it is lax monoidal, via the argument from Lemma \ref{prop lax}.

We now note an important relationship between strict and semi-strict descent,
which follows from a standard fact about $\L8$-representations:
given an ordinary  Lie algebra $\fg$ (i.e., concentrated in degree zero) and an $\L8$ representation $V$ of $\fg$,
the cohomology $H^*(V)$ is a strict representation of $\fg$.
Hence we observe the following.

\begin{lemma}
\label{lem strict vs semistrict}
If $(V, \rho^K_V, \rho^\fg_V)$ is a semi-strict module for the pair $(\fg,K)$,
then $H^*(V)$ naturally becomes a strict module for $(\fg,K)$ with
$\rho^K_{H^*(V)}$ the induced action of $K$ on $H^*(V)$ (since it respects the differential on $V$)
and $\rho^\fg_{H^*(V)}$ the induced strict action of $\fg$ on $H^*(V)$.
\end{lemma}

\subsection{Descent of the equivariant observables}

We record the following immediate consequences of our work in Section
\ref{sec equiv obs}.

\begin{prop}
For each open $U \subset \CC$,
\begin{enumerate}
\item the classical observables $\Obs^\cl_n(U)$ is a strict module over $(\Vect,\GL_n)$, and
\item the quantum observables $\Obs^\q_n(U)$ is a semi-strict module over $(\TVect,\GL_n)$.
\end{enumerate}
The structure maps of $\Obs^\cl_n$ are strictly equivariant map for $(\Vect,\GL_n)$, 
i.e., maps of strict $(\Vect,\GL_n)$-modules.
The structure maps of $\Obs^\q_n$ are maps of semi-strict $(\TVect,\GL_n)$-modules.
\end{prop}

These assertions follow by reinterpreting, via Koszul duality, 
our descriptions of the equivariant observables as dg modules 
over $\clies(\Vect)$ (in the classical case) or $\clies(\TVect)$ (in the quantum case).

We can thus apply semi-strict Gelfand-Kazhdan descent and obtain the following result.
Note that we are working in the category of dg modules over the commutative dg algebra $\Omega^*(X)$ 
in the category of differentiable vector spaces discussed in Section~\ref{sec functional analysis}.

%\owen{We {\em should} insert a discussion here about all the factorization gluing conditions,  
%if we wanted to really spell everything out.
%But I think it's quite formal and I'm not inclined to do it (unless compelled by a ref%eree or another reader, or my conscience).}

\begin{cor}
The strict Gelfand-Kazhdan descent of $\Obs^\cl_n$ on an $n$-dimensional complex manifold $X$ 
is a commutative factorization algebra in dg modules over $\Omega^*(X)$.
It depends on a choice of Gelfand-Kazhdan structure $(\Fr\, X, \sigma)$,
but every choice produces a naturally isomorphic factorization algebra.

If the $n$-dimensional complex manifold $X$ has vanishing $\ch_2(T_X)
\in H^2(X, \Omega^{2,hol}_{cl})$, then each extended Gelfand-Kazhdan structure $(X, \alpha, \sigma,
\sigma_{\Omega^2})$ where $\alpha$ is a choice of trivialization of
$\ch_2(T_X)$ and $\sigma,\sigma_{\Omega^2}$ are the auxiliary sections
needed to define descent (whose choices do not change the descent object up to homotopy)
the semi-strict Gelfand-Kazhdan descent of $\Obs^\q_n$ is a factorization algebra in dg modules over $\Omega^*(X)$.
\end{cor}

\begin{dfn}
For $X$ a complex $n$-manifold, let $\Obs^\cl_X$ denote the commutative factorization algebra on $\CC$ 
produced by strict Gelfand-Kazhdan descent of $\Obs^\cl_n$.

For $X$ a complex $n$-manifold and $\alpha \in \Omega^2_{cl}(X)$ a trivialization of $\ch_2(T_X)$,
let $\Obs^\q_{X,\alpha}$ denote the factorization algebra on $\CC$
produced by semi-strict Gelfand-Kazhdan descent of $\Obs^\q_n$.
\end{dfn}

By Lemma \ref{lem strict vs semistrict} we know that for each open $U \subset \CC$,
\begin{enumerate}
\item the cohomological classical observables $H^* \Obs^\cl_n(U)$ is a strict module over $(\Vect,\GL_n)$, and
\item the cohomological quantum observables $H^*\Obs^\q_n(U)$ is a strict module over $(\TVect,\GL_n)$.
\end{enumerate}
Moreover, the structure maps of $H^*\Obs^\cl_n$ are strictly equivariant map for $(\Vect,\GL_n)$, 
i.e., maps of strict $(\Vect,\GL_n)$-modules.
Likewise, the structure maps of $H^*\Obs^\q_n$ are maps of strict $(\TVect,\GL_n)$-modules.
Thus we can also apply strict Gelfand-Kazhdan descent to the cohomology of observables.

\begin{cor}
The strict Gelfand-Kazhdan descent of $H^*\Obs^\cl_n$ on an $n$-dimensional complex manifold $X$ 
is a commutative factorization algebra.
It depends on a choice of Gelfand-Kazhdan structure $(\Fr\, X, \sigma)$,
but every choice produces a naturally isomorphic factorization algebra.

If the $n$-dimensional complex manifold $X$ has vanishing $\ch_2(T_X) \in H^2(X, \Omega^{2,hol}_{cl})$,
then for each choice of trivialization $\alpha$ of $\ch_2(T_X)$ and each extended Gelfand-Kazhdan structure
the strict Gelfand-Kazhdan descent of $H^*\Obs^\q_n$ is a factorization algebra.
\end{cor}

In Section \ref{sec concrete} below, we provide a description of these
factorization algebras that is humanly understandable,
but first we will swiftly relate our work to Costello's approach in \cite{WG2}.

%\subsubsection{Semi-strict to strict}
%
%\owen{I've copied what was in Part III. It seems that above I merely assert that everything works.
%It should be a formal consequence of Lemma 12. But edit as you see fit.}
%
%Recall, the scale $L$ quantum observables on an open $U$ are
%\ben
%\eqObs^q_n (U) [L] = \left(\cO(\TVect [1] \oplus \DD \fg_n^U [1])[ \hbar ] , \d_{\TVect} + \dbar + \{\Tilde{I}^{\rm W}[L] + \hbar J[L], -\}\right) .
%\een
%We identify the scale $L$ equivariant observables above with the $\clie^*(\TVect)$-module 
%\ben
%\clie^*(\TVect ; \Obs^q_n[L])
%\een
%from which $\Obs^q_n[L]$ inherits the structure of an
%$L_\infty$ module for the Lie algebra $\TVect$. The $L_\infty$ module
%structure maps have the form
%\ben
%\rho_m : (\TVect)^{\tensor m} \tensor \Obs^q_n[L] \to \Obs^q_n[L] .
%\een
%The action of a fixed element
%\ben
%(\vec{X} , \vec{\omega}) := (X_1 \tensor \cdots X_{m_1},
%\omega_1\tensor \cdots \tensor \omega_{m_2}) \in \TVect^{\tensor m}
%\;\; , m_1 + m_2 = m ,
%\een
%is explicit to describe. For a fixed observable $\{O[L]\}$ the
%observable
%\ben
%\rho(\vec{X},\vec{\omega}) (\{O[L]\})
%\een
%is defined by
%\ben
%\{I^{\rm W} [L](\vec{X}) + \hbar J[L] (\vec{\omega}), O[L]\}_L .
%\een 
%
%At the level of cohomology, the action of $\TVect$ on the observables
%is strict. Hence, the induced action on the vertex algebra
%$\Vert(\Obs^q_n)$ is strict. Thus, we need only compute the linear piece of the action $\rho_1 : \TVect \tensor \Obs^q_n[L] \to \Obs^q_n[L]$ and there are no contributions from the higher brackets at the level of cohomology. Explicitly, for an observable $\{O[L]\}$ we need only compute
%\ben
%\{I_X^{\rm W}[L] + \hbar J_\omega[L], O[L]\}_L
%\een 
%for $(X, \omega) \in \TVect$. \brian{It might be good to explain the notation $I_X^{\rm W}[L]$ and $J_\omega[L]$.} 
%
%Let $\Bar{O} \in \bObs^q_n$ and consider the tree level RG flow $O[L] :=
%W(P_{0<L}, \Bar{O})$. Since $I_X^{\rm W}+ \hbar J_\omega$ is a local functional we see that to compute the scale $L$
%bracket $\{I_X^{\rm W}[L], O[L]\}_L$ it suffices to compute $\{I^{\rm
%  W}_X + \hbar J_\omega, \Bar{O}\}$ since 
%\ben
%\{W(P_{0<L}, I), O[L]\}_L = W(P_{0<L}, \{I, \Bar{O}\})
%\een 
%for any local functional $I$. 
%
%Thus, we can describe the action of $\TVect$ on $\Vert(\Obs^q_n)$ concretely as
%follows. Given an element $a \in \Vert(\Obs^q_n)$ pick a cochain representative
%$\Tilde{a}$ in $\bObs^q(D(0,r))$. Then, the action of $(X,\omega) \in
%\TVect$ on $a$ is given by the cohomology class of 
%\ben
%\{I^{\rm W}_X + \hbar J_\omega, \Tilde{a}\}
%\een 
%which is an element of $\Vert(\Obs_n) \subset H^*(\Obs^q(D(0,r)))$. 
%
%

\subsection{Comparison with Costello's work} \label{sec comparison}

In \cite{WG2} Costello provided a BV quantization of the curved $\beta\gamma$ system with target a complex manifold $X$,
and it was clear that the associated factorization algebra ought to be chiral differential operators,
based on the work in \cite{WittenCDO,Nek}. 
Our work grew out of attempts to verify that expectation.
Here we explain how Gelfand-Kazhdan descent recovers the $\L8$ spaces that Costello uses
and why descent of our equivariant quantization recovers the relevant cases of Costello's quantizations.
These results are independent of the rest of the text, and hence the disinterested reader should skip this section.

Our construction starts by encoding the formal $n$-disk as an $L_\infty$ algebra $\fgn$
and the formal $\beta\gamma$ system as $\DD\fgn^S$.
Costello's approach is to write down a global analogue:
for each complex manifold $X$, he constructs
a curved $L_\infty$ algebra $\fg_X$ in dg modules over the de Rham complex $\Omega^*(X)$.
His version of the classical curved $\beta\gamma$ system is encoded in $\DD\fg_X^S$,
whose Maurer-Cartan equation recover the equations of motion.
(More precisely, this Maurer-Cartan equations describes formal deformations of constant maps to holomorphic maps.)
The factorization algebra of classical observables assigns to an open set $U \subset \CC$,
the cochain complex~$\clies(\DD\fg_X^U)$.
The quantum observables are a deformation thereof.

Let us explain his construction of $\fg_X$.
Consider the $\infty$-jet bundle $J^{hol}_X$ for holomorphic functions,
which has a canonical flat connection.
The sheaf of horizontal sections for this flat connection is exactly the sheaf $\cO_X$ of holomorphic functions on $X$.
In fact, the de Rham complex of $J^{hol}_X$ is quasi-isomorphic to $\cO_X$, 
where the quasi-isomorphism sends a holomorphic function to its $\infty$-jet.
By definition, $\fg_X$ is the curved $\L8$ algebra encoded under Koszul duality by the commutative dg algebra
\[
\clies(\fg_X) = \Omega^*(X, \cSym(T^{1,0*}_X)) \cong \Omega^*(X, J_X^{hol}).
\]
(Everything here is in modules over $\Omega^*(X)$.)
The differential on the left hand side is pulled back along an isomorphism of pro-vector bundles 
$\sigma: \cSym(T^{1,0*}_X) \xto{\cong} J^{hol}_X$.
This isomorphism $\sigma$ is constructed by fixing a connection on the tangent bundle $T_X$
and using its associated exponential map at each point $x$ 
to identify the formal neighborhood of $x$ in $X$ with the formal neighborhood of the origin in $T_x X$.
In this way, the $\infty$-jet of a function at $x$ is identified with a formal power series in $T_x^* X$,
which is the desired isomorphism $\sigma$.

But this procedure is precisely how Gelfand-Kazhdan descent works! 
Once we fix a formal exponential on the frame bundle of $X$ --- typically via a choice of connection --- we have an isomorphism $\sigma$.
Moreover, the descent of $\clies(\fgn)$ using this data is exactly $\Omega^*(X, \cSym(T^{1,0*}_X))$
equipped with the pullback of the Grothendieck connection along $\sigma$.
In other words, Gelfand-Kazhdan descent recovers Costello's curved $\L8$ algebra,
once one applies the Koszul duality.

A parallel argument applies to $\DD\fg_X^S$.
After fixing the isomorphism $\sigma$, Gelfand-Kazhdan descent of $\DD\fgn^S$ 
produces $\clies(\DD\fg_X^S)$ on the nose.
Hence, under Koszul duality, we recover Costello's classical BV theory 
as encoded in the curved $\L8$ algebra~$\DD\fg_X^S$.

A careful reading of \cite{WG2} will show that his Feynman diagrammatic work is the global version of ours: 
our analysis of the obstructions to quantization and constructions of quantizations given a trivialized obstruction
is directly parallel and descends to his.

Our discussion can be summarized as follows.

\begin{prop}
Under Gelfand-Kazhdan descent on a complex manifold $X$, 
the formal $\beta\gamma$ system recovers the classical BV theory associated to $X$ in \cite{WG2}.
Moreover, the obstruction-deformation complex descends to that in \cite{WG2},
so that the obstruction to BV quantization recovers the obstruction identified in \cite{WG2}.
Finally, given a trivialization of this obstruction, descent recovers the quantized action functional in \cite{WG2}.
\end{prop}

The primary corollary of this is that the factorization algebra associated to Costello's quantization of the curved $\beta\gamma$ system with target $X$ is isomorphic to the factorization algebra $\Obs^\q_{X,\alpha}$ we have constructed via semi-strict Gelfand-Kazhdan descent of the formal $\beta\gamma$ system with target $\hD^n$. 

Moreover, we recover the Witten class as originally obtained by Costello. That
is, we have already identified the equivariant scale $\infty$ interaction
$\Tilde{I}^{\rm W}[\infty]$ on an elliptic curve $E$ with the Witten genus
\ben
p^* \log \Wit_n (E, \omega) \in \clie^*(\TVect , \GL_n ; \hOmega^{-*}_n) .
\een 
Consider the characteristic map defined by extended Gelfand-Kazhdan
descent determined by a trivialization $\alpha$ of the second Chern
character of $X$. It is given by
\ben
\Tilde{\ch}_\alpha : H_{\rm Lie}^*(\TVect ,\GL_n ; \hOmega^{-*}_n) \to
H^*(X ; \Omega^{-*}_X) .
\een
The image of $p^* \Wit_n(E, \omega)$ under this map is the logarithmic
Witten genus of the complex manifold~$X$ 
\ben
\log \Wit(X,E, \omega) = \sum_{k \geq 2} \frac{(2k-1)!}{(2 \pi i)^{2k}}
E_{2k}(E, \omega) \ch_{2k}(T_X) ,
\een 
described using a holomorphic volume element on the elliptic curve~$E$.

\section{A concrete description of the observables}
\label{sec concrete}

In this Section we examine the factorization algebras $\Obs^\cl_X$ and $\Obs^\q_{X,\alpha}$ 
produced by descent of the equivariant observables for the formal $\beta\gamma$ system.
Our goal is to extract information from them that is easy to interpret,
particularly from the physical point of view.
For instance, we will give an explicit description of observables with support at a point in the source $\CC$ --- and hence also for observables supported at finitely many points --- which is a bridge to Part III, where we show that the cohomological factorization algebras
$H^*\Obs^\cl_X$ and $H^*\Obs^\q_{X,\alpha}$ recover the vertex algebras $\Gr\CDO_X$ and $\CDO_{X,\alpha}$, respectively.
In short, we show that these point observables admit explicit expressions in terms of natural geometric objects on the target manifold, 
notably tensor bundles.

Throughout we use the tensor product and symmetric powers described in
Section~\ref{sec functional analysis}.


\subsection{Polynomials, power series, and the $(\Vect,\GL_n)$-decomposition of observables}

We will provide a characterization of the formal tensor fields 
that constitute the observables for the formal $\beta\gamma$ system.
We will use this characterization in the next section
for the non-formal observables.

Before talking about the full algebras of observables, 
it is useful to understand the space of linear observables,
which are simply the dual space to the fields.
It will help to bear in mind some simple facts about smooth functions.

For any disk $D_r(0) \subset \CC$ centered at the origin, 
there is a natural linear map
\[
j: C^\infty(D_r(0)) \to \CC[[z,\zbar]]
\]
sending a function $f$ to its Taylor series $j(f)$ at the origin.
(We use the coordinates $z$ and $\zbar$ since we will eventually focus on holomorphic functions.)
Borel's lemma tells us this map is surjective.
There is also an inclusion
\[
\CC[z,\zbar] \hookrightarrow C^\infty(D_r(0))
\]
obtained by viewing a polynomial as a function on the disk,
and the composite with $j$ is the inclusion of polynomials into power series.

The $\dbar$ operator makes sense on both polynomials and power series.
Let $\Omega^{0,*}_{poly}$ denote the cochain complex
\[
\CC[z,\zbar] \xto{\dbar} \CC[z,\zbar]\d\zbar
\]
and let $\Omega^{0,*}_{pow}$ denote the version with power series.
We have the following relationship.

\begin{lemma}
There is a commuting diagram
\[
\begin{tikzcd}
\CC[z] \ar[hook]{r} \ar[hook]{d}{\simeq} & \cO(D_r(0)) \ar[hook]{r} \ar[hook]{d}{\simeq} & \CC[[z]] \ar[hook]{d}{\simeq} \\
\Omega^{0,*}_{poly} \ar[hook]{r} & \Omega^{0,*}(D_r(0)) \ar[two heads]{r}{j} & \Omega^{0,*}_{pow}
\end{tikzcd}
\]
where the vertical maps are the inclusion of the cohomology, which is concentrated in degree zero.
\end{lemma}

Note that at the level of fields --- rather, in terms of the dg Lie algebras encoding the formal $\beta\gamma$ system --- this result tells us that we have
\[
\begin{tikzcd}
\fgn[z] \oplus (\fgn^\vee[z]\d z)[-2] \ar[hook]{r} \ar[hook]{d}{\simeq} & \fgn \otimes \cO(D_r(0)) \oplus (\fgn^\vee \otimes \Omega^{1,hol}(D_r(0)))[-2]  \ar[hook]{r} \ar[hook]{d}{\simeq} & \fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2] \ar[hook]{d}{\simeq} \\
\DD\fgn^{poly} \ar[hook]{r} & \DD\fgn^{D_r(0)} \ar[two heads]{r}{j} & \DD\fgn^{pow}
\end{tikzcd}
\]
where, for example, $\DD\fgn^{poly}$ means the dg Lie algebra 
\[
\Omega^{0,*}_{poly} \otimes \fgn \oplus \Omega^{1,*}_{poly} \otimes \fgn^\vee[-2].
\]
This relationship is convenient for analyzing observables.

\begin{lemma}
The classical observables $\Obs^\cl_n(D_r(0))$ sit inside the commuting diagram
\[
\begin{tikzcd}
\clies(\DD\fgn^{pow}) \ar{r} \ar{d} & \Obs^\cl_n(D_r(0)) \ar{r} \ar{d} & \clies(\DD\fgn^{poly}) \ar{d}\\
\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2]) \ar[hook]{r} & H^* \Obs^\cl_n(D_r(0))  \ar[hook]{r} & \clies(\fgn[z] \oplus (\fgn^\vee[z]\d z)[-2])
\end{tikzcd}
\]
by applying the functor $\clies$.
\end{lemma}

These maps naturally intertwine the Harish-Chandra action of $(\Vect,\GL_n)$, 
so that we obtain an analogous commuting diagram after Gelfand-Kazhdan descent.
One must verify that the vertical maps are quasi-isomorphisms, 
which we do below in Proposition \ref{cohomology of point obs}.
But first let us analyze in more detail which $(\Vect,\GL_n)$-representations appear in the observables.

Consider the case of $\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2])$,
since it sits inside all the other examples.
Recall that $\clies(\fgn) \cong \hO_n = \CC[[t_1,\ldots,t_n]]$.
The Lie algebra $\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2]$ can be viewed 
as an extension of $\fgn \simeq \fgn \cdot z^0$ by the representation 
\[
M = \fgn[[z]]z \oplus (\fgn^\vee[[z]]\d z)[-2],
\]
and hence
\[
\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2]) \cong \clies(\fgn, \cSym(M^\vee[-1])).
\]
We now show that this vector space (as it all sits in degree zero) is a direct product of tensor fields.

Some notation will simplify the discussion. 
The appropriate linear dual of $\CC[[z]]$ is the direct sum $\bigoplus_{k \geq 0 } \CC \, \zeta_k$,
where $\zeta_k$ is the dual element to $z^k$.
Let $\zeta_k \d z^\vee$ denote the dual to $z^k\d z$.
Then
\[
M^\vee[-1] = \bigoplus_{0<k} (\fgn^\vee \otimes \zeta_k)[-1] \oplus \bigoplus_{0\leq l} (\fgn \otimes \zeta_l \d z^\vee)[1].
\]
More succinctly, we have
\[
M^\vee[-1] \cong \bigoplus_{0<k} \fg^\vee[-1] \oplus \bigoplus_{0\leq l} \fgn[1].
\]
Let $\widehat{\otimes}$ denotes the completed tensor product, 
so that $\cSym(V \oplus W) \simeq \cSym(V)
\,\widehat{\otimes}\,\cSym(W)$ for any pair of vector
spaces. 

% \brian{I think this is the first place where we use the
%   notation $\widehat{\tensor}$ for completed tensor product. Does it
%   warrant a brief digression? Or maybe it should go in the functional
%   analysis warmup in the beginning of this section (main file).} 
%   \owen{I'm not sure we ever use it again (although we probably
%   should), so I'm happy not to define it earlier, which is really
%   about other kinds of functional analysis issues.}

Then 
\begin{align*}
\cSym(M^\vee[-1]) 
& \cong \underset{{0<k}}{\widehat{\bigotimes}}\,\cSym(\fgn^\vee[-1]) \,\widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym(\fgn[1]) \\
&= \underset{K,L \to \infty}{\text{colim}} \underset{{0<k<K}}{\widehat{\bigotimes}}\,\cSym(\fgn^\vee[-1]) \,\widehat{\otimes}\, \underset{{0\leq l<L}}{\widehat{\bigotimes}}\,\cSym(\fgn[1]).
\end{align*}
where the $(k,l)$th tensor term is associated to $\zeta_k$ and $\zeta_l \d z^\vee$.
(Recall that in the infinite tensor product of unital algebras, 
a term $a_1 \otimes a_2 \otimes \cdots$ has $a_j =1$ for all but finitely many $j$.)
In summary we have the following.

\begin{lemma}
As a $(\Vect,\GL_n)$-modules, the commutative algebra $\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2])$ 
decomposes as the infinite tensor product of formal tensor fields,
\[
\underset{{0<k}}{\widehat{\bigotimes}}\,\cSym(\hT^*_n)\, \widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym(\hT_n),
\]
where $\hT_n$ denotes the formal vector fields viewed as an adjoint representation of $\Vect$ and 
$\hT^*_n$ denotes the formal one-forms viewed as the coadjoint representation.
\end{lemma}

Since Gelfand-Kazhdan descent is monoidal, we obtain a useful corollary.

\begin{cor}
\label{lem g[[z]]}
For $X$ a complex $n$-manifold, the Gelfand-Kazhdan descent of $\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2])$
is isomorphic to the $\cO_X$-module
\[
\underset{{0<k}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT^*_X)\, \widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT_X),
\]
where $\cT_X$ denotes the sheaf of holomorphic vector fields and $\cT^*_X$ denotes the sheaf of holomorphic one-forms.
\end{cor}

Analogous results can be formulated for the polynomial situation 
and also for $\clies(\DD\fgn^{pow})$ and $\clies(\DD\fgn^{poly})$,
which now involve powers of $\zbar$ and $\d \zbar^\vee$ as well.
By the same reasoning as we just use, we find the following.
(Observe that due to having monomials of the form $z^k \zbar^{k'}$,
the indexing now is doubled.)

\begin{lemma}
For the Lie algebra $\fgn[[z,\zbar]] \oplus \fgn^\vee[[z,\zbar]][-2]$,
the commutative algebra $\clies(\fgn[[z,\zbar]] \oplus \fgn^\vee[[z,\zbar]][-2])$ decomposes as a $(\Vect,\GL_n)$-module
into
\[
\underset{{(k,k') \in \NN^2 \{(0,0)\}}}{\widehat{\bigotimes}}\,\cSym(\hT_n^*)\, \widehat{\otimes}\, \underset{{(l,l') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n),
\]
where $(k,k')$ indexes $z^k \zbar^{k'}$ and likewise for $(l,l')$.
\end{lemma}

A little more work provides us with this result.

\begin{lemma}
\label{lem DDfgn^pow}
The underlying graded vector space of commutative algebra $\clies(\DD\fgn^{pow})$ decomposes as a $(\Vect,\GL_n)$-module into
\[
\underset{{(k,k') \in \NN^2 \{(0,0)\}}}{\widehat{\bigotimes}}\,\cSym(\hT_n^*)\, \widehat{\otimes}\,
\underset{{(l,l') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n) \, \widehat{\otimes}\, 
\underset{{(m,m') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n^*[1])\, \widehat{\otimes}\, 
\underset{{(n,n') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n[1]),
\]
where $(k,k')$ indexes $z^k \zbar^{k'}$ and likewise for the other double indices.
\end{lemma}


\begin{proof}
The decomposition of the underlying graded $(\Vect,\GL_n)$-module of $\clies(\DD\fgn^{pow})$ 
is also straightforward, given our work above, but it involves some bookkeeping.
The underlying graded vector space of $\DD\fgn^{pow}$ is
\[
\begin{array}{ccc}
\text{degree:} & \underline{1} & \underline{2} \\
\text{vector space:} & \fgn[[z,\zbar]] \oplus \fgn^\vee[[z,\zbar]][-2] & (\fgn[[z,\zbar]] \oplus \fgn^\vee[[z,\zbar]][-2]) \otimes \d\zbar
\end{array}
\]
Thus, $\clies(\DD\fgn^{pow})$ is concentrated in nonpositive degrees, 
and the preceding lemma gives us the degree zero component,
which we denote $\cA$.
The new contribution $\cB$ comes from the degree two component of $\DD\fgn^{pow}$.
It generates an algebra by linear dual of this component placed in degree~-1:
\[
\cB := \cSym\left( ((\fgn[[z,\zbar]] \oplus \fgn^\vee[[z,\zbar]][-2]) \otimes \d\zbar)^\vee[1] \right).
\]
We  have
\[
\clies(\DD\fgn^{pow})^\sharp \cong \cA \otimes \cB
\]
as graded algebras.
We thus need to have a succinct way to describe the algebra~$\cB$.

Let $\zeta_{m,n} \d \zbar^\vee$ denote the dual element to $z^m \zbar^n \d\zbar$.
Then 
\begin{align*}
\cB &= \cSym \left( \bigoplus_{(k,k') \in \NN^2} \fgn^\vee \, \zeta_{m,n} \d \zbar^\vee \oplus \bigoplus_{(l,l') \in \NN^2} \fgn[2] \, \zeta_{m,n} \d \zbar^\vee\right)\\
&= \underset{{(k,k') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n^*[1])\, \widehat{\otimes}\, \underset{{(l,l') \in \NN^2}}{\widehat{\bigotimes}}\,\cSym(\hT_n[1]).
\end{align*}
Hence we obtain the claim.
\end{proof}

\subsection{The classical observables supported at a point}

The observables $\clies(\DD\fgn^{pow})$ have a natural field-theoretic interpretation:
they are the observables supported at the origin in the source manifold $\CC$.
As we will explain below, these observables map to the observables $\Obs^\cl_n(U)$
supported on any open $U \subset \CC$ containing the origin,
and so they provide a rich source of easily-understood measurements.

Recall that the distributions (i.e., continuous linear functionals on smooth functions) 
supported at the origin in $\CC$ consist of finite linear combinations of the the delta function $\delta_0$ 
supported at the origin and its partial derivatives.
In other words, it consists of linear functionals that read off the Taylor coefficients of a smooth function.
We introduce the notation $\zeta_{m,n}$ for the distribution $\partial_z^m \partial_{\zbar}^n \delta_0$.
Hence, the smooth distributions with support at the origin are the vector space
\[
\mathcal{D}_0 := \bigoplus_{(m,n) \in \NN^2} \CC\, \zeta_{m,n} = (\CC[[z,\zbar]])^\vee.
\]
By our work above, we see that the linear dual of the power series Dolbeault complex $\Omega^{0,*}_{pow}$
is the cochain complex 
\[
\begin{array}{ccc}
\mathcal{D}_0 \,\d\zbar^\vee & \xto{\dbar^\vee} & \mathcal{D}_0 \\
\zeta_{m,n} \,\d\zbar^\vee & \mapsto & \zeta_{m,n+1}
\end{array},
\]
which is concentrated in degrees 0 and -1.
We denote it by $(\Omega^{0,*})^\vee_0$.
An analogous complex $(\Omega^{1,*})^\vee_0$ encodes 
the distributional dual of the Dolbeault complex of 1-forms with support at the origin.

\begin{rmk}
A nice feature of working with a holomorphic field theory, like the $\beta\gamma$ system,
is that using the linear observables supported at the origin,
one can fully identify any solution to the equations of motion.
This fact is the linear dual to the fact that $\cO(\CC) \hookrightarrow \CC[[z]]$,
i.e., every holomorphic function is determined by its power series expansion.
\end{rmk}

The linear observables --- supported at the origin --- of the rank $n$ formal $\beta\gamma$ system are then
\[
(\Omega^{0,*})^\vee_0 \otimes \fgn^\vee[-1] \oplus (\Omega^{1,*})^\vee_0 \otimes \fgn[1].
\]
For us, the algebra of classical observables is the completed symmetric algebra on these linear observables.
Let $(\Obs^\cl_n)_0$ denote the cochain complex of observables 
with support at the origin on the rank $n$ formal $\beta\gamma$ system.
Explicitly, we have
\[
(\Obs^\cl_n)_0 = \cSym((\Omega^{0,*})^\vee_0 \otimes \fgn^\vee[-1] \oplus (\Omega^{1,*})^\vee_0 \otimes \fgn[1]) 
\]
with the differential by extending as a derivation the differential on the linear generators.

We record an immediate consequence of the fact the distributions with compact support extend from smaller to larger open sets.

\begin{lemma}
For any open set $U \subset \CC$ containing the origin, there is a cochain map
\[
(\Obs^\cl_n)_0 \hookrightarrow \Obs^\cl_n(U)
\]
extending the inclusion of the distributions supported at the origin to the distributions with support in $U$.
\end{lemma}

This map is manifestly equivariant with respect to the $(\Vect,\GL_n)$ action and hence descends.

\begin{cor}
For any open set $U \subset \CC$ containing the origin, there is a map of dg $\Omega^*(X)$-modules
\[
(\Obs^\cl_X)_0 \hookrightarrow \Obs^\cl_X(U)
\]
extending the inclusion of the distributions supported at the origin to the distributions with support in $U$.
\end{cor}

\begin{rmk}
Formulating a version of this statement for the quantum observables would be more delicate,
as one must work with parametrices and RG flow.
As we are working with a free theory here, however, one can instead use the ``smoothed observables.''
See below for a discussion of quantum observables.
\end{rmk}

Note that the underlying graded vector space of $(\Obs^\cl_X)_0$ is
\[
\cSym_{\Omega^\sharp(X)}(\Omega^\sharp(X,(\Omega^{0,*})^\vee_0 \otimes T^*_X) \oplus \Omega^\sharp(X,(\Omega^{1,*})^\vee_0 \otimes T_X)) 
\]
as we are working over the base algebra $\Omega^*(X)$.
Equivalently, one can express it as the de Rham complex of a (gigantic!) dg vector bundle 
\[
\Omega^\sharp(X, \cSym((\Omega^{0,*})^\vee_0 \otimes T^*_X \oplus (\Omega^{1,*})^\vee_0 \otimes T_X)).
\]
The differential involves both $\dbar$ for the source manifold $\CC$ and a connection $\nabla$ along the target $X$.

We now turn to determining the cohomology of $(\Obs^\cl_X)_0$, 
which encodes the measurements one can make at the origin of $\CC$ 
of the fields $\gamma$ and $\beta$ with target $X$.

\begin{prop}\label{cohomology of point obs}
There is a natural isomorphism 
\[
H^*(\Obs^\cl_X)_0 \cong 
H^*\left(X,\underset{{0<k}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT^*_X)\, \widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT_X)\right),
\]
identifying the cohomological observables supported at the origin with $\clies(\fgn[[z]] \oplus (\fgn^\vee[[z]]\d z)[-2])$.
\end{prop}

\begin{proof}
Before embarking on a spectral sequence, we note that the arguments
for Lemma \ref{lem DDfgn^pow} tell us that we obtain an infinite (completed) tensor product
of tensor bundles from Gelfand-Kazhdan descent,
via the identification of $(\Obs^\cl_X)_0$ with $\clies(\DD\fgn^{pow})$,
so that we view $\DD\fgn^{pow}$ as the ``fields'' (more accurately, jets of fields at the origin).

The differential on $(\Obs^\cl_n)_0$ has the form $\nabla + \dbar$, 
where $\dbar$ denotes the extension of the differential on $(\Omega^{0,*})^\vee_0$ and $(\Omega^{1,*})^\vee_0$
and $\nabla$ denotes the connection along $X$ arising from Gelfand-Kazhdan descent.
As $\nabla$ is a connection, it increases the de Rham form degree in the $X$-direction, 
whereas $\dbar$ preserves this de Rham form degree in the $X$-direction, since it only cares about the $\CC$-direction.
Consider then the filtration on $(\Obs^\cl_n)_0$ induced by the filtration $\Omega^{\geq *}(X)$ on $\Omega^*(X)$.
The first page of the spectral sequence is the cohomology with respect to $\dbar$:
\[
\Omega^\sharp(X, \cSym(H^*(\Omega^{0,*})^\vee_0 \otimes T^*_X \oplus H^*(\Omega^{1,*})^\vee_0 \otimes T_X)).
\]
These groups $H^*(\Omega^{0,*})^\vee_0$ and $H^*(\Omega^{1,*})^\vee_0$
are concentrated in cohomological degree 0 and are spanned by the linear functionals $\{\zeta_{n,0}\}$, which give the holomorphic Taylor coefficients.
They do not vary along $X$, so
\[
H^*(\Omega^{0,*})^\vee_0 \otimes T^*_X \cong \bigoplus_{n \in \NN} T^*_X \quad \text{and} \quad H^*(\Omega^{1,*})^\vee_0 \otimes T_X \cong \bigoplus_{n \in \NN} T_X.
\]
The induced differential on the first page of the spectral sequence is the induced connection $\Tilde{\nabla}$ on the bundle
\[
\cSym(H^*(\Omega^{0,*})^\vee_0 \otimes T^*_X \oplus H^*(\Omega^{1,*})^\vee_0 \otimes T_X),
\]
so we need to unravel what this bundle means from the perspective of Gelfand-Kazhdan descent.
By Corollary \ref{lem g[[z]]} we know it is identified with the $\infty$-jet bundle 
\[
\underset{{0<k}}{\widehat{\bigotimes}}\,\cSym(T^{1,0*}_X)\, \widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym(T^{1,0}_X).
\]
(More precisely, it is the jet bundle encoding holomorphic sections.)
The induced connection is the many-fold tensor product of the Grothendieck connection under this identification.
This induced connection $\Tilde{\nabla}$ is the differential on the first page of the spectral sequence, which collapses on the second page.
Thus, we see that the second page is
\[
H^*\left(X,\underset{{0<k}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT^*_X)\, \widehat{\otimes}\, \underset{{0\leq l}}{\widehat{\bigotimes}}\,\cSym_{\cO_X}(\cT_X)\right),
\]
the cohomology of the $\cO$-module from Lemma \ref{lem g[[z]]}.
\end{proof}

\subsection{The decomposition by conformal dimension: the rotation action on the source}

The rotation action of $U(1)$ on $\CC$ --- or any disk $D_r(0)$ --- induces a rotation action on 
the fields of the curved $\beta\gamma$ system and on the observables $\Obs^\cl_X(D_r(0))$.
It is easy to identify the subspaces of given conformal dimension in light of our work above. 
In particular, we know that polynomials decompose according to conformal dimension as
\[
\CC[z,\zbar] = \bigoplus_{w \in \ZZ} \CC[z,\zbar]_w \quad\text{where}\quad \CC[z,\zbar]_w = \bigoplus_{m - n = w} \CC\, z^m \zbar^n,
\]
and so power series decompose as
\[
\CC[z,\zbar] = \prod_{w \in \ZZ} \CC[z,\zbar]_w.
\]
Polynomials are dense in smooth functions, so we see that $C^\infty(\CC)$ has the same subspaces,
albeit it is some completion of the direct sum of these subspaces.
These dimensional decompositions directly apply to the ``fields'' $\DD\fgn^{poly}$ and~$\DD\fgn^{pow}$.

As observables are symmetric algebras on the linear observables, 
the dimensional decomposition of the fields allows us to identify the observables' dimensional decomposition.
A thorough description is straightforward but involves substantial notation,
so we will state the result only for the cohomological observables $H^*(\Obs^\cl_X)_0$ 
supported at the origin, as this result is the only one we explicitly need.

\begin{lemma}
The conformal dimension $N$ component of $H^*(\Obs^\cl_X)_0$ is
\[
\bigoplus_{\substack{a,b \in \NN^\NN \text{ such that}\\ \sum_{0 < k} a_k k + \sum_{0 \leq l} b_l l = N}} \bigotimes_{0 <k } \Sym^{a_k}_{\cO_X}(\cT^*_X) \otimes \bigotimes_{0 \leq l } \Sym^{b_l}_{\cO_X}(\cT^*_X).
\]
\end{lemma}

\begin{proof}
For example, the conformal dimension of an element of the symmetric power $\Sym^a_{\cO_X}(\cT_X)$ associated to the monomial $z^k$ is $ak$.
Hence the direct sum consists of conformal dimension $N$ components, by summing all the relevant conformal dimensions.
In the other direction, note that an element of the infinite tensor product composing $H^*(\Obs^\cl_X)_0$ 
must be the identity for all but finitely many of the indices $k$ and $l$.
A term in this element must have a polynomial contribution from any given index, due to the bound of $N$ on the total conformal dimension.
\end{proof}

\subsection{The quantum observables}

The quantum observables exhibit the same behavior as the classical observables
with respect to the rotation action and the $(\TVect,\GL_n)$ action.
The arguments must be modified, however, to deal with the BV Laplacian, for example.
Instead of working with the observables supported at the origin, 
it is more convenient to work with the global observables $\Obs^\q_n(\CC)$ or~$\Obs^\q_X(\CC)$.

Let us begin by discussing~$\Obs^\q_n(\CC)$.
There are two versions, depending on whether one works with parametrices or the smoothed observables.
We restrict our attention to parametrices associated with the heat kernel, 
as these are manifestly invariant for the $U(1)$ and $(\TVect,\GL_n)$ actions:
\[
\Obs^\q_n(\CC)[L] = (\cSym(\Bar{\Omega}^{1,*}_c(\CC) \otimes \fgn^\vee[-1] \oplus \Bar{\Omega}^{0,*}_c(\CC) \otimes \fgn[1])[[\hbar]], \dbar + \hbar \Delta_L).
\]
The {\em smoothed observables} are
\[
{\Obs}^{\q,\fr}_n(\CC) = (\cSym(\Omega^{1,*}_c(\CC) \otimes \fgn^\vee[-1] \oplus \Omega^{0,*}_c(\CC) \otimes \fgn[1])[[\hbar]], \dbar + \hbar \Delta),
\]
so that we take the symmetric algebra on the smooth distributions,
such as $\Omega^{1,*}_c(\CC) \subset \Bar{\Omega}^{1,*}_c(\CC)$, inside all distributions. 
The naive BV Laplacian is well-defined on the smoothed observables. 
(See \cite{CG1} for a discussion.)
Ignoring the differentials momentarily, one sees that the same decompositions from above apply;
one can still use the monomials $z^m \zbar^n$ to organize one's
thinking.

The new term in the differential is a BV Laplacian, either $\Delta_L$ or $\Delta$.
Recall that these are built out of the evaluation pairing between $\fgn$ and $\fgn^\vee$
and the wedge-and-integrate pairing between $\Omega^{0,*}_c(\CC)$ and $\Omega^{1,*}_c(\CC)$.
(At scale $L$ the pairing on Dolbeault forms is modified by a mollifying function that is $U(1)$-invariant.)
Both pairings are equivariant for the actions by $U(1)$ and $(\TVect,\GL_n)$,
and we have constructed equivariant quantizations, 
so that BV Laplacians manifestly intertwine with these actions.
In particular, the dimensional decompositions are preserved by the differential.
 
Moreover, when one wants to focus on cohomology, one can exploit the $\hbar$-filtration 
\[
\Obs^\q_n \supset \hbar\, \Obs^\q_n \supset \hbar^2 \Obs^\q_n \supset \cdots
\]
to good effect. 
For instance, there is a spectral sequence associated to this filtration, 
and it collapses on the first page, since the cohomology with respect to $\dbar$ is concentrated in degree zero.
Hence, as vector spaces,
\[
H^* \Obs^\q_n(\CC) \cong H^* \Obs^\cl_n(\CC)[[\hbar]].
\]
By our discussion above, we see that we thus already know the decompositions
of $H^* \Obs^\q_n(\CC)$ with respect to the $U(1)$ or $(\TVect,\GL_n)$ actions.

\begin{prop}
The conformal dimension $N$ component of $H^*(\Obs^\q_n(\CC))$ is
\[
\CC[[\hbar]] \otimes \bigoplus_{\substack{a,b \in \NN^\NN \text{ such that}\\ \sum_{0 < k} a_k k + \sum_{0 \leq l} b_l l = N}} \bigotimes_{0 <k } \Sym^{a_k}(\hT_n^*) \otimes \bigotimes_{0 \leq l } \Sym^{b_l}(\hT_n).
\]
\end{prop}

We obtain an immediate corollary by Gelfand-Kazhdan descent.

\begin{cor}
The conformal dimension $N$ component of $H^*(\Obs^\q_X(\CC))$ is
\[
\CC[[\hbar]] \otimes \bigoplus_{\substack{a,b \in \NN^\NN \text{ such that}\\ \sum_{0 < k} a_k k + \sum_{0 \leq l} b_l l = N}} \bigotimes_{0 <k } \Sym^{a_k}_{\cO_X}(\cT^*_X) \otimes \bigotimes_{0 \leq l } \Sym^{b_l}_{\cO_X}(\cT_X).
\]
\end{cor}

\section{Conformal structure on observables}\label{sec conformal obs}

We have already discussed how a trivialization $\alpha$ of the second component of the Chern character of the complex manifold $X$ determines a sheaf of factorization algebras $\Obs^\q_{X,\alpha}$,
via semi-strict Gelfand-Kazhdan descent of the $\TVect$-equivariant factorization algebra $\Obs^\q_n$. 
Equivalently, in Section \ref{sec comparison}, we showed that this is the factorization algebra of quantum observables of the curved $\beta\gamma$ system with target~$X$ associated to the trivialization~$\alpha$. 

In Section \ref{sec hol vf} we showed how the Lie algebra of holomorphic vector fields on the source acts on the classical formal $\beta\gamma$ system. 
Indeed, we constructed a Maurer-Cartan element $I^\cT \in \cloc^*(\cT^S) \tensor \cloc^*(\DD \fg_n^S)$ implementing this symmetry. 
By Koszul duality, this element thus defines a map of Lie algebras 
\[
I^\cT: \cT^S = \Omega^{0,*}(S; T^{1,0}_S) \to \cloc^*(\DD \fg_n^S)[-1], 
\]
where the the BV bracket $\{-,-\}$ provides the Lie bracket on local functionals.
A local functional can be interpreted as an observable, at least when $S$ is compact,
and so our goal is to refine this map to a map of factorization algebras.

First, we need to replace $\cT^S$ by a local-to-global object.
Holomorphic vector fields on $S$ admit a natural enhancement to a {\em sheaf} of dg Lie algebras: to an open set $U \subset S$, we assign $\cT^U := \Omega^{0,*}(U, T^{1,0}U)$.
But a sheaf is contravariant in opens on $S$, whereas $\Obs^{\cl}_S$ is covariant in opens on $S$.
There is an easy fix: take holomorphic vector fields with {\em compact support}.
Let $\cT^S_c$ denote this precosheaf of dg Lie algebras, which is also a cosheaf of dg vector spaces. 
By Chapter 11 of \cite{CG2}, the map on global sections refines to a map of precosheaves 
\ben
\Psi^{\rm cl}_n : \cT^S_c \to \Obs^{\cl}_n [-1] 
\een
of dg Lie algebras on $S$.
Since $\cT^S_c$ is a trivial $\Vect$-module, we see that applying Gelfand-Kazhdan descent yields a map of sheaves on~$X$
\[
\Psi^{\cl}_X : {\ul \cT^S_c} \to \Obs^{cl}_X[-1]
\]
of precosheaves of dg Lie algebras on $S$, where $\Obs^{\cl}_X$ is the classical observables of the curved $\beta\gamma$ system with target $X$. The underline means that it is a constant sheaf in the $X$-direction. 

This map $\Psi^{\cl}_X$ extends to a map of factorization algebras
\be\label{classical vir}
\Psi^{\cl}_X : \ul{\Sym_* (\cT^S_c[1])} \to \Obs^{\cl}_X[-1], 
\ee 
since $\Sym(\fg[1])$ is the enveloping $P_0$ algebra of a Lie algebra $\fg$ and $\Obs^{\cl}$ has a natural $P_0$ algebra structure.
(We note that the symmetric algebra of a cosheaf has a natural factorization algebra structure.)
This map should be viewed as a factorization algebra refinement of the Noether theorem in classical physics: a symmetry determines an operator (i.e., a current) in the observables of the classical theory. 
We now wish to study the quantum counterpart to this map of factorization algebras. 

The quantum version of the symmetry of holomorphic vector fields is a factorization algebra depending on a central charge $c$ that we call the {\em Virasoro factorization algebra with charge $c$} and denote $\sVir_{c}$. On $\CC$, this holomorphic factorization algebra is related to the Virasoro vertex algebra in a natural way, as shown in \cite{bw_vir}. 
We already know that the factorization algebra of quantum observables $\Obs^{\q}_n$ carries an action of the extended Lie algebra $\TVect$ and hence determines a sheaf $\Obs^{\q}_{X,\alpha}$ on any complex manifold $X$ with trivial second Chern character. 

The natural question is, then, how to construct the quantum version of the map (\ref{classical vir}). This question can also be understood as a problem of equivariant quantization, by the Koszul-type duality between solutions of the equivariant quantum master equation and maps of BD algebras. We have already computed the obstruction to quantizing the symmetry of holomorphic vector fields on $S = \CC$ in a way compatible with the action of formal vector fields on the target $\Vect$. Hence, the main result is the following.

\begin{prop} \label{prop quantum vir} 
Let $\alpha$ be a trivialization of $\ch_2(T_X)$, and let $\Obs^\q_{X,\alpha}$ be the resulting factorization algebra on $\CC$ of observables for the curved $\beta\gamma$ system with target $X$. If $c_1(T_X) = 0$,  then there is a map of sheaves on $X$ of holomorphic factorization algebras on $\CC$ 
\be\label{quantum vir}
\Psi^\q_X : {\ul \sVir}_{c=2n} \to \Obs^q_{X,\alpha}
\ee
that, modulo $\hbar$, agrees with the classical map of factorization algebras $\Psi^{\rm cl}$ in Equation~(\ref{classical vir}). 
\end{prop}

This claim will follow from obstruction calculations we have already done when combined with the following quantum version of the Noether theorem for factorization algebras. 

\begin{thm}[\cite{CG2}, Theorem 12.1.0.2] \label{thm quantum noether} 
Let a local Lie algebra $\cE$ defined on a manifold $S$ describe a classical BV theory and suppose $\cE$ has an action of a local Lie algebra $\cL$. Fix a $\cL$-dependent quantization $\{I^\cL[L]\}_{L > 0}$ as described in Section \ref{sec equiv bv 1} such that the obstruction to solving the equivariant QME vanishes modulo functionals depending solely on $\cE$. There is then an $\hbar$-dependent cocycle $\eta \in \cloc^*(\cL)[[\hbar]]$ of degree one, and a map of factorization algebras
\ben
\Psi^{\q} : {\rm C}^{{\rm Lie}, \eta}_*(\cL_c) \to \Obs^q,
\een
where $ {\rm C}^{{\rm Lie}, \eta}_*(\cL_c)$ is the factorization algebra of $\eta$-twisted Chevalley-Eilenberg chains of~$\cL_c$.
\end{thm}

Explicitly, this cocycle $\eta$ determines a central extension
\ben
0 \to \CC[-1] \to \Tilde{\cL}_c(U) \to \cL_{c}(U) \to 0 
\een
for each open set $U \subset S$.
By definition, we set 
\[
{\rm C}^{{\rm Lie}, \eta}_*(\cL_c) (U) = {\rm C}_*^{\rm Lie}(\Tilde{\cL}_c(U)),
\] 
which is a factorization algebra as shown in \cite{CG2}.
We now proceed to prove Proposition~\ref{prop quantum vir}. 

\begin{proof} We consider the Gelfand-Kazhdan descent of the classical formal $\beta\gamma$ system. As  discussed in Section \ref{sec comparison}, the $L_\infty$ algebra $\DD \fg_n^S$ becomes the curved $L_\infty$ algebra $\DD \fg_X^S$ defined over $\Omega^*_X$. The dg Lie algebra of holomorphic vector fields $\cT^S$ is classically a trivial $\Vect$-module, thus the action of $\cT^S$ on the formal $\beta\gamma$ system descends to an action on the curved $\beta\gamma$ system described by $\DD \fg_X^S$. As usual, we work on $S = \CC$. 

The obstruction calculation of Proposition \ref{sec conformal anomaly} for the $\Vect \times \cT^\CC$ equivariant quantization implies that the $\DD \fg_X^\CC$-dependent obstruction vanishes provided we choose a trivialization $\alpha$ for $\ch_2(T_X)$ and a trivialization $\beta$ for $c_1(T_X)$. Given such a quantization, we see that the cocycle as in Theorem \ref{thm quantum noether} is precisely given by $\eta = 2 n \omega^{\GF}$. That is, the part of the obstruction that is independent of the fields $\DD \fg_X^\CC$. 

The resulting factorization algebra for the curved $\beta\gamma$ system with choice of trivialization $\alpha$ is given by $\Obs^\q_{X,\alpha}$. Finally, the Virasoro factorization algebra of central charge $2n$ is precisely the factorization algebra $\sVir_{c=2n} := {\rm C}^{{\rm Lie}, 2 n \omega^{\GF}}_* (\cT^\CC_c)$. The proposition follows.
\end{proof}

%\begin{rmk} Note that for every choice of trivialization $\beta$ of $c_1(T_X)$, as in the proof of the proposition, we obtain a map of factorization algebras (\ref{quantum vir}). \brian{not sure what more to say here...}
%\end{rmk}