\part*{Introduction}

%\epigraph{
%\it Naively the theory defined by the Lagrangian is the free field theory, 
%\dots [but] the definition of the path integral measure in the theory is subtle \dots
%}
%{Lectures on curved $\beta\gamma$ systems, pure spinors, and anomalies \\ \textsc{Nikita A. Nekrasov}}

The curved $\beta\gamma$ system is an elegant nonlinear $\sigma$-model of maps from a Riemann surface $\Sigma$ into the cotangent bundle $T^*X$ of a complex manifold $X$. The equations of motion pick out the holomorphic maps. Thus, from a purely mathematical perspective, it is a compelling example to study 
because the classical theory naturally involves complex geometry and so must the quantization, although the meaning is less familiar. From a physical perspective, the curved $\beta\gamma$ system arises naturally as a close cousin of more central theories: it is a half-twist of the $(0,2)$-supersymmetric $\sigma$-model \cite{WittenCDO}, and it is also the chiral part of the infinite volume limit of the usual (non-supersymmetric) $\sigma$-model (see the appendix). In consequence, the curved $\beta\gamma$ system exhibits many features of these theories while enjoying the flavor of complex geometry, rather than super- or Riemannian geometry.

In mathematics, however, this theory first appeared in a hidden form in the work of Beilinson-Drinfeld and Malikov-Schechtman-Vaintrob \cite{BD,MSV}, and it was subsequently developed by many mathematicians (see \cite{KV,Cheung,Bressler} among much else). The {\em chiral differential operators} (CDOs) on a complex $n$-manifold $X$ are a sheaf of vertex algebras locally resembling a vertex algebra of $n$ free bosons, and the name indicates the analogy with the differential operators, a sheaf of associative algebras on $X$ locally resembling the Weyl algebra for $T^*\CC^n$. Unlike the situation for differential operators, which exist on any manifold $X$, such a sheaf of vertex algebras exists only if $\ch_2(X) = 0$ in $H^2(X, \Omega^2_{cl})$, and each choice of trivialization $\alpha$ of this characteristic class yields a different sheaf $\CDO_{X,\alpha}$. In other words, there is a gerbe over $X$ of vertex algebras \cite{GMS}. The appearance of this topological obstruction (essentially the first Pontryagin class, but non-integrally) was surprising, and even more surprising was that the character of this vertex algebra was the Witten genus of $X$, up to a constant depending only on the dimension of $X$ \cite{BorLib}. These results exhibited the now-familiar rich connections between conformal field theory, geometry, and topology, but arising from a mathematical process rather than a physical argument. 

Witten \cite{WittenCDO} explained how CDOs on $X$ arise as the perturbative piece of the chiral algebra of the curved $\beta\gamma$ system, by combining standard methods from physics and mathematics. (In elegant lectures on the curved $\beta\gamma$ system \cite{Nek}, with a view toward Berkovit's approach to the superstring, Nekrasov also explains this relationship.  Kapustin \cite{KapCDR} gave a similar treatment of the closely-related chiral de Rham complex.) This approach also gave a different understanding of the surprising connections with topology, in line with anomalies and elliptic genera as seen from physics. Let us emphasize that only the perturbative sector of the theory appears (i.e., one works near the constant maps from $\Sigma$ to $T^*X$, ignoring the nonconstant holomorphic maps); the instanton corrections are more subtle and not captured just by CDOs (see \cite{KapOrlov} for a treatment of the instanton corrections for complex tori).

In this paper we construct mathematically the perturbative sector of the curved $\beta\gamma$ system via the approach to quantum field theory developed in \cite{CosBook, CG1, CG2}, thus providing a rigorous construction of the path integral for the curved $\beta\gamma$ system. That means we work in the homotopical framework for field theory known as the Batalin-Vilkovisky (BV) formalism, in conjunction with Feynman diagrams and renormalization methods. As a very brief gloss, the BV formalism amounts to deforming the classical action $S^\cl$ to a ``quantized action'' $S^\q = S^\cl + \hbar S_{(1)} + \hbar^2 S_{(2)} + \cdots$ satisfying a condition known as the quantum master equation. This quantized action $S^\q$ provides a formal substitute for the path integral; more precisely, it is a homological version of the integrand ``$\exp(-S(\phi)/\hbar) \mathcal{D}\phi$'' for the path integral. Indeed, given this quantized action $S^\q$, one can extract the algebraic relations that hold between the expected values of observables. Thus the quantum master equation encodes homologically the condition that the associated quantum integrand is well-posed. We find, for instance, that the curved $\beta\gamma$ system admits a quantized action satisfying the quantum master equation only if the target manifold $X$ has $\ch_2(X) = 0$, where $\ch_2(X)$ is a component of the Chern character. (Given our context, this condition is that the first Pontryagin class vanishes.) This condition was found in the earlier mathematical work by quite different methods.

One key feature of the framework in \cite{CG1, CG2} is that every BV theory yields a factorization algebra of observables. (We mean here the version of factorization algebras developed in \cite{CG1, CG2}, not the version of Beilinson and Drinfeld \cite{BD}.)
In our situation, the theory produces a factorization algebra living on the source manifold $\CC$, 
and the machinery of \cite{CG1, CG2} allows one to extract a vertex algebra from this factorization algebra.
Our main result is that this vertex algebra is the CDOs.
Thus, we show that in a wholly mathematical setting, one can start with the action functional for the curved $\beta\gamma$ system
and recover the sheaf $\CDO_{X,\alpha}$ of vertex algebras on $X$ via the algorithms of \cite{CosBook, CG1, CG2}.
To accomplish this, we develop machinery that ought to be useful in constructing nonlinear $\sigma$-models in the BV framework and allows one to analyze explicitly the resulting factorization algebra.

\begin{rmk*}
In a sense, the curved $\beta\gamma$ system is a perfect testing ground for the formalism of \cite{CosBook, CG1, CG2}: physical arguments about anomalies and moduli ought to be codified on the BV quantization side, and the consequences on the factorization algebra side ought to recover the vertex algebra constructions of \cite{MSV,GMS}. The work here shows that the formalism passes this test.
\end{rmk*}

Let us explain a little about our methods before stating our theorems precisely. The main technical challenge is to encode the nonlinear $\sigma$-model in a way so that the BV formalism of \cite{CosBook} applies. In \cite{WG2}, Costello introduces a sophisticated approach by which he recovers the anomalies and the Witten genus as partition function, but it seems difficult to relate CDOs directly to the factorization algebra of observables of his quantization. Instead, we use formal geometry {\it \`a la} Gelfand and Kazhdan \cite{GK}, as applied to the Poisson $\sigma$-model by Kontsevich \cite{KonDQ} and Cattaneo-Felder \cite{CF}.  The basic idea of Gelfand-Kazhdan formal geometry is that every $n$-manifold $X$ looks, very locally, like the formal $n$-disk, and so any representation $V$ of the formal vector fields and formal diffeomorphisms determines a vector bundle $\cV \to X$, by a sophisticated variant of the associated bundle construction. (Every tensor bundle arises in this way, for instance.) In particular, the Gelfand-Kazhdan version of characteristic classes for $V$ live in the Gelfand-Fuks cohomology $H^*_{\GF}(\Vect)$ and map to the usual characteristic classes for $\cV$. There is, for instance, a Gelfand-Fuks version of the Witten class for every tensor bundle.

Thus, we start with the $\beta\gamma$ system with target the formal $n$-disk $\widehat{D}^n = \rm{Spec}\,\CC[[t_1,\ldots,t_n]]$ and examine whether it quantizes \emph{equivariantly} with respect to the actions of formal vector fields $\Vect$ and formal diffeomorphisms on the formal $n$-disk. (These actions are compatible, so that we have a representation of a Harish-Chandra pair.) We call this theory the \emph{equivariant formal $\beta\gamma$ system of rank $n$}.

\begin{thm*}
The $\Vect$-equivariant formal $\beta\gamma$ system of rank $n$ has an anomaly given by a cocycle $\ch_2(\widehat{D}^n)$ in the Gelfand-Fuks  complex ${\rm C}^*_{\GF}(\Vect ; \widehat{\Omega}^2_{n,cl})$. This cocycle determines a Lie algebra extension $\TVect$ of $\Vect$. The cocycle is exact in ${\rm C}^*_{\GF}(\TVect ; \hOmega^2_{n,cl})$, and yields a $\TVect$-equivariant BV quantization, unique up to homotopy. The partition function of this theory over the moduli of elliptic curves is the formal Witten class in the Gelfand-Fuks  complex ${\rm C}^*_{\GF}(\Vect, \bigoplus_k \widehat{\Omega}_n^k[k])[[\hbar]]$.
\end{thm*}

Gelfand-Kazhdan formal geometry is used often in deformation quantization. See, for instance, the elegant treatment by Bezrukavnikov-Kaledin \cite{BK}. Here we develop a version suitable for vertex algebras and factorization algebras, which requires allowing homotopical actions of the Lie algebra $\Vect$. (Something like this appears already in \cite{BD,KV,Malikov2008}, but we need a method with the flavor of differential geometry and compatible with Feynman diagrammatics. It would be interesting to relate directly these different approaches.) In consequence, our equivariant theorem implies the following global version.
 
\begin{thm*}
Let $X$ be a complex manifold. The curved $\beta\gamma$ system admits a BV quantization if the characteristic class $\ch_2(X)$ vanishes, and each choice of trivialization $\alpha$ yields a BV quantization, unique up to homotopy. The associated factorization algebra on $X$ recovers the vertex algebra $\CDO_{X,\alpha}$ of chiral differential operators associated to the trivialization $\alpha$. Moreover, the partition function is the Witten class ${\rm Wit}(X)$ in $\bigoplus_k H^*(X, \Omega^k[k])$, where $\Omega^k$ here denotes the sheaf of holomorphic $k$-forms.
\end{thm*}

\si
\begin{rmk*} 
In physics, ordinarily, the partition function refers to the full path integral.
What we are referring to is the path integral of the effective action on the zero modes in perturbation theory. 
\end{rmk*}

To identify $\CDO_{X,\alpha}$ as coming from the factorization algebra, we prove general statements relating factorization algebras for such chiral theories with vertex algebras. Indeed, our work shows how the elegant formulas uncovered in \cite{MSV,GMS} arise explicitly by canceling the anomalies that appear in setting the integrand of the quantum measure (or to use BV language, in finding a solution to the quantum master equation). Via the factorization algebra of observables, these BV manipulations become the computations that Witten and Nekrasov used in explaining why the curved $\beta\gamma$ system should recover the chiral differential operators.

\si
\begin{rmk*}
We wish to emphasize that our central goal in this paper 
is not to provide yet another method for constructing sheaves of vertex algebras
or another understanding of the geometry behind the Pontryagin class as an anomaly.
Instead our goal is to offer an explanation for how CDOs appear as a quantization,
from a path integral perspective as rigorously encoded in the BV formalism.

One essential application of this perspective is the establishment of modularity for characters for general chiral conformal field theories. 
This manifest modularity for the characters of observables in the BV formalism is due to their explicit presentation via Feynman diagrams as integrals over the elliptic curve. 
\end{rmk*}


Our techniques for assembling BV theories in families --- and their factorization algebras in families --- apply to many $\sigma$-models already constructed , such as the topological $B$-model \cite{LiLi}, Rozansky-Witten theory \cite{CLL}, and topological quantum mechanics \cite{GG1, GLL}. They also allow us to recover quickly nearly all the usual variants on CDOs and structures therein, such as the chiral de Rham complex and the Virasoro actions, and we intend to explain that elsewhere. Other veins of research are also opened up, notably new approaches to quantum sheaf cohomology and to the curved $\beta\gamma$ system with higher-dimensional source manifold.

\subsection{Overview}

The paper is divided into three parts. Part I is devoted purely to the vertex algebra of chiral differential operators, Part II constructs the curved $\beta\gamma$ system as a BV field theory and analyzes its associated factorization algebra of observables, and Part III explains how to recover the vertex algebra from the factorization algebra. Each Part has its own introduction with a detailed overview of its contents. We emphasize that Parts I and II can be read independently; only in Part III are the two stories in explicit dialogue.

\subsection{Acknowledgements}

This work would not have been possible without the support of several organizations.
First, it was the open and stimulating atmosphere of the Max Planck Institute for Mathematics 
that made it so easy to begin our collaboration.
Moreover, it is through the MPIM's great generosity that we were able to continue
work and finish the paper during several visits by VG and BW.
Second, we benefited from the support and convivial setting of the Hausdorff Institute for Mathematics
and its Trimester Program ``Homotopy theory, manifolds, and field theories" during the summer of 2015.
Third, the Oberwolfach Workshop ``Factorization Algebras and Functorial Field Theories" in May 2016
allowed us all to gather in person and finish important discussions.
In addition, OG enjoyed support from the National Science Foundation as a postdoctoral fellow under Award DMS-1204826, 
and BW enjoyed support as a graduate student research fellow under Award DGE-1324585.  
Finally, this research was carried out, in part, within the HSE University Basic Research Program
and funded by the Russian Academic Excellence Project~'5-100'.

For OG there is a large cast of mathematicians whose questions, conversation, and interest 
have kept these issues alive and provided myriad useful insights that are now hard to enumerate in detail.
He thanks Kevin Costello for introducing him to the $\beta\gamma$ system in graduate school --- and for innumerable discussions since --- as well as Dan Berwick-Evans, Ryan Grady, and Yuan Shen
for grappling collaboratively with \cite{WG2} throughout that period.
Si Li's many insights and questions have shaped this work substantially.
Matt Szczesny's guidance at the Northwestern CDO Workshop was crucial; 
his subsequent encouragement is much appreciated.
OG would also like to thank Stephan Stolz and Peter Teichner for the still-running conversation about
conformal field theory that influences strongly his approach to the subject.
Finally, he thanks Andr\'e Henriques, John Francis, and Scott Carnahan for letting him eavesdrop as they chatted about CDOs over a decade ago.

BW feels fortunate to have stepped into this community early in his graduate work and has benefited from the support of many of the individuals mentioned above. First and foremost, he thanks his adviser Kevin Costello for guidance and Si Li for helping him to harness Feynman diagrams in the context of the BV formalism. He also thanks Ryan Grady, Matt Szczesny, and Stephan Stolz for invitations to talk about this project as well as valuable input on various aspects of it. In addition, numerous discussions with Dylan William Butson, Chris Elliott, and Philsang Yoo about perturbative QFT have informed his work. 
